<!DOCTYPE html>

<html lang="ja" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-144561796-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-144561796-1');
    </script>
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <title>2. OASE管理 &#8212; Documentation  ドキュメント</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fe63c2af" />
    <link rel="stylesheet" type="text/css" href="../../_static/option.css?v=49ab891d" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=a5c4661c" />
    <link rel="stylesheet" type="text/css" href="../../_static/exastro_documents.css?v=99e5f627" />
    <link rel="stylesheet" type="text/css" href="../../_static/swagger/swagger-ui.css?v=ab82c586" />
    
    <script src="../../_static/documentation_options.js?v=c033477b"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=3e58b9f8"></script>
    <script src="../../_static/translations.js?v=4755f45a"></script>
    <script src="../../_static/jquery-3.6.3.min.js?v=25455f10"></script>
    <script src="../../_static/exastro_documents.js?v=ff50fb31"></script>
    <script src="../../_static/swagger/swagger-ui-bundle.js?v=ec73a32a"></script>
    <script src="../../_static/swagger/swagger-ui-standalone-preset.js?v=88d26966"></script>
    <link rel="icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="検索" href="../../search.html" />
    <link rel="next" title="3. OASE" href="oase.html" />
    <link rel="prev" title="1. OASE共通" href="oase_common.html" /> 
  </head>
<body id="page" class="ja">


<div id="container">

<div id="header">
  <header class="divInner">
    <!-- Exastro logo -->
    <div id="logo"><a href="https://ita.exastro.org/"><img src="../../_static/img/exastro.svg" alt="Exastro"></a></div>
    <!-- Project name -->
    <div id="projectName"><a href="../../index.html">Documentation</a></div>
    <!-- Heaedr navigation -->
    <div id="headerSearch">
      <form class="search" action="../../search.html" method="get">
        <input type="text" name="q" aria-labelledby="searchlabel">
        <button type="submit" value="検索"><img src="../../_static/img/search.png" alt="検索"></button>
      </form>
    </div>
  </header>
</div><!-- End #header -->


<div id="toolbar">
  <div class="divInner">
    
    <div id="documentVersion">
      <dl>
        <dt>Document version</dt>
        <dd>
          <div>
            <select name="version" style="height: 20px;" onchange="location.href=value;">
              <option value="../../../../ja/2.7/manuals/oase/oase_management.html" selected>current</option>
              <option value="../../../../ja/2.7/manuals/oase/oase_management.html" selected>2.7(current)</option>
              <option value="../../../../ja/2.6/manuals/oase/oase_management.html">2.6</option>
              <option value="../../../../ja/2.5/manuals/oase/oase_management.html">2.5</option>
              <option value="../../../../ja/2.4/manuals/oase/oase_management.html">2.4</option>
              <option value="../../../../ja/2.3/manuals/oase/oase_management.html">2.3</option>
              <option value="../../../../ja/2.2/manuals/oase/oase_management.html">2.2</option>
              <option value="../../../../ja/2.1/manuals/oase/oase_management.html">2.1</option>
              <option value="../../../../ja/2.0/manuals/oase/oase_management.html">2.0</option>
            </select>
          </div>
        </dd>
      </dl>
    </div>

    <div id="documentLanguage">
      <dl>
        <dt>Language</dt>
        <dd>
          <div>
            <select name="lang" style="height: 20px;" onchange="location.href=value;">
              <option value="../../../../ja/2.7/manuals/oase/oase_management.html" selected>日本語</option>
              <option value="../../../../en/2.7/manuals/oase/oase_management.html">English</option>
            </select>
          </div>
        </dd>
      </dl>
    </div>
    <div id="toolbarNavigation">
      <ul>
        <li class="prev"><a href="oase_common.html" title="前のトピックへ"><span class="section-number">1. </span>OASE共通</a></li>
        <li class="next"><a href="oase.html" title="次のトピックへ"><span class="section-number">3. </span>OASE</a></li>
      </ul>
    </div>
  </div>
</div><!-- End #toolbar -->

<div id="sideMenu">

  <div id="menuButton"></div>
  
  <aside class="divInner">
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../overview/index.html">概要</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/index.html">構成・構築ガイド</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation/index.html">インストール／アップグレード</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../learn/index.html">Learn</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">マニュアル</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../platform_management/index.html">システム管理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../organization_management/index.html">オーガナイゼーション管理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../it_automation_base/index.html">基本操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../create_param/index.html">パラメータ管理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../host_group/index.html">ホストグループ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ansible-driver/index.html">Ansible ドライバ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../terraform_driver/index.html">Terraform ドライバ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../export_import/index.html">エクスポート・インポート</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cicd_for_iac/index.html">CI/CD for IaC</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">OASE</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="oase_common.html">1. OASE共通</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">2. OASE管理</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id1">2.1. はじめに</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id2">2.2. メニュー構成</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id3">2.2.1. メニュー/画面一覧</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#agent-about">2.3. エージェント概要</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id5">2.3.1. エージェントについて</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#id6">2.4. エージェント利用手順</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id7">2.4.1. 作業フロー</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#id8">2.5. 通知テンプレート（共通）概要</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id9">2.6. 通知テンプレート（共通）利用手順</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id10">2.7. 機能メニュー操作説明</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id11">2.7.1. メニューについて</a></li>
<li class="toctree-l5"><a class="reference internal" href="#agent">2.7.2. イベント収集</a></li>
<li class="toctree-l5"><a class="reference internal" href="#notification-template-common">2.7.3. 通知テンプレート（共通）</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#id14">2.8. 付録</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#oase-agent-env">2.8.1. OASE Agentの処理フローと.envの設定値</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id15">2.8.2. イベント収集設定の即時反映について</a></li>
<li class="toctree-l5"><a class="reference internal" href="#about-decode">2.8.3. エージェントのデコード処理について</a></li>
<li class="toctree-l5"><a class="reference internal" href="#oase-agent-respons-key-enevnt-id-key">2.8.4. レスポンスキーとイベントIDキー</a></li>
<li class="toctree-l5"><a class="reference internal" href="#oase-agent-settings">2.8.5. 監視ソフト毎のイベント収集設定例</a></li>
<li class="toctree-l5"><a class="reference internal" href="#reserved-variables">2.8.6. 利用可能な予約変数一覧</a></li>
<li class="toctree-l5"><a class="reference internal" href="#notification-template-sample">2.8.7. 通知テンプレート（共通）の設定例</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="oase.html">3. OASE</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../api/index.html">API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../maintenance/index.html">メンテナンス</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../templates/index.html">テンプレート</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">リファレンス</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kb/index.html">ナレッジベース</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary/index.html">用語集</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes/index.html">リリースノート</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contribute/index.html">貢献</a></li>
</ul>

    <!-- <ul>
      <li class="toctree-l1"><a class="reference internal" href="../../../../genindex.html">索引</a></li>
    </ul> -->
    
  </aside>
</div><!-- End #sideMenu -->


<div id="tableOfContents">
  <div id="tocButton"></div>
  <ul>
<li><a class="reference internal" href="#">2. OASE管理</a><ul>
<li><a class="reference internal" href="#id1">2.1. はじめに</a></li>
<li><a class="reference internal" href="#id2">2.2. メニュー構成</a><ul>
<li><a class="reference internal" href="#id3">2.2.1. メニュー/画面一覧</a></li>
</ul>
</li>
<li><a class="reference internal" href="#agent-about">2.3. エージェント概要</a><ul>
<li><a class="reference internal" href="#id5">2.3.1. エージェントについて</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id6">2.4. エージェント利用手順</a><ul>
<li><a class="reference internal" href="#id7">2.4.1. 作業フロー</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id8">2.5. 通知テンプレート（共通）概要</a></li>
<li><a class="reference internal" href="#id9">2.6. 通知テンプレート（共通）利用手順</a></li>
<li><a class="reference internal" href="#id10">2.7. 機能メニュー操作説明</a><ul>
<li><a class="reference internal" href="#id11">2.7.1. メニューについて</a></li>
<li><a class="reference internal" href="#agent">2.7.2. イベント収集</a></li>
<li><a class="reference internal" href="#notification-template-common">2.7.3. 通知テンプレート（共通）</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id14">2.8. 付録</a><ul>
<li><a class="reference internal" href="#oase-agent-env">2.8.1. OASE Agentの処理フローと.envの設定値</a></li>
<li><a class="reference internal" href="#id15">2.8.2. イベント収集設定の即時反映について</a></li>
<li><a class="reference internal" href="#about-decode">2.8.3. エージェントのデコード処理について</a><ul>
<li><a class="reference internal" href="#id17">動作確認済み文字コード</a></li>
</ul>
</li>
<li><a class="reference internal" href="#oase-agent-respons-key-enevnt-id-key">2.8.4. レスポンスキーとイベントIDキー</a><ul>
<li><a class="reference internal" href="#id18">レスポンスキー</a></li>
<li><a class="reference internal" href="#jmespath">JMESPath</a></li>
<li><a class="reference internal" href="#id19">レスポンスリストフラグ</a></li>
<li><a class="reference internal" href="#id20">イベントIDキー</a></li>
</ul>
</li>
<li><a class="reference internal" href="#oase-agent-settings">2.8.5. 監視ソフト毎のイベント収集設定例</a><ul>
<li><a class="reference internal" href="#zabbix">Zabbix</a></li>
<li><a class="reference internal" href="#grafana">Grafana</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reserved-variables">2.8.6. 利用可能な予約変数一覧</a><ul>
<li><a class="reference internal" href="#id23">予約変数</a><ul>
<li><a class="reference internal" href="#exastro-last-fetched-event">EXASTRO_LAST_FETCHED_EVENTで参照できる項目</a></li>
<li><a class="reference internal" href="#exastro-event-collection-setting">EXASTRO_EVENT_COLLECTION_SETTINGで参照できる項目一覧</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id24">設定例</a><ul>
<li><a class="reference internal" href="#id25">接続先での使用例</a></li>
<li><a class="reference internal" href="#id26">リクエストヘッダーでの使用例</a></li>
<li><a class="reference internal" href="#id27">パラメータでの使用例</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#notification-template-sample">2.8.7. 通知テンプレート（共通）の設定例</a><ul>
<li><a class="reference internal" href="#servicenow">ServiceNow(レコード登録)の設定例</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

</div>


<div id="contents">
<main class="divInner">

 <div id="breadcrumbs">
  <ul>
    <li><a href="../../index.html">HOME</a></li>
    <li><a href="../index.html">マニュアル</a></li>
    <li><a href="index.html">OASE</a></li>
    
    <li><span class="section-number">2. </span>OASE管理</li>
  </ul>
</div>

<div id="article">
<article class="divInner">
<div class="body" role="main">

  <section id="oase">
<h1><span class="section-number">2. </span>OASE管理<a class="headerlink" href="#oase" title="Link to this heading">¶</a></h1>
<section id="id1">
<h2><span class="section-number">2.1. </span>はじめに<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h2>
<div class="line-block">
<div class="line">本書では、OASE管理の機能および操作方法について説明します。</div>
</div>
</section>
<section id="id2">
<h2><span class="section-number">2.2. </span>メニュー構成<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<div class="line-block">
<div class="line">本章では、OASE管理で利用するメニュー構成について説明します。</div>
</div>
<section id="id3">
<h3><span class="section-number">2.2.1. </span>メニュー/画面一覧<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">OASE管理のメニュー一覧を以下に記述します。</div>
</div>
<table class="docutils align-left" id="id30">
<caption><span class="caption-number">表 2.92 </span><span class="caption-text">OASE管理 メニュー/画面一覧</span><a class="headerlink" href="#id30" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 10.0%" />
<col style="width: 20.0%" />
<col style="width: 20.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><strong>No</strong></p></th>
<th class="head"><p><strong>メニューグループ</strong></p></th>
<th class="head"><p><strong>メニュー・画面</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td rowspan="2"><p>OASE管理</p></td>
<td><p>イベント収集</p></td>
<td><p>イベント収集対象の情報を管理します。</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>通知テンプレート（共通）</p></td>
<td><p>OASEの通知で使用する情報を管理します。</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="agent-about">
<span id="id4"></span><h2><span class="section-number">2.3. </span>エージェント概要<a class="headerlink" href="#agent-about" title="Link to this heading">¶</a></h2>
<div class="line-block">
<div class="line">本章では、エージェント（Exastro OASE Agent）について説明します。</div>
</div>
<section id="id5">
<h3><span class="section-number">2.3.1. </span>エージェントについて<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">エージェントは、Exastro IT Automation（以下、ITA）とは独立しており、ITA OASEと外部サービスの仲介役として機能します。</div>
<div class="line">エージェントは、対象とする外部サービスのイベント収集設定をITAから取得し、その設定を用いて外部サービスからイベントを取得します。このプロセスを経て、取得したイベントをITAに送信します。</div>
</div>
<figure class="align-default">
<a class="reference internal image-reference" href="../../_images/agent_overview_v2-4.png"><img alt="OASEエージェント概要" src="../../_images/agent_overview_v2-4.png" style="width: 800px;" />
</a>
</figure>
</section>
</section>
<section id="id6">
<h2><span class="section-number">2.4. </span>エージェント利用手順<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h2>
<div class="line-block">
<div class="line">本章では、エージェント（Exastro OASE Agent）の利用手順について説明します。</div>
</div>
<section id="id7">
<h3><span class="section-number">2.4.1. </span>作業フロー<a class="headerlink" href="#id7" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">エージェントを利用するための作業を含めた、OASEの作業フローは以下のとおりです。</div>
<div class="line">エージェント利用のための作業の詳細は次項に記載しています。</div>
</div>
<figure class="align-default">
<a class="reference internal image-reference" href="../../_images/oase_process_v2-3.png"><img alt="OASE作業フロー" src="../../_images/oase_process_v2-3.png" style="width: 700px;" />
</a>
</figure>
<ul>
<li><p><strong>作業フロー詳細と参照先</strong></p>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><strong>イベント収集設定</strong></div>
<div class="line">OASE管理のイベント収集メニュー画面から、イベント収集対象サービスに関する設定を登録します。</div>
<div class="line">詳細は <a class="reference internal" href="#agent"><span class="std std-ref">イベント収集</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>ラベル設定</strong></div>
<div class="line">OASEのラベル作成/ラベル付与メニュー画面から、ラベルを付与するための設定を行います。</div>
<div class="line">詳細は <a class="reference internal" href="oase.html#label-creation"><span class="std std-ref">ラベル作成</span></a> および <a class="reference internal" href="oase.html#labeling"><span class="std std-ref">ラベル付与</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>エージェントのインストール・起動</strong></div>
<div class="line">エージェントを起動し、イベント収集を開始します。</div>
<div class="line">詳細は <a class="reference internal" href="../../installation/online/oase_agent/docker_compose.html#oase-agent-docker-compose-install"><span class="std std-ref">インストールガイド（Docker Compose）</span></a> を参照してください。</div>
<div class="line">詳細は <a class="reference internal" href="../../installation/online/oase_agent/kubernetes.html#oase-agent-kubernetes-install"><span class="std std-ref">インストールガイド（Kubernetes）</span></a> を参照してください。</div>
</div>
</li>
</ol>
</li>
</ul>
</section>
</section>
<section id="id8">
<h2><span class="section-number">2.5. </span>通知テンプレート（共通）概要<a class="headerlink" href="#id8" title="Link to this heading">¶</a></h2>
<div class="line-block">
<div class="line">OASEの通知機能の概要図を以下に示します。</div>
</div>
<figure class="align-default" id="id31">
<a class="reference internal image-reference" href="../../_images/notification_template_overview.png"><img alt="通知テンプレート（共通）概要" src="../../_images/notification_template_overview.png" style="width: 800px;" />
</a>
<figcaption>
<p><span class="caption-number">図 2.71 </span><span class="caption-text">通知テンプレート（共通）概要</span><a class="headerlink" href="#id31" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<div class="line-block">
<div class="line">OASEの通知機能の通知テンプレートのイベント種別を以下に示します。</div>
</div>
<figure class="align-default" id="id32">
<a class="reference internal image-reference" href="../../_images/notification_template_overview_template.drawio.png"><img alt="通知テンプレートのイベント種別" src="../../_images/notification_template_overview_template.drawio.png" style="width: 800px;" />
</a>
<figcaption>
<p><span class="caption-number">図 2.72 </span><span class="caption-text">通知テンプレートのイベント種別</span><a class="headerlink" href="#id32" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="id9">
<h2><span class="section-number">2.6. </span>通知テンプレート（共通）利用手順<a class="headerlink" href="#id9" title="Link to this heading">¶</a></h2>
<div class="line-block">
<div class="line">OASEの通知機能を利用するために必要な作業フローは以下のとおりです。</div>
<div class="line">各作業の詳細は次項に記載しています。</div>
</div>
<figure class="align-default" id="id33">
<a class="reference internal image-reference" href="../../_images/notification_template_process.png"><img alt="通知テンプレート（共通）作業フロー" src="../../_images/notification_template_process.png" style="width: 700px;" />
</a>
<figcaption>
<p><span class="caption-number">図 2.73 </span><span class="caption-text">通知テンプレート（共通）作業フロー</span><a class="headerlink" href="#id33" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<ul>
<li><p><strong>作業フロー詳細と参照先</strong></p>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><strong>通知テンプレート（共通）のメンテナンス（閲覧/更新）</strong></div>
<div class="line">OASE管理の通知テンプレート（共通）メニュー画面から、OASEの通知で使用するテンプレートをメンテナンス（閲覧/更新）できます。</div>
<div class="line">詳細は <a class="reference internal" href="#notification-template-common"><span class="std std-ref">通知テンプレート（共通）</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>通知先設定の登録</strong></div>
<div class="line">Exastro システムにオーガナイゼーション管理者でログインし、メニューより <span class="menuselection">通知管理</span> から登録します。</div>
<div class="line">詳細は <a class="reference internal" href="../organization_management/notification.html#notification-management"><span class="std std-ref">通知先設定の登録</span></a> を参照してください。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>（通知先がメールの方のみ）メール送信サーバの設定</strong></div>
<div class="line">Exastro システムにオーガナイゼーション管理者でログインし、メニューより <span class="menuselection">メール送信サーバ設定</span> から登録します。</div>
<div class="line">詳細は <a class="reference internal" href="../organization_management/mailserver_settings.html#email-sending-server-settings"><span class="std std-ref">メール送信サーバーの設定</span></a> を参照してください。</div>
</div>
</li>
</ol>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">通知テンプレート（共通）は、変更しなくても利用可能です。</div>
</div>
</div>
</section>
<section id="id10">
<h2><span class="section-number">2.7. </span>機能メニュー操作説明<a class="headerlink" href="#id10" title="Link to this heading">¶</a></h2>
<div class="line-block">
<div class="line">本章では、OASE管理機能のメニュー操作説明について説明します。</div>
</div>
<section id="id11">
<h3><span class="section-number">2.7.1. </span>メニューについて<a class="headerlink" href="#id11" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">本節では、OASE管理をインストールした状態で表示されるメニューの操作について記載します。</div>
</div>
</section>
<section id="agent">
<span id="id12"></span><h3><span class="section-number">2.7.2. </span>イベント収集<a class="headerlink" href="#agent" title="Link to this heading">¶</a></h3>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><span class="menuselection">OASE管理 ▶ イベント収集</span> では、（エージェントに設定する）イベント収集対象の、接続方式・認証方式・TTL等をメンテナンス（閲覧/登録/更新/廃止）できます。</div>
</div>
</li>
</ol>
<figure class="align-default" id="id34">
<a class="reference internal image-reference" href="../../_images/agent_menu.png"><img alt="サブメニュー画面（イベント収集）" src="../../_images/agent_menu.png" style="width: 800px;" />
</a>
<figcaption>
<p><span class="caption-number">図 2.74 </span><span class="caption-text">サブメニュー画面（イベント収集）</span><a class="headerlink" href="#id34" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<ol class="arabic">
<li><div class="line-block">
<div class="line">イベント収集※1 画面の入力項目は以下のとおりです。</div>
</div>
<table class="docutils align-left" id="id35">
<caption><span class="caption-number">表 2.93 </span><span class="caption-text">イベント収集画面 入力項目一覧</span><a class="headerlink" href="#id35" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 8.0%" />
<col style="width: 12.0%" />
<col style="width: 48.0%" />
<col style="width: 8.0%" />
<col style="width: 8.0%" />
<col style="width: 16.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p><strong>項目</strong></p></th>
<th class="head"><p><strong>説明</strong></p></th>
<th class="head"><p><strong>入力必須</strong></p></th>
<th class="head"><p><strong>入力方法</strong></p></th>
<th class="head"><p><strong>制約事項</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td colspan="2"><p>イベント収集設定名</p></td>
<td><p>任意のイベント収集設定名を入力します。</p></td>
<td><p>〇</p></td>
<td><p>自動入力</p></td>
<td><p>最大長255バイト</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>接続方式</p></td>
<td><p>イベント収集対象への接続方法を選択します。</p>
<p>・Bearer認証</p>
<p>・パスワード認証</p>
<p>・任意の認証</p>
<p>・IMAP パスワード認証</p>
<p>・エージェント不使用</p>
</td>
<td><p>〇</p></td>
<td><p>リスト選択</p></td>
<td><p>※2</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>リクエストメソッド</p></td>
<td><p>イベント収集対象へのリクエストメソッドを選択します。</p>
<p>・接続方式がBearer認証、パスワード認証、任意の認証の場合</p>
<p>　- GET</p>
<p>　- POST</p>
<p>・接続方式がIMAP パスワード認証の場合</p>
<p>　- IMAP: Plaintext</p>
</td>
<td><p>ー</p></td>
<td><p>リスト選択</p></td>
<td><p>※2</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>接続先</p></td>
<td><p>イベント収集対象の接続先を入力します。</p>
<p>・メールサーバの場合はホスト名を入力します。</p>
<p>・APIの場合はURLを入力します。</p>
<p>・Jinja2形式で予約変数を使用できます。</p>
<p>　使用可能な予約変数の詳細は<a class="reference internal" href="#reserved-variables"><span class="std std-ref">利用可能な予約変数一覧</span></a> を参照してください。</p>
</td>
<td><p>〇</p></td>
<td><p>手動入力</p></td>
<td><p>最大長1024バイト</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>ポート</p></td>
<td><p>イベント収集対象のポートを入力します。</p></td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>0～65535</p></td>
</tr>
<tr class="row-odd"><td rowspan="6"><p>認証情報</p></td>
<td><p>リクエストヘッダー</p></td>
<td><p>リクエストヘッダーを入力します。</p>
<p>・JSON形式で入力します。</p>
<p>・Jinja2形式で予約変数を使用できます。</p>
<p>　使用可能な予約変数の詳細は<a class="reference internal" href="#reserved-variables"><span class="std std-ref">利用可能な予約変数一覧</span></a> を参照してください。</p>
</td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
<tr class="row-even"><td><p>プロキシ</p></td>
<td><p>イベント収集対象のプロキシURIを入力します。</p></td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長255バイト</p></td>
</tr>
<tr class="row-odd"><td><p>認証トークン</p></td>
<td><p>Bearer認証の認証トークンを入力します。</p></td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長1024バイト</p></td>
</tr>
<tr class="row-even"><td><p>ユーザー名</p></td>
<td><p>イベント収集対象へログインするユーザー名を入力します。</p></td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長255バイト</p></td>
</tr>
<tr class="row-odd"><td><p>パスワード</p></td>
<td><p>イベント収集対象へログインするユーザーのパスワードを入力します。</p></td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
<tr class="row-even"><td><p>メールボックス名</p></td>
<td><p>イベント収集対象のメールボックス名を入力します。</p>
<p>デフォルトでINBOXを参照します。</p>
</td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長255バイト</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>パラメータ</p></td>
<td><p>・JSON形式で入力します。</p>
<p>・Jinja2形式で予約変数を使用できます。</p>
<p>・リクエストメソッドがGETの場合、クエリパラメータ(接続先に追加される、&quot;?&quot;以降の値）として使用されます。</p>
<p>・リクエストメソッドがPOSTの場、リクエストのペイロードとして使用されます。</p>
<p>・使用可能な予約変数の詳細は<a class="reference internal" href="#reserved-variables"><span class="std std-ref">利用可能な予約変数一覧</span></a> を参照してください。</p>
</td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長255バイト</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>レスポンスキー</p></td>
<td><p>レスポンスのペイロードから、OASEのイベントとして受け取るプロパティの、親となるキーを指定します。</p>
<p>レスポンスのペイロードの階層をJSONのクエリ言語（JMESPath）で指定します。</p>
</td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長255バイト
※3</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>レスポンスリストフラグ</p></td>
<td><p>レスポンスキーで取得した値が配列かどうかを選択します。</p>
<p>・Trueの場合、レスポンスキーで取得した値を配列に分割し、その単位をイベントとして処理します。</p>
</td>
<td><p>ー</p></td>
<td><p>リスト選択</p></td>
<td><p>※3</p></td>
</tr>
<tr class="row-even"><td colspan="2"><p>イベントIDキー</p></td>
<td><p>受け取ったイベントをユニークに判別するIDとなるキーがある場合に入力します。</p>
<p>・レスポンスのペイロードの階層をJSONのクエリ言語（JMESPath）で指定します。</p>
<p>・レスポンスキーの指定やレスポンスリストフラグの指定を考慮した、それ以下の階層を指定します。</p>
</td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長255バイト
※3</p></td>
</tr>
<tr class="row-odd"><td colspan="2"><p>TTL</p></td>
<td><p>TTL（Time To Live）とは、エージェンが取得したイベントが、ルールの評価対象として扱われる期間（秒）のことです。</p></td>
<td><p>〇</p></td>
<td><p>手動入力</p></td>
<td><p>最小値10（秒）</p>
<p>最大値2147483647（秒）</p>
<p>デフォルトの値：3600（秒）</p>
</td>
</tr>
<tr class="row-even"><td colspan="2"><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
</li>
</ol>
<div class="line-block">
<div class="line">※1 イベント収集対象への設定です。</div>
</div>
<div class="line-block">
<div class="line">※2 接続方式・認証情報・リクエストメソッドについて、必要な組み合わせは以下のとおりです。</div>
</div>
<table class="docutils align-left">
<colgroup>
<col style="width: 33.3%" />
<col style="width: 33.3%" />
<col style="width: 33.3%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>接続方式</p></th>
<th class="head"><p>リクエストメソッド</p></th>
<th class="head"><p>認証情報</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>IMAP パスワード認証</p></td>
<td><p>・IMAP: Plaintext</p></td>
<td><div class="line-block">
<div class="line">・ユーザー名</div>
<div class="line">・パスワード</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>Bearer認証</p></td>
<td><div class="line-block">
<div class="line">・GET</div>
<div class="line">・POST</div>
</div>
</td>
<td><p>・認証トークン</p></td>
</tr>
<tr class="row-even"><td><p>パスワード認証</p></td>
<td><div class="line-block">
<div class="line">・GET</div>
<div class="line">・POST</div>
</div>
</td>
<td><div class="line-block">
<div class="line">・ユーザー名</div>
<div class="line">・パスワード</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>任意の認証</p></td>
<td><div class="line-block">
<div class="line">・GET</div>
<div class="line">・POST</div>
</div>
</td>
<td><p>・パラメータに記述</p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">※3 レスポンスキー、レスポンスリストフラグ 、イベントIDキーについては、 <a class="reference internal" href="#oase-agent-respons-key-enevnt-id-key"><span class="std std-ref">レスポンスキーとイベントIDキー</span></a> を参照してください。</div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line">収集先がメールの場合、文字コードの種類によりデコードできない文字を省いて収集イベントを保存する場合があります。</div>
<div class="line">詳細は <a class="reference internal" href="#about-decode"><span class="std std-ref">エージェントのデコード処理について</span></a> を参照してください。</div>
</div>
</div>
</section>
<section id="notification-template-common">
<span id="id13"></span><h3><span class="section-number">2.7.3. </span>通知テンプレート（共通）<a class="headerlink" href="#notification-template-common" title="Link to this heading">¶</a></h3>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><span class="menuselection">OASE管理 ▶ 通知テンプレート（共通）</span> では、OASEの通知機能で使用するテンプレートをメンテナンス（閲覧/登録/更新/廃止）できます。</div>
</div>
</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<div class="line-block">
<div class="line">通知テンプレートの変更について</div>
<div class="line">デフォルトの通知テンプレートは、利用する通知方法( <a class="reference internal" href="../organization_management/notification.html#notification-entry"><span class="std std-ref">通知先設定の登録手順</span></a> )に応じて内容を変更、または項目を追加してください。</div>
<div class="line">メール以外の通知方法を利用する場合、通知のテンプレートのフォーマット調整が必須です。</div>
</div>
</div>
<figure class="align-default" id="id36">
<a class="reference internal image-reference" href="../../_images/notification_template_menu.png"><img alt="サブメニュー画面（通知テンプレート（共通））" src="../../_images/notification_template_menu.png" style="width: 800px;" />
</a>
<figcaption>
<p><span class="caption-number">図 2.75 </span><span class="caption-text">サブメニュー画面（通知テンプレート（共通））</span><a class="headerlink" href="#id36" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<ol class="arabic">
<li><div class="line-block">
<div class="line">通知テンプレート（共通）画面の入力項目は以下のとおりです。</div>
</div>
</li>
</ol>
<table class="docutils align-left">
<colgroup>
<col style="width: 9.1%" />
<col style="width: 54.5%" />
<col style="width: 9.1%" />
<col style="width: 9.1%" />
<col style="width: 18.2%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項目</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>入力必須</p></th>
<th class="head"><p>入力方法</p></th>
<th class="head"><p>制約事項</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>イベント種別</p></td>
<td><div class="line-block">
<div class="line">テンプレートを使用するイベント種別を選択します。</div>
<div class="line">・1.新規イベント（受信時）</div>
<div class="line">・2.新規イベント（統合時）</div>
<div class="line">・3.新規イベント（判定前）</div>
<div class="line">・4.既知イベント（判定時）</div>
<div class="line">・5.既知イベント（TTL有効期限切れ）</div>
<div class="line">・6.未知イベント（判定時）</div>
</div>
</td>
<td><p>〇</p></td>
<td><p>リスト選択</p></td>
<td><p>ー</p></td>
</tr>
<tr class="row-odd"><td><p>テンプレート</p></td>
<td><div class="line-block">
<div class="line">通知で使用するテンプレートを編集できます。</div>
<div class="line">下記6種類はデフォルトで使用するテンプレートになります。</div>
<div class="line">・New(received).j2</div>
<div class="line">・New(consolidated).j2</div>
<div class="line">・New.j2</div>
<div class="line">・Known(evaluated).j2</div>
<div class="line">・Known(timeout).j2</div>
<div class="line">・Undetected.j2</div>
</div>
</td>
<td><p>〇</p></td>
<td><p>手動入力</p></td>
<td><p>最大サイズ2MB</p></td>
</tr>
<tr class="row-even"><td><p>通知先</p></td>
<td><div class="line-block">
<div class="line">テンプレートを使用する通知先を選択します。</div>
<div class="line">デフォルトのテンプレートには通知先を設定することはできません。</div>
<div class="line">デフォルト以外のテンプレートでは、イベント種別内でユニークな通知先を選択する必要があります。</div>
</div>
</td>
<td><p>ー</p></td>
<td><p>リスト選択</p></td>
<td><p>ー</p></td>
</tr>
<tr class="row-odd"><td><p>デフォルト</p></td>
<td><p>イベント種別に対して、レコードにない通知先に送信する場合にはデフォルトのテンプレートが使用されます。</p></td>
<td><p>ー</p></td>
<td><p>ー</p></td>
<td><p>ー</p></td>
</tr>
<tr class="row-even"><td><p>備考</p></td>
<td><p>自由記述欄です。</p></td>
<td><p>ー</p></td>
<td><p>手動入力</p></td>
<td><p>最大長4000バイト</p></td>
</tr>
</tbody>
</table>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<div class="line-block">
<div class="line">デフォルトのテンプレートは、テンプレート・備考のみ更新することができ、その他の項目は更新することはできません。</div>
<div class="line">また、デフォルトのテンプレートはレコードを廃止することもできません。</div>
</div>
</div>
<div class="line-block">
<div class="line">テンプレートの初期設定値は下記のとおりです。</div>
</div>
<div class="literal-block-wrapper docutils container" id="new-received-j2">
<div class="code-block-caption"><span class="caption-number">リスト 2.49 </span><span class="caption-text">New(received).j2</span><a class="headerlink" href="#new-received-j2" title="Link to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span> [TITLE]
<span class="linenos"> 2</span> Event Received;
<span class="linenos"> 3</span>
<span class="linenos"> 4</span> [BODY]
<span class="linenos"> 5</span> Event Received;
<span class="linenos"> 6</span> Detailed information
<span class="linenos"> 7</span>   Event Factor             : {% if exastro_edit_count == 1 %}Primary Event{% else %}Consolidated Event{% endif %} ({{ exastro_edit_count }})
<span class="linenos"> 8</span>   Event collection settings: {{ labels._exastro_event_collection_settings_id }}
<span class="linenos"> 9</span>   Event fetch time         : {{ labels._exastro_fetched_time }}
<span class="linenos">10</span>   Event end time           : {{ labels._exastro_end_time }}
<span class="linenos">11</span>   Event type               : {{ labels._exastro_type }}
<span class="linenos">12</span>
<span class="linenos">13</span>   Re-evaluation
<span class="linenos">14</span>     Event                  : {{ exastro_events }}
<span class="linenos">15</span>
<span class="linenos">16</span>   Label:
<span class="linenos">17</span>     {% for key, value in labels.items() %}
<span class="linenos">18</span>     ・{{ key }}: {{ value }}
<span class="linenos">19</span>     {% endfor %}
<span class="linenos">20</span>
<span class="linenos">21</span>   Agent:
<span class="linenos">22</span>     {% for key, value in exastro_agents.items() %}
<span class="linenos">23</span>     ・{{ key }}: {{ value }}
<span class="linenos">24</span>     {% endfor %}
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="new-consolidated-j2">
<div class="code-block-caption"><span class="caption-number">リスト 2.50 </span><span class="caption-text">New(consolidated).j2</span><a class="headerlink" href="#new-consolidated-j2" title="Link to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span> [TITLE]
<span class="linenos"> 2</span> Event Consolidated by Deduplication {% if labels._exastro_timeout == 1 %} (ttl expired) {% endif %};
<span class="linenos"> 3</span>
<span class="linenos"> 4</span> [BODY]
<span class="linenos"> 5</span> Event Consolidated by Deduplication {% if labels._exastro_timeout == 1 %} (ttl expired) {% endif %};
<span class="linenos"> 6</span> Detailed information
<span class="linenos"> 7</span>   Event Factor             : {% if exastro_edit_count == 1 %}Primary Event{% else %}Consolidated Event{% endif %} ({{ exastro_edit_count }})
<span class="linenos"> 8</span>   Event collection settings: {{ labels._exastro_event_collection_settings_id }}
<span class="linenos"> 9</span>   Event fetch time         : {{ labels._exastro_fetched_time }}
<span class="linenos">10</span>   Event end time           : {{ labels._exastro_end_time }}
<span class="linenos">11</span>   Event type               : {{ labels._exastro_type }}
<span class="linenos">12</span>
<span class="linenos">13</span>   Re-evaluation
<span class="linenos">14</span>     Event                  : {{ exastro_events }}
<span class="linenos">15</span>
<span class="linenos">16</span>   Label:
<span class="linenos">17</span>     {% for key, value in labels.items() %}
<span class="linenos">18</span>     ・{{ key }}: {{ value }}
<span class="linenos">19</span>     {% endfor %}
<span class="linenos">20</span>
<span class="linenos">21</span>   Agent:
<span class="linenos">22</span>     {% for key, value in exastro_agents.items() %}
<span class="linenos">23</span>     ・{{ key }}: {{ value }}
<span class="linenos">24</span>     {% endfor %}
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="new-j2">
<div class="code-block-caption"><span class="caption-number">リスト 2.51 </span><span class="caption-text">New.j2</span><a class="headerlink" href="#new-j2" title="Link to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span> [TITLE]
<span class="linenos"> 2</span> A new event has occured.
<span class="linenos"> 3</span>
<span class="linenos"> 4</span> [BODY]
<span class="linenos"> 5</span> Detailed information
<span class="linenos"> 6</span>   Event ID                 : {{ _id }}
<span class="linenos"> 7</span>   Event collection settings: {{ labels._exastro_event_collection_settings_id }}
<span class="linenos"> 8</span>   Event fetch time         : {{ labels._exastro_fetched_time }}
<span class="linenos"> 9</span>   Event end time           : {{ labels._exastro_end_time }}
<span class="linenos">10</span>   Event type               : {{ labels._exastro_type }}
<span class="linenos">11</span>
<span class="linenos">12</span>   Re-evaluation
<span class="linenos">13</span>     Evaluation rule name   : {{ labels._exastro_rule_name }}
<span class="linenos">14</span>     Event                  : {{ exastro_events }}
<span class="linenos">15</span>
<span class="linenos">16</span>   Label:
<span class="linenos">17</span>     {% for key, value in labels.items() %}
<span class="linenos">18</span>     ・{{ key }}: {{ value }}
<span class="linenos">19</span>     {% endfor %}
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="known-evaluated-j2">
<div class="code-block-caption"><span class="caption-number">リスト 2.52 </span><span class="caption-text">Known(evaluated).j2</span><a class="headerlink" href="#known-evaluated-j2" title="Link to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span> [TITLE]
<span class="linenos"> 2</span> A known(evaluated) event has occured.
<span class="linenos"> 3</span>
<span class="linenos"> 4</span> [BODY]
<span class="linenos"> 5</span> Detailed information
<span class="linenos"> 6</span>   Event ID                 : {{ _id }}
<span class="linenos"> 7</span>   Event collection settings: {{ labels._exastro_event_collection_settings_id }}
<span class="linenos"> 8</span>   Event fetch time         : {{ labels._exastro_fetched_time }}
<span class="linenos"> 9</span>   Event end time           : {{ labels._exastro_end_time }}
<span class="linenos">10</span>   Event type               : {{ labels._exastro_type }}
<span class="linenos">11</span>
<span class="linenos">12</span>   Re-evaluation
<span class="linenos">13</span>     Evaluation rule name   : {{ labels._exastro_rule_name }}
<span class="linenos">14</span>     Event                  : {{ exastro_events }}
<span class="linenos">15</span>
<span class="linenos">16</span>   Label:
<span class="linenos">17</span>     {% for key, value in labels.items() %}
<span class="linenos">18</span>     ・{{ key }}: {{ value }}
<span class="linenos">19</span>     {% endfor %}
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="known-timeout-j2">
<div class="code-block-caption"><span class="caption-number">リスト 2.53 </span><span class="caption-text">Known(timeout).j2</span><a class="headerlink" href="#known-timeout-j2" title="Link to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span> [TITLE]
<span class="linenos"> 2</span> A known(timeout) event has occured.
<span class="linenos"> 3</span>
<span class="linenos"> 4</span> [BODY]
<span class="linenos"> 5</span> Detailed information
<span class="linenos"> 6</span>   Event ID                 : {{ _id }}
<span class="linenos"> 7</span>   Event collection settings: {{ labels._exastro_event_collection_settings_id }}
<span class="linenos"> 8</span>   Event fetch time         : {{ labels._exastro_fetched_time }}
<span class="linenos"> 9</span>   Event end time           : {{ labels._exastro_end_time }}
<span class="linenos">10</span>   Event type               : {{ labels._exastro_type }}
<span class="linenos">11</span>
<span class="linenos">12</span>   Re-evaluation
<span class="linenos">13</span>     Evaluation rule name   : {{ labels._exastro_rule_name }}
<span class="linenos">14</span>     Event                  : {{ exastro_events }}
<span class="linenos">15</span>
<span class="linenos">16</span>   Label:
<span class="linenos">17</span>     {% for key, value in labels.items() %}
<span class="linenos">18</span>     ・{{ key }}: {{ value }}
<span class="linenos">19</span>     {% endfor %}
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="undetected-j2">
<div class="code-block-caption"><span class="caption-number">リスト 2.54 </span><span class="caption-text">Undetected.j2</span><a class="headerlink" href="#undetected-j2" title="Link to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span> [TITLE]
<span class="linenos"> 2</span> An unknown event has occured.
<span class="linenos"> 3</span>
<span class="linenos"> 4</span> [BODY]
<span class="linenos"> 5</span> Detailed information
<span class="linenos"> 6</span>   Event ID                 : {{ _id }}
<span class="linenos"> 7</span>   Event collection settings: {{ labels._exastro_event_collection_settings_id }}
<span class="linenos"> 8</span>   Event fetch time         : {{ labels._exastro_fetched_time }}
<span class="linenos"> 9</span>   Event end time           : {{ labels._exastro_end_time }}
<span class="linenos">10</span>   Event type               : {{ labels._exastro_type }}
<span class="linenos">11</span>
<span class="linenos">12</span>   Re-evaluation
<span class="linenos">13</span>     Evaluation rule name   : {{ labels._exastro_rule_name }}
<span class="linenos">14</span>     Event                  : {{ exastro_events }}
<span class="linenos">15</span>
<span class="linenos">16</span>   Label:
<span class="linenos">17</span>     {% for key, value in labels.items() %}
<span class="linenos">18</span>     ・{{ key }}: {{ value }}
<span class="linenos">19</span>     {% endfor %}
</pre></div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Jinja2テンプレート利用の注意点</p>
<p>Jinja2テンプレートを用いて通知設定を行う際は、以下の点にご注意ください。</p>
<ul class="simple">
<li><p>必須要素の定義: テンプレートには、通知のタイトルと本文を定義する <strong>[TITLE]</strong> および <strong>[BODY]</strong> 要素が <strong>必須</strong> です。</p></li>
<li><p>構文不足による通知失敗: 必須要素（[TITLE]または[BODY]）が不足している場合や、要素の記述に誤りがある場合、通知の実行は <strong>失敗します</strong>。</p></li>
<li><p>編集箇所: 出力内容を変更する場合は、 <strong>[TITLE] および [BODY] の要素内部のみ</strong> を編集してください。これらの要素自体を削除したり変更したりしないでください。</p></li>
<li><p>Jinja2構文の参照: テンプレート内で使用する変数や制御構文の詳細については、Jinja2の公式ドキュメントを参照してください。</p></li>
</ul>
</div>
</section>
</section>
<section id="id14">
<h2><span class="section-number">2.8. </span>付録<a class="headerlink" href="#id14" title="Link to this heading">¶</a></h2>
<section id="oase-agent-env">
<span id="oase-agent-flow"></span><h3><span class="section-number">2.8.1. </span>OASE Agentの処理フローと.envの設定値<a class="headerlink" href="#oase-agent-env" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">本項では、以下について示します。</div>
<div class="line">- OASE Agentの処理フロー</div>
<div class="line">- OASE Agentのインストール時、.envに設定した、一部の設定値について</div>
</div>
<figure class="align-default" id="id37">
<a class="reference internal image-reference" href="../../_images/agent_detailed_flow_v2-4.png"><img alt="OASE Agent フロー図" src="../../_images/agent_detailed_flow_v2-4.png" style="width: 1000px;" />
</a>
<figcaption>
<p><span class="caption-number">図 2.76 </span><span class="caption-text">OASE Agent処理フロー図</span><a class="headerlink" href="#id37" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<table class="docutils align-default">
<colgroup>
<col style="width: 41.7%" />
<col style="width: 58.3%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>パラメータ</p></th>
<th class="head"><p>説明</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>AGENT_NAME</p></td>
<td><p>起動する OASEエージェントの名前および、内部データベースのファイル名として使用されます。</p></td>
</tr>
<tr class="row-odd"><td><p>EXASTRO_URL</p></td>
<td><p>ITAに対してAPIリクエストをする際に、リクエスト先として使用されます。</p></td>
</tr>
<tr class="row-even"><td><p>EXASTRO_ORGANIZATION_ID</p></td>
<td><p>ITAに対してAPIリクエストをする際に、Organizationを識別するために使用されます。</p></td>
</tr>
<tr class="row-odd"><td><p>EXASTRO_WORKSPACE_ID</p></td>
<td><div class="line-block">
<div class="line">ITAに対してAPIリクエストをする際に、ワークスペースを識別するために使用されます。</div>
<div class="line">EXASTRO_ORGANIZATION_IDで設定したオーガナイゼーションと紐づいたワークスペースである必要があります。</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>EXASTRO_REFRESH_TOKEN</p></td>
<td><div class="line-block">
<div class="line">ITAに対してAPIリクエストをする際に、Bearer認証の認証トークンとして使用されます。</div>
<div class="line">※ユーザーのロールが、OASE - イベント - イベント履歴メニューをメンテナンス可能である必要があります。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>EXASTRO_USERNAME</p></td>
<td><div class="line-block">
<div class="line">ITAに対してAPIリクエストをする際に、Basic認証のユーザー名として使用されます。</div>
<div class="line">※ユーザーのロールが、OASE - イベント - イベント履歴メニューをメンテナンス可能である必要があります。</div>
<div class="line">※EXASTRO_REFRESH_TOKENを使わない場合（非推奨）</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>EXASTRO_PASSWORD</p></td>
<td><div class="line-block">
<div class="line">ITAに対してAPIリクエストをする際に、Basic認証のパスワードとして使用されます。</div>
<div class="line">※EXASTRO_REFRESH_TOKENを使わない場合（非推奨）</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>EVENT_COLLECTION_SETTINGS_NAMES</p></td>
<td><p>このパラメータで設定されている値から、イベント収集設定をITAから取得し、設定ファイルを生成します。</p></td>
</tr>
<tr class="row-even"><td><p>ITERATION</p></td>
<td><p>上記フロー図にて緑色の矢印で示されているループ処理を、このパラメータで設定している数だけ行います。</p></td>
</tr>
<tr class="row-odd"><td><p>EXECUTE_INTERVAL</p></td>
<td><p>上記フロー図にて緑色の矢印で示されているループ処理の実行間隔です。</p></td>
</tr>
</tbody>
</table>
</section>
<section id="id15">
<h3><span class="section-number">2.8.2. </span>イベント収集設定の即時反映について<a class="headerlink" href="#id15" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">本項では、イベント収集設定を変更した際に、OASE Agentに即時反映させる方法について説明します。</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">OASE Agentのbashシェルを開始します。</div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>&lt;OASE<span class="w"> </span>Agentのコンテナ名&gt;<span class="w"> </span>bash
</pre></div>
</div>
</li>
<li><div class="line-block">
<div class="line">設定ファイル「event_collection_settings.json」を削除します。</div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>rm<span class="w"> </span>/tmp/&lt;EXASTRO_ORGANIZATION_ID&gt;/&lt;EXASTRO_WORKSPACE_ID&gt;/&lt;AGENT_NAME&gt;/event_collection_settings.json
</pre></div>
</div>
</li>
</ol>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<div class="line-block">
<div class="line">OASE Agentでは、設定ファイル「event_collection_settings.json」が存在しない場合、ITAからイベント収集設定を取得し、設定ファイルを作成します。</div>
<div class="line">設定ファイルを削除することで最新の設定を反映させることができます。</div>
<div class="line">※この操作を行わない場合、<a class="reference internal" href="#oase-agent-flow"><span class="std std-ref">前項</span></a> で示した「ITERATION」の数だけループする処理が終了するまで、変更後の設定が反映されません。</div>
</div>
</div>
</section>
<section id="about-decode">
<span id="id16"></span><h3><span class="section-number">2.8.3. </span>エージェントのデコード処理について<a class="headerlink" href="#about-decode" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">収集先がメールの場合の、収集イベントに対するエージェントのデコード処理に関しては以下のとおりです。</div>
</div>
<section id="id17">
<h4>動作確認済み文字コード<a class="headerlink" href="#id17" title="Link to this heading">¶</a></h4>
<table class="docutils align-left" id="id38">
<caption><span class="caption-number">表 2.94 </span><span class="caption-text">動作確認済み文字コード</span><a class="headerlink" href="#id38" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 14.3%" />
<col style="width: 14.3%" />
<col style="width: 28.6%" />
<col style="width: 42.9%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p><strong>送信方法</strong></p></th>
<th class="head" colspan="2"><p><strong>メールのHeader</strong></p></th>
</tr>
<tr class="row-even"><th class="head"><p><strong>形式</strong></p></th>
<th class="head"><p><strong>言語</strong></p></th>
<th class="head"><p><strong>Content-Transfer-Encoding</strong></p></th>
<th class="head"><p><strong>Content-Type</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-odd"><td><p>plaintext</p></td>
<td><p>英語</p></td>
<td><p>7bit</p></td>
<td><p>text/plain; charset=US-ASCII</p></td>
</tr>
<tr class="row-even"><td><p>plaintext</p></td>
<td><p>日本語</p></td>
<td><p>8bit</p></td>
<td><p>text/plain; charset=UTF-8</p></td>
</tr>
<tr class="row-odd"><td><p>plaintext</p></td>
<td><p>英語</p></td>
<td><p>8bit</p></td>
<td><p>text/plain; charset=&quot;ANSI_X3.4-1968&quot;</p></td>
</tr>
<tr class="row-even"><td><p>html</p></td>
<td><p>英語</p></td>
<td><p>・plaintext: 7bit</p>
<p>・html: quoted-printable</p>
</td>
<td><p>multipart/alternative</p>
<p>・plaintext: text/plain; charset=US-ASCII</p>
<p>・html: text/html; charset=UTF-8</p>
</td>
</tr>
<tr class="row-odd"><td><p>html</p></td>
<td><p>日本語</p></td>
<td><p>・plaintext: 8bit</p>
<p>・html: quoted-printable</p>
</td>
<td><p>multipart/alternative</p>
<p>・plaintext: text/plain; charset=UTF-8</p>
<p>・html: text/html; charset=UTF-8</p>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line">デコードできない文字を省いて収集イベントを保存する場合の処理の例に関しては、以下のとおりです。</div>
</div>
<dl>
<dt>送信するメール</dt><dd><div class="line-block">
<div class="line">形式：plaintext</div>
<div class="line">Content-Transfer-Encoding：8bit</div>
<div class="line">Content-Type：text/plain; charset=&quot;ANSI_X3.4-1968&quot;</div>
<div class="line">件名：障害</div>
<div class="line">内容：障害：Server01\r\n</div>
</div>
</dd>
<dt>ITAの画面で見た場合</dt><dd><div class="line-block">
<div class="line">件名：障害</div>
<div class="line">内容：Server01\r\n</div>
</div>
</dd>
</dl>
<figure class="align-default" id="id39">
<a class="reference internal image-reference" href="../../_images/decode_failed.png"><img alt="デコードできない文字を省いて収集イベントを行う例・結果（イベントフロー）" src="../../_images/decode_failed.png" style="width: 800px;" />
</a>
<figcaption>
<p><span class="caption-number">図 2.77 </span><span class="caption-text">デコードできない文字を省いて収集イベントを行う例・結果（イベントフロー）</span><a class="headerlink" href="#id39" title="Link to this image">¶</a></p>
<div class="legend">
</div>
</figcaption>
</figure>
</section>
</section>
<section id="oase-agent-respons-key-enevnt-id-key">
<span id="id"></span><h3><span class="section-number">2.8.4. </span>レスポンスキーとイベントIDキー<a class="headerlink" href="#oase-agent-respons-key-enevnt-id-key" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">本項では、 下記について説明します。</div>
</div>
<div class="line-block">
<div class="line">・ <em class="dfn">レスポンスキー</em></div>
<div class="line">・ <em class="dfn">JMESPath</em></div>
<div class="line">・ <em class="dfn">レスポンスリストフラグ</em></div>
<div class="line">・ <em class="dfn">イベントIDキー</em></div>
</div>
<section id="id18">
<h4>レスポンスキー<a class="headerlink" href="#id18" title="Link to this heading">¶</a></h4>
<div class="line-block">
<div class="line">レスポンスのペイロードから、イベントを抽出すためのキーを <em class="dfn">レスポンスキー</em> といいます。</div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">・監視ソフトは、監視対象マシンで発出されたアラートやメトリックス（状態）をHTTP APIで取得できる機能があり、</div>
<div class="line">・エージェントは、そのHTTP APIを利用して、アラートやメトリックスを取得します。</div>
<div class="line">・但し、監視ソフトが返却するレスポンスのぺーロードが、JSON形式のみ、エージェントは処理対象とします。</div>
</div>
</div>
<div class="line-block">
<div class="line"><em class="dfn">レスポンスキー</em> として指定できる項目は、</div>
</div>
<div class="line-block">
<div class="line">　・レスポンスのペイロードで、イベントとして取り扱う項目を、子要素に格納していること。</div>
<div class="line">　・イベントとして取り扱う項目が、複数ある場合、子要素を配列で、格納していること。</div>
</div>
<div class="line-block">
<div class="line"><em class="dfn">レスポンスキー</em> は、 <em class="dfn">JMESPath形式</em> で指定します。</div>
<div class="line"><em class="dfn">JMESPath形式</em>  については、次項を参照してください。</div>
</div>
</section>
<section id="jmespath">
<h4>JMESPath<a class="headerlink" href="#jmespath" title="Link to this heading">¶</a></h4>
<div class="line-block">
<div class="line"><em class="dfn">JMESPath</em> は、JSONを対象としたクエリ言語です。</div>
<div class="line">JSONから、指定した <em class="dfn">JMESPath</em> に該当する値を抽出します。</div>
<div class="line">書式は、JSONキーを、&quot;.&quot;ドットで結合したパスで指定します。</div>
<div class="line">また、JSONキーの値が配列の場合、&quot;[]&quot;をJSONキーの後ろに付けます。</div>
<div class="line">　例） <strong class="program">parent</strong> の値が配列で、配列の子要素のキー <strong class="program">children</strong> の値を抽出する場合、</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">parent</span><span class="p">[]</span><span class="o">.</span><span class="n">children</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">　と指定します。</div>
</div>
<div class="line-block">
<div class="line">JMESPathの指定方法について、</div>
<div class="line">Azure RESET-API <a class="reference external" href="https://learn.microsoft.com/ja-jp/rest/api/monitor/metrics/list?view=rest-monitor-2023-10-01&amp;tabs=HTTP">Get Metric for data</a> のSample Responseの一部を利用して説明します。</div>
</div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">{</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="nt">&quot;cost&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">598</span><span class="p">,</span>
<span class="linenos"> 3</span><span class="w">  </span><span class="nt">&quot;timespan&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2021-04-20T09:00:00Z/2021-04-20T14:00:00Z&quot;</span><span class="p">,</span>
<span class="linenos"> 4</span><span class="w">  </span><span class="nt">&quot;interval&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PT1H&quot;</span><span class="p">,</span>
<span class="linenos"> 5</span><span class="w">  </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos"> 6</span><span class="w">    </span><span class="p">{</span>
<span class="linenos"> 7</span><span class="w">      </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/subscriptions/1f3･･･c38/･･･/metrics/BlobCount&quot;</span><span class="p">,</span>
<span class="linenos"> 8</span><span class="w">      </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Microsoft.Insights/metrics&quot;</span><span class="p">,</span>
<span class="linenos"> 9</span><span class="w">      </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">10</span><span class="w">        </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;BlobCount&quot;</span><span class="p">,</span>
<span class="linenos">11</span><span class="w">        </span><span class="nt">&quot;localizedValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Blob Count&quot;</span>
<span class="linenos">12</span><span class="w">      </span><span class="p">},</span>
<span class="linenos">13</span><span class="w">      </span><span class="nt">&quot;displayDescription&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The number of blob objects stored in the storage account.&quot;</span><span class="p">,</span>
<span class="linenos">14</span><span class="w">      </span><span class="nt">&quot;unit&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Count&quot;</span><span class="p">,</span>
<span class="linenos">15</span><span class="w">      </span><span class="nt">&quot;timeseries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos">16</span><span class="w">        </span><span class="p">{</span>
<span class="linenos">17</span><span class="w">          </span><span class="nt">&quot;metadatavalues&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos">18</span><span class="w">            </span><span class="p">{</span>
<span class="linenos">19</span><span class="w">              </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">20</span><span class="w">                </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tier&quot;</span><span class="p">,</span>
<span class="linenos">21</span><span class="w">                </span><span class="nt">&quot;localizedValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tier&quot;</span>
<span class="linenos">22</span><span class="w">              </span><span class="p">},</span>
<span class="linenos">23</span><span class="w">              </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Hot&quot;</span>
<span class="linenos">24</span><span class="w">            </span><span class="p">}</span>
<span class="linenos">25</span><span class="w">          </span><span class="p">]</span>
<span class="linenos">26</span><span class="w">        </span><span class="p">},</span>
<span class="linenos">27</span><span class="w">        </span><span class="p">{</span>
<span class="linenos">28</span><span class="w">          </span><span class="nt">&quot;metadatavalues&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos">29</span><span class="w">            </span><span class="p">{</span>
<span class="linenos">30</span><span class="w">              </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">31</span><span class="w">                </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tier&quot;</span><span class="p">,</span>
<span class="linenos">32</span><span class="w">                </span><span class="nt">&quot;localizedValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tier&quot;</span>
<span class="linenos">33</span><span class="w">              </span><span class="p">},</span>
<span class="linenos">34</span><span class="w">              </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Standard&quot;</span>
<span class="linenos">35</span><span class="w">            </span><span class="p">}</span>
<span class="linenos">36</span><span class="w">          </span><span class="p">]</span>
<span class="linenos">37</span><span class="w">        </span><span class="p">},</span>
<span class="linenos">38</span><span class="w">        </span><span class="p">{</span>
<span class="linenos">39</span><span class="w">          </span><span class="nt">&quot;metadatavalues&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos">40</span><span class="w">            </span><span class="p">{</span>
<span class="linenos">41</span><span class="w">              </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">42</span><span class="w">                </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tier&quot;</span><span class="p">,</span>
<span class="linenos">43</span><span class="w">                </span><span class="nt">&quot;localizedValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tier&quot;</span>
<span class="linenos">44</span><span class="w">              </span><span class="p">},</span>
<span class="linenos">45</span><span class="w">              </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Cool&quot;</span>
<span class="linenos">46</span><span class="w">            </span><span class="p">}</span>
<span class="linenos">47</span><span class="w">          </span><span class="p">]</span>
<span class="linenos">48</span><span class="w">        </span><span class="p">}</span>
<span class="linenos">49</span><span class="w">      </span><span class="p">],</span>
<span class="linenos">50</span><span class="w">      </span><span class="nt">&quot;errorCode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Success&quot;</span>
<span class="linenos">51</span><span class="w">    </span><span class="p">}</span>
<span class="linenos">52</span><span class="w">  </span><span class="p">],</span>
<span class="linenos">53</span><span class="w">  </span><span class="nt">&quot;namespace&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;microsoft.storage/storageaccounts/blobservices&quot;</span><span class="p">,</span>
<span class="linenos">54</span><span class="w">  </span><span class="nt">&quot;resourceregion&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;westus2&quot;</span>
<span class="linenos">55</span><span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line"><em class="dfn">JMESPath</em> の詳細については、JMESPath  Tutorial <a class="reference external" href="https://JMESPath.org/tutorial.html">https://JMESPath.org/tutorial.html</a> を参照してください。</div>
<div class="line">また、上記JSONを、 <em class="dfn">JMESPath</em> を試すことのできる、JMESPath Try it Out! <a class="reference external" href="https://JMESPath.org/">https://JMESPath.org/</a> で試してください。</div>
</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">配列の値を取得するJMESPath</div>
</div>
</li>
</ol>
<div class="line-block">
<div class="line">上記JSONで、5行目の <strong class="program">value</strong> の値（配列）を取得する <em class="dfn">JMESPath</em> を、</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">value</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">と指定すると、下記の結果が取得できます。</div>
<div class="line">（コード中の <strong class="program">&quot;//&quot; : &quot;･･･Sample Responseの14行～49行まで省略･･･&quot;</strong>  はコメントです。実際の結果には含まれません。）</div>
</div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/subscriptions/1f3･･･c38/･･･/metrics/BlobCount&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Microsoft.Insights/metrics&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;BlobCount&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;localizedValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Blob Count&quot;</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nt">&quot;displayDescription&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The number of blob objects stored in the storage account.&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;//&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;･･･Sample Responseの14行～49行まで省略･･･&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;errorCode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Success&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">オブジェクトを取得するJMESPath</div>
</div>
</li>
</ol>
<div class="line-block">
<div class="line">上記JSONで、9行目の <strong class="program">value</strong> (配列) の <strong class="program">name</strong> の値を取得する <em class="dfn">JMESPath</em> を、</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">value</span><span class="p">[]</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">と指定すると、下記の結果が取得できます。</div>
</div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;BlobCount&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;localizedValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Blob Count&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">深い階層で、複数の値を取得するJMESPath</div>
</div>
</li>
</ol>
<div class="line-block">
<div class="line"><strong class="program">value</strong> (配列)の <strong class="program">timeseries</strong> (配列)の <strong class="program">metadatavalues</strong> (配列)の <strong class="program">name</strong> を取得する <em class="dfn">JMESPath</em> を、</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">value</span><span class="p">[]</span><span class="o">.</span><span class="n">timeseries</span><span class="p">[]</span><span class="o">.</span><span class="n">metadatavalues</span><span class="p">[]</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">と指定すると下記の結果が取得できます。</div>
<div class="line">（コード中の <strong class="program">&quot;//&quot; : &quot;xx行の metadatavalues.name&quot;</strong>  はコメントです。実際の結果には含まれません。）</div>
</div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">[</span>
<span class="w">  </span><span class="nt">&quot;//&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;19行の metadatavalues.name&quot;</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tier&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;localizedValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tier&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;//&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;30行の metadatavalues.name&quot;</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tier&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;localizedValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tier&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;//&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;41行の metadatavalues.name&quot;</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tier&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;localizedValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tier&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</section>
<section id="id19">
<h4>レスポンスリストフラグ<a class="headerlink" href="#id19" title="Link to this heading">¶</a></h4>
<div class="line-block">
<div class="line"><em class="dfn">レスポンスリストフラグ</em> は、 <em class="dfn">レスポンスキー</em> で抽出したイベントが、配列で格納されているかを指定します。</div>
</div>
<div class="line-block">
<div class="line">・<strong class="program">True</strong>  ： <em class="dfn">レスポンスキー</em> で抽出したイベントが、配列で格納されている場合</div>
<div class="line">　　　　　　上記の 1. 配列の値を取得するJMESPat や、3. 深い階層で、複数の値を取得するJMESPath の様な場合</div>
<div class="line">・<strong class="program">False</strong> ： <em class="dfn">レスポンスキー</em> で抽出したイベントが、配列以外（値や、子要素を持つオブジェクト）で格納されている場合</div>
<div class="line">　　　　　　上記の 2. オブジェクトを取得するJMESPath の様な場合</div>
</div>
</section>
<section id="id20">
<h4>イベントIDキー<a class="headerlink" href="#id20" title="Link to this heading">¶</a></h4>
<div class="line-block">
<div class="line"><em class="dfn">レスポンスキー</em> を利用して抽出したイベントで、イベントをユニークに判別する値を取得するキーを <em class="dfn">イベントIDキー</em> で指定します。</div>
<div class="line"><em class="dfn">イベントIDキー</em> は、 <em class="dfn">レスポンスキー</em> で抽出した結果に存在するキーを指定します。</div>
</div>
<div class="line-block">
<div class="line"><em class="dfn">イベントIDキー</em> も、 <em class="dfn">JMESPath形式</em> で指定します。</div>
<div class="line">上記Azure RESET-APIのJSONで、 <em class="dfn">レスポンスキー</em> と <em class="dfn">レスポンスリストフラグ</em> を、下記の通り指定した場合、</div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 50.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項目名</p></th>
<th class="head"><p>設定値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>レスポンスキー</p></td>
<td><p><strong class="program">value</strong></p></td>
</tr>
<tr class="row-odd"><td><p>レスポンスリストフラグ</p></td>
<td><p><strong class="program">True</strong></p></td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><em class="dfn">レスポンスキー</em> で抽出した値は、</div>
</div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">[</span>
<span class="linenos"> 2</span><span class="w">  </span><span class="p">{</span>
<span class="linenos"> 3</span><span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;/subscriptions/1f3･･･c38/･･･/metrics/BlobCount&quot;</span><span class="p">,</span>
<span class="linenos"> 4</span><span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Microsoft.Insights/metrics&quot;</span><span class="p">,</span>
<span class="linenos"> 5</span><span class="w">    </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 6</span><span class="w">      </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;BlobCount&quot;</span><span class="p">,</span>
<span class="linenos"> 7</span><span class="w">      </span><span class="nt">&quot;localizedValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Blob Count&quot;</span>
<span class="linenos"> 8</span><span class="w">    </span><span class="p">},</span>
<span class="linenos"> 9</span><span class="w">    </span><span class="nt">&quot;displayDescription&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The number of blob objects stored in the storage account.&quot;</span><span class="p">,</span>
<span class="linenos">10</span><span class="w">    </span><span class="nt">&quot;unit&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Count&quot;</span><span class="p">,</span>
<span class="linenos">11</span><span class="w">    </span><span class="nt">&quot;timeseries&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos">12</span><span class="w">      </span><span class="p">{</span>
<span class="linenos">13</span><span class="w">        </span><span class="nt">&quot;metadatavalues&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos">14</span><span class="w">          </span><span class="p">{</span>
<span class="linenos">15</span><span class="w">            </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos">16</span><span class="w">              </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tier&quot;</span><span class="p">,</span>
<span class="linenos">17</span><span class="w">              </span><span class="nt">&quot;localizedValue&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tier&quot;</span>
<span class="linenos">18</span><span class="w">            </span><span class="p">},</span>
<span class="linenos">19</span><span class="w">            </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Hot&quot;</span>
<span class="linenos">20</span><span class="w">          </span><span class="p">}</span>
<span class="linenos">21</span><span class="w">        </span><span class="p">]</span>
<span class="linenos">22</span><span class="w">      </span><span class="p">},</span>
<span class="linenos">23</span><span class="w">      </span><span class="nt">&quot;//&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;･･･（metadatavaluesの繰り返しなので省略）･･･&quot;</span>
<span class="linenos">24</span><span class="w">    </span><span class="p">],</span>
<span class="linenos">25</span><span class="w">    </span><span class="nt">&quot;errorCode&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Success&quot;</span>
<span class="linenos">26</span><span class="w">  </span><span class="p">}</span>
<span class="linenos">27</span><span class="p">]</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">となり、この結果から、イベントとして識別する値は、<strong class="program">id</strong> の値が適しているため、</div>
<div class="line-block">
<div class="line"><span class="menuselection">OASE管理 ▶ イベント収集</span> での設定値は、下記の設定が適切です。</div>
</div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 33.3%" />
<col style="width: 66.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項目名</p></th>
<th class="head"><p>設定値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>レスポンスキー</p></td>
<td><p><strong class="program">value</strong></p></td>
</tr>
<tr class="row-odd"><td><p>レスポンスリストフラグ</p></td>
<td><p><strong class="program">True</strong></p></td>
</tr>
<tr class="row-even"><td><p>イベントIDキー</p></td>
<td><p><strong class="program">id</strong></p></td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line"><em class="dfn">レスポンスキー</em> で抽出した値に存在しないキーを指定すると、空の値を取得することになり、正しく動作しません。</div>
<div class="line">例えば、上記 <em class="dfn">レスポンスキー</em> で抽出した値に存在しないキー <strong class="program">value</strong> を指定した場合、正しく動作しません。</div>
</div>
<table class="docutils align-default" id="id40">
<caption><span class="caption-number">表 2.95 </span><span class="caption-text">正しくない、イベントIDキーの設定</span><a class="headerlink" href="#id40" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 33.3%" />
<col style="width: 66.7%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項目名</p></th>
<th class="head"><p>設定値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>レスポンスキー</p></td>
<td><p><strong class="program">value</strong></p></td>
</tr>
<tr class="row-odd"><td><p>レスポンスリストフラグ</p></td>
<td><p><strong class="program">True</strong></p></td>
</tr>
<tr class="row-even"><td><p>イベントIDキー</p></td>
<td><p><strong class="program">value[].id</strong></p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="oase-agent-settings">
<span id="id21"></span><h3><span class="section-number">2.8.5. </span>監視ソフト毎のイベント収集設定例<a class="headerlink" href="#oase-agent-settings" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">本項では、代表的な監視ソフト <em class="dfn">Zabbix</em> と <em class="dfn">Grafana</em> をイベント収集で利用する場合の、 <span class="menuselection">OASE管理 ▶ イベント収集</span> での設定例について説明します。</div>
</div>
<div class="line-block">
<div class="line">また、本項では、まず、各監視ソフトのアラートを、cURLコマンドで取得する例を示し、</div>
<div class="line">次に、cURLのパラメータを、 <span class="menuselection">OASE管理 ▶ イベント収集</span> に設定する順番で説明します。</div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line">監視ソフトののバージョンによって、HTTP APIの仕様が異なる場合があります。</div>
<div class="line">利用するバージョンのHTTP APIの仕様を確認し、 <span class="menuselection">OASE管理 ▶ イベント収集</span> の設定を行ってください。</div>
</div>
</div>
<section id="zabbix">
<h4>Zabbix<a class="headerlink" href="#zabbix" title="Link to this heading">¶</a></h4>
<div class="line-block">
<div class="line"><em class="dfn">Zabbix</em> から、イベントを取得する、 <span class="menuselection">OASE管理 ▶ イベント収集</span> での設定例について説明します。</div>
</div>
<div class="line-block">
<div class="line">以下の説明で使用した、<em class="dfn">Zabbix</em> は、</div>
<div class="line">・zabbix 6.4.12</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">cURLコマンドで、 <em class="dfn">Zabbix</em> から、イベント取得</div>
</div>
</li>
</ol>
<div class="line-block">
<div class="line">下記は、 <em class="dfn">Zabbix</em> から、障害（problem）を取得するcURLコマンドの例です。</div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>--request<span class="w"> </span>POST<span class="w"> </span><span class="se">\</span>
--url<span class="w"> </span>http://&lt;ZabbixのIP<span class="w"> </span>Address<span class="w"> </span>か<span class="w"> </span>Domain&gt;/zabbix/api_jsonrpc.php<span class="w"> </span><span class="se">\</span>
--header<span class="w"> </span><span class="s1">&#39;content-type: application/json-rpc&#39;</span><span class="w"> </span><span class="se">\</span>
--data<span class="w"> </span><span class="s2">&quot;{\&quot;jsonrpc\&quot;: \&quot;2.0\&quot;,\&quot;method\&quot;: \&quot;problem.get\&quot;,\&quot;id\&quot;: 1,\&quot;params\&quot;: {},\&quot;auth\&quot;: \&quot;&lt;Zabbix APIトークン&gt;&quot;</span><span class="o">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">（コマンド・パラメータ中の &lt;Zabbix APIトークン&gt; の詳細は、後述します。）</div>
</div>
<div class="line-block">
<div class="line">上記cURLコマンドで、下記の様なレスポンスが返却されます。</div>
</div>
<div class="highlight-json notranslate" id="oase-agent-zabbix-responss"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">{</span>
<span class="linenos"> 2</span><span class="w">   </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
<span class="linenos"> 3</span><span class="w">   </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos"> 4</span><span class="w">       </span><span class="p">{</span>
<span class="linenos"> 5</span><span class="w">           </span><span class="nt">&quot;eventid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;89&quot;</span><span class="p">,</span>
<span class="linenos"> 6</span><span class="w">           </span><span class="nt">&quot;source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
<span class="linenos"> 7</span><span class="w">           </span><span class="nt">&quot;object&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
<span class="linenos"> 8</span><span class="w">           </span><span class="nt">&quot;objectid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;16046&quot;</span><span class="p">,</span>
<span class="linenos"> 9</span><span class="w">           </span><span class="nt">&quot;clock&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1709636653&quot;</span><span class="p">,</span>
<span class="linenos">10</span><span class="w">           </span><span class="nt">&quot;ns&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;906955445&quot;</span><span class="p">,</span>
<span class="linenos">11</span><span class="w">           </span><span class="nt">&quot;r_eventid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
<span class="linenos">12</span><span class="w">           </span><span class="nt">&quot;r_clock&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
<span class="linenos">13</span><span class="w">           </span><span class="nt">&quot;r_ns&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
<span class="linenos">14</span><span class="w">           </span><span class="nt">&quot;correlationid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
<span class="linenos">15</span><span class="w">           </span><span class="nt">&quot;userid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
<span class="linenos">16</span><span class="w">           </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;High CPU utilization (over 90% for 5m)&quot;</span><span class="p">,</span>
<span class="linenos">17</span><span class="w">           </span><span class="nt">&quot;acknowledged&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
<span class="linenos">18</span><span class="w">           </span><span class="nt">&quot;severity&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2&quot;</span><span class="p">,</span>
<span class="linenos">19</span><span class="w">           </span><span class="nt">&quot;opdata&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Current utilization: 100 %&quot;</span><span class="p">,</span>
<span class="linenos">20</span><span class="w">           </span><span class="nt">&quot;suppressed&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
<span class="linenos">21</span><span class="w">           </span><span class="nt">&quot;urls&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[]</span>
<span class="linenos">22</span><span class="w">       </span><span class="p">}</span>
<span class="linenos">23</span><span class="w">   </span><span class="p">],</span>
<span class="linenos">24</span><span class="w">   </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="linenos">25</span><span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line"><em class="dfn">Zabbix</em> の、障害（problem）に関する詳細は下記URLをご参照ください。</div>
<div class="line-block">
<div class="line"><a class="reference external" href="https://www.zabbix.com/documentation/current/jp/manual/api/reference/problem/get">https://www.zabbix.com/documentation/current/jp/manual/api/reference/problem/get</a></div>
</div>
</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><em class="dfn">Zabbix</em> からイベントを取得する、イベント収集の設定例</div>
</div>
</li>
</ol>
<div class="line-block">
<div class="line">上記のcURLコマンドを参考に、同等な取得を行う、 <span class="menuselection">OASE管理 ▶ イベント収集</span> の設定値は、下記の様に設定します。</div>
</div>
<table class="docutils align-left" id="id41">
<caption><span class="caption-number">表 2.96 </span><span class="caption-text">Zabbixの設定例</span><a class="headerlink" href="#id41" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 25.0%" />
<col style="width: 75.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項目名</p></th>
<th class="head"><p>設定値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>イベント収集名</p></td>
<td><p>&lt;Zabbix障害取得と分かる名称&gt;</p></td>
</tr>
<tr class="row-odd"><td><p>接続方式</p></td>
<td><p>任意の認証</p></td>
</tr>
<tr class="row-even"><td><p>リクエストメソッド</p></td>
<td><p>POST</p></td>
</tr>
<tr class="row-odd"><td><p>接続先</p></td>
<td><div class="line-block">
<div class="line"><a class="reference external" href="http:/">http:/</a>/&lt;ZabbixのIP Address か Domain&gt;/zabbix/api_jsonrpc.php</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>リクエストヘッダー</p></td>
<td><div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;content-type&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;application/json-rpc&quot;</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>パラメータ</p></td>
<td><div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="s2">&quot;problem.get&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;params&quot;</span><span class="p">:{</span>
<span class="w">      </span><span class="nt">&quot;time_from&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{{ EXASTRO_LAST_FETCHED_TIMESTAMP }}&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;auth&quot;</span><span class="p">:</span><span class="s2">&quot;&lt;Zabbix APIトークン&gt;&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>レスポンスキー</p></td>
<td><p>result</p></td>
</tr>
<tr class="row-odd"><td><p>レスポンスリストフラグ</p></td>
<td><p>True</p></td>
</tr>
<tr class="row-even"><td><p>イベントIDキー</p></td>
<td><p>eventid</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line"><span class="menuselection">パラメータ</span> で設定している、&lt;Zabbix APIトークン&gt;は、Zabbixユーザーの認証情報で、</div>
<div class="line">下記のコマンドで、ユーザー情報を指定して取得できます。</div>
<div class="line">但し、下記のコマンドを実行すると、既に存在するユーザーで作成済みの&lt;Zabbix APIトークン&gt;が使用できなる場合があります。</div>
<div class="line">対応として、新しいユーザーを作成し、新しいユーザーで&lt;Zabbix APIトークン&gt;を作成することをお勧めします。</div>
</div>
<div class="line-block">
<div class="line">新しいユーザーの作成は、</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">ブラウザで、<em class="dfn">Zabbix</em> に管理者でサイイン</div>
<div class="line">　初期状態の管理者のログイン情報は、</div>
<div class="line">　　・ユーザー名： Admin</div>
<div class="line">　　・パスワード： zabbix</div>
</div>
</li>
<li><div class="line-block">
<div class="line">サイドメニュー  &gt; ユーザー &gt; ユーザー を選択</div>
</div>
</li>
<li><div class="line-block">
<div class="line">ユーザーの右端上の <span class="guilabel">ユーザーの作成</span> をクリック</div>
</div>
</li>
<li><div class="line-block">
<div class="line">ユーザー名、パスワードなどを入力</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel">権限</span> タブをクリックし</div>
</div>
</li>
<li><div class="line-block">
<div class="line">ユーザーの役割 で、<span class="guilabel">選択</span> をクリックし、</div>
<div class="line">APIへのアクセスが、有効な役割を持つ、&quot;User role&quot;か、それ以上の役割を選択</div>
</div>
</li>
<li><div class="line-block">
<div class="line">その他の必要な項目を入力し</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel">追加</span> をクリック</div>
</div>
</li>
</ol>
<div class="line-block">
<div class="line">以上の操作で、ユーザーが作成できます。</div>
</div>
<div class="line-block">
<div class="line">以降は、&lt;APIトークン&gt;を作成するコマンドの例です。</div>
<div class="line"><em class="dfn">Zabbix</em> へのログイン情報が、下記の場合の例です。</div>
<div class="line">　・ユーザー名 : 上記の操作で作成したユーザーの &lt;ユーザー名&gt;</div>
<div class="line">　・パスワード : 上記の操作で作成したユーザーの &lt;パスワード&gt;</div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>--request<span class="w"> </span>POST<span class="w"> </span><span class="se">\</span>
--url<span class="w"> </span>http://&lt;ZabbixのIP<span class="w"> </span>Address<span class="w"> </span>か<span class="w"> </span>Domain&gt;/zabbix/api_jsonrpc.php<span class="w"> </span><span class="se">\</span>
--header<span class="w"> </span><span class="s2">&quot;Content-Type: application/json-rpc&quot;</span><span class="w"> </span><span class="se">\</span>
--data<span class="w"> </span><span class="s2">&quot;{\&quot;auth\&quot;:null,\&quot;method\&quot;:\&quot;user.login\&quot;,\&quot;id\&quot;:1,\&quot;params\&quot;:{\&quot;user\&quot;:\&quot;&lt;ユーザー名&gt;\&quot;,\&quot;password\&quot;:\&quot;&lt;パスワード&gt;\&quot;},\&quot;jsonrpc\&quot;:\&quot;2.0\&quot;}&quot;</span><span class="w"> </span><span class="se">\</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">上記cURLコマンドで、下記の様なレスポンスが返却されます。</div>
</div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="p">{</span>
<span class="linenos">2</span><span class="w">    </span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span>
<span class="linenos">3</span><span class="w">     </span><span class="nt">&quot;result&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&lt;Zabbix APIトークン&gt;&quot;</span><span class="p">,</span>
<span class="linenos">4</span><span class="w">     </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span>
<span class="linenos">5</span><span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">&lt;Zabbix APIトークン&gt;を、  <span class="menuselection">OASE管理 ▶ イベント収集</span> の <span class="menuselection">パラメータ</span> の &lt;Zabbix APIトークン&gt; の箇所に貼り付けます。</div>
<div class="line">※ &lt;Zabbix APIトークン&gt;作成は、ブラウザでもを作成できます。</div>
<div class="line">ブラウザでログイン後、サイドメニュー &gt; ユーザー設定 &gt; APIトークン の <span class="guilabel">APIトークンの作成</span> で作成できます。</div>
</div>
</div>
</section>
<section id="grafana">
<h4>Grafana<a class="headerlink" href="#grafana" title="Link to this heading">¶</a></h4>
<div class="line-block">
<div class="line"><em class="dfn">Grafana</em> で、イベントを取得するための、 <span class="menuselection">OASE管理 ▶ イベント収集</span> での設定例について説明します。</div>
</div>
<div class="line-block">
<div class="line">以下の説明で使用した、<em class="dfn">Grafana</em> は、</div>
<div class="line">・Grafan 10.3</div>
<div class="line">・データソースに、Prometheus 2.49 を使用</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">cURLコマンドで、 <em class="dfn">Grafana</em> から、イベント取得</div>
</div>
</li>
</ol>
<div class="line-block">
<div class="line">下記は、<em class="dfn">Grafana</em> から、アラート（alerts）を取得するcURLコマンドの例です。</div>
</div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>--request<span class="w"> </span>GET<span class="w"> </span><span class="se">\</span>
--url<span class="w"> </span><span class="s1">&#39;http://&lt;GrafanaのIP addres か Domain&gt;:3000/api/prometheus/grafana/api/v1/alerts&#39;</span><span class="w"> </span><span class="se">\</span>
--header<span class="w"> </span><span class="s1">&#39;authorization: Bearer &lt;認証トークン&gt;&#39;</span><span class="w"> </span><span class="se">\</span>
--header<span class="w"> </span><span class="s1">&#39;Content-Type: application/json&#39;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">（コマンド・パラメータ中の &lt;認証トークン&gt; の詳細は、後述します。）</div>
</div>
<div class="line-block">
<div class="line">上記cURLコマンドで、下記の様なレスポンスが返却されます。</div>
</div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">{</span>
<span class="linenos"> 2</span><span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 3</span><span class="w">        </span><span class="nt">&quot;alerts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="linenos"> 4</span><span class="w">            </span><span class="p">{</span>
<span class="linenos"> 5</span><span class="w">                </span><span class="nt">&quot;activeAt&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2018-07-04T20:27:12.60602144+02:00&quot;</span><span class="p">,</span>
<span class="linenos"> 6</span><span class="w">                </span><span class="nt">&quot;annotations&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span>
<span class="linenos"> 7</span><span class="w">                </span><span class="nt">&quot;labels&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="linenos"> 8</span><span class="w">                    </span><span class="nt">&quot;alertname&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-alert&quot;</span>
<span class="linenos"> 9</span><span class="w">                </span><span class="p">},</span>
<span class="linenos">10</span><span class="w">                </span><span class="nt">&quot;state&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;firing&quot;</span><span class="p">,</span>
<span class="linenos">11</span><span class="w">                </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1e+00&quot;</span>
<span class="linenos">12</span><span class="w">            </span><span class="p">}</span>
<span class="linenos">13</span><span class="w">        </span><span class="p">]</span>
<span class="linenos">14</span><span class="w">    </span><span class="p">},</span>
<span class="linenos">15</span><span class="w">    </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;success&quot;</span>
<span class="linenos">16</span><span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">Grafanaの、アラート（Alert）に関する詳細は下記URLをご参照ください。</div>
<div class="line-block">
<div class="line"><a class="reference external" href="https://prometheus.io/docs/prometheus/latest/querying/api/#alerts">https://prometheus.io/docs/prometheus/latest/querying/api/#alerts</a></div>
</div>
</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><em class="dfn">Grafana</em> からイベントを取得する、イベント収集の設定例</div>
</div>
</li>
</ol>
<div class="line-block">
<div class="line">上記cURLコマンドを参考に、同等な取得を行う、 <span class="menuselection">OASE管理 ▶ イベント収集</span> の設定値は、下記の様に設定します。</div>
</div>
<table class="docutils align-left" id="id42">
<caption><span class="caption-number">表 2.97 </span><span class="caption-text">Grafanaの設定例</span><a class="headerlink" href="#id42" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 25.0%" />
<col style="width: 75.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項目名</p></th>
<th class="head"><p>設定値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>イベント収集名</p></td>
<td><p>&lt;Grafanaアラート取得と分かる名称&gt;</p></td>
</tr>
<tr class="row-odd"><td><p>接続方式</p></td>
<td><p>Bearer認証</p></td>
</tr>
<tr class="row-even"><td><p>リクエストメソッド</p></td>
<td><p>GET</p></td>
</tr>
<tr class="row-odd"><td><p>接続先</p></td>
<td><div class="line-block">
<div class="line"><a class="reference external" href="http:/">http:/</a>/&lt;GrafanaのIP addres か Domain&gt;:3000/api/prometheus/grafana/api/v1/rules</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>リクエストヘッダー</p></td>
<td><div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"> </span><span class="nt">&quot;Content-Type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>認証トークン</p></td>
<td><p>&lt;認証トークン&gt;</p></td>
</tr>
<tr class="row-even"><td><p>レスポンスキー</p></td>
<td><p>data.alerts</p></td>
</tr>
<tr class="row-odd"><td><p>レスポンスリストフラグ</p></td>
<td><p>True</p></td>
</tr>
<tr class="row-even"><td><p>イベントIDキー</p></td>
<td><p>activeAt</p></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">&lt;認証トークン&gt;は、Grafanaの認証情報です。</div>
<div class="line">下記の手順で取得できます。</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">ブラウザで、<em class="dfn">Grafana</em> にサインインします。</div>
<div class="line">　初期設定では、</div>
<div class="line">　・username: admin</div>
<div class="line">　・Password: admin （但し、既にログインした場合、変更されている可能性があります）</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Home &gt; Administration &gt; Service accounts を選択</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel">service account</span> をクリックして、サービスアカウントを作成します。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">サービス名を英数字の小文字で入力します。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel">Add service account token</span> をクリックして、認証トークンを作成します。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Expirationで、</div>
<div class="line">　&quot;No expiation&quot;（期限なし　※推奨）または、</div>
<div class="line">　&quot;Set expiation&quot;（期限あり）を選択します。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel">Generate token</span> をクリックします。</div>
</div>
</li>
<li><div class="line-block">
<div class="line"><span class="guilabel">Copy to clipboard and close</span> をクリックし,</div>
<div class="line">認証トークンがクリップボードに貼り付けられます。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">クリップボードの認証トークンを、 <span class="menuselection">OASE管理 ▶ イベント収集</span> の <span class="menuselection">認証トークン</span> に貼り付けます。</div>
</div>
</li>
</ol>
</div>
</section>
</section>
<section id="reserved-variables">
<span id="id22"></span><h3><span class="section-number">2.8.6. </span>利用可能な予約変数一覧<a class="headerlink" href="#reserved-variables" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line"><span class="menuselection">OASE管理 ▶ イベント収集</span> では、以下の項目で予約変数が使用可能です。</div>
</div>
<ul class="simple">
<li><p><em class="dfn">接続先</em></p></li>
<li><p><em class="dfn">リクエストヘッダー</em></p></li>
<li><p><em class="dfn">パラメータ</em></p></li>
</ul>
<section id="id23">
<h4>予約変数<a class="headerlink" href="#id23" title="Link to this heading">¶</a></h4>
<table class="docutils align-default">
<colgroup>
<col style="width: 40.0%" />
<col style="width: 30.0%" />
<col style="width: 30.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>変数名</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>出力例</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>EXASTRO_LAST_FETCHED_TIMESTAMP</p></td>
<td><p>前回取得時日時（UNIXタイムスタンプ）</p></td>
<td><p>1704817434</p></td>
</tr>
<tr class="row-odd"><td><p>EXASTRO_LAST_FETCHED_DD_MM_YY</p></td>
<td><p>前回取得時日時（DD/MM/YY HH:MM:SS形式）</p></td>
<td><p>10/01/24 01:23:45</p></td>
</tr>
<tr class="row-even"><td><p>EXASTRO_LAST_FETCHED_YY_MM_DD</p></td>
<td><p>前回取得時日時（YYYY/MM/DD HH:MM:SS形式）</p></td>
<td><p>2024/01/10 01:23:45</p></td>
</tr>
<tr class="row-odd"><td><p>EXASTRO_LAST_FETCHED_EVENT_IS_EXIST</p></td>
<td><p>前回取得イベントの存在フラグ</p></td>
<td><p>True、False</p></td>
</tr>
<tr class="row-even"><td><p>EXASTRO_LAST_FETCHED_EVENT</p></td>
<td><p>前回取得イベントのrawデータのオブジェクト</p></td>
<td><div class="line-block">
<div class="line">(例: Zabbixの場合)</div>
<div class="line">{&quot;eventid&quot;: &quot;xxx&quot;, &quot;souce&quot;: &quot;xxx&quot;, &quot;object&quot;: ...}</div>
<div class="line">使用方法については <a class="reference internal" href="#oase-last-fetched-event"><span class="std std-ref">EXASTRO_LAST_FETCHED_EVENTで参照できる項目</span></a> を参照</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>EXASTRO_EVENT_COLLECTION_SETTING</p></td>
<td><p>イベント収集設定の項目のオブジェクト</p></td>
<td><p><a class="reference internal" href="#oase-collectiong-setting"><span class="std std-ref">EXASTRO_EVENT_COLLECTION_SETTINGで参照できる項目一覧</span></a> を参照</p></td>
</tr>
<tr class="row-even"><td><p>EXASTRO_LAST_FETCHED_TIME</p></td>
<td><div class="line-block">
<div class="line">前回取得時日時（YYYY-MM-DD HH:MM:SS形式）</div>
<div class="line">※文字列orオブジェクト</div>
</div>
</td>
<td><p>2025-09-19 10:45:34</p></td>
</tr>
<tr class="row-odd"><td><p>EXASTRO_CURRENT_TIME</p></td>
<td><div class="line-block">
<div class="line">現在時刻（YYYY-MM-DD HH:MM:SS形式）</div>
<div class="line">※文字列orオブジェクト</div>
</div>
</td>
<td><p>2025-09-19 10:45:34</p></td>
</tr>
</tbody>
</table>
<section id="exastro-last-fetched-event">
<span id="oase-last-fetched-event"></span><h5>EXASTRO_LAST_FETCHED_EVENTで参照できる項目<a class="headerlink" href="#exastro-last-fetched-event" title="Link to this heading">¶</a></h5>
<div class="line-block">
<div class="line">前回取得されたイベント情報から動的に内容を参照できます。</div>
<div class="line">JMESPath形式で指定可能です。</div>
</div>
<p><strong>〇使用例</strong></p>
<div class="line-block">
<div class="line">以下は前回取得されたイベントデータの例です。</div>
</div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;eventid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;12345&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;clock&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1704817434&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;object&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;0&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;objectid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;10001&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">このデータから clock 項目を取得し、Zabbix APIの event.get メソッドのパラメータとして設定する例を以下に示します。</div>
</div>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">{</span>
<span class="x">    &quot;jsonrpc&quot;: &quot;2.0&quot;,</span>
<span class="x">    &quot;method&quot;: &quot;event.get&quot;,</span>
<span class="x">    &quot;params&quot;: {</span>
<span class="x">        &quot;output&quot;: &quot;extend&quot;,</span>
<span class="x">        &quot;time_from&quot;: &quot;</span><span class="cp">{{</span> <span class="nv">EXASTRO_LAST_FETCHED_EVENT.clock</span> <span class="cp">}}</span><span class="x">&quot;,</span>
<span class="x">    },</span>
<span class="x">    &quot;id&quot;: 1</span>
<span class="x">}</span>
</pre></div>
</div>
</section>
<section id="exastro-event-collection-setting">
<span id="oase-collectiong-setting"></span><h5>EXASTRO_EVENT_COLLECTION_SETTINGで参照できる項目一覧<a class="headerlink" href="#exastro-event-collection-setting" title="Link to this heading">¶</a></h5>
<div class="line-block">
<div class="line"><a class="reference internal" href="#agent"><span class="std std-ref">イベント収集</span></a> に登録された情報を予約変数として参照することができます。</div>
<div class="line">以下は、使用可能な項目と対応する変数名の一覧です。</div>
</div>
<table class="docutils align-default">
<colgroup>
<col style="width: 42.9%" />
<col style="width: 57.1%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>項目名</p></th>
<th class="head"><p>変数名.属性</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>イベント収集設定名</p></td>
<td><p>EXASTRO_EVENT_COLLECTION_SETTING.EVENT_COLLECTION_SETTINGS_NAME</p></td>
</tr>
<tr class="row-odd"><td><p>接続先</p></td>
<td><p>EXASTRO_EVENT_COLLECTION_SETTING.URL</p></td>
</tr>
<tr class="row-even"><td><p>ポート</p></td>
<td><p>EXASTRO_EVENT_COLLECTION_SETTING.PORT</p></td>
</tr>
<tr class="row-odd"><td><p>リクエストヘッダー</p></td>
<td><p>EXASTRO_EVENT_COLLECTION_SETTING.REQUEST_HEADER</p></td>
</tr>
<tr class="row-even"><td><p>プロキシ</p></td>
<td><p>EXASTRO_EVENT_COLLECTION_SETTING.PROXY</p></td>
</tr>
<tr class="row-odd"><td><p>認証トークン</p></td>
<td><p>EXASTRO_EVENT_COLLECTION_SETTING.AUTH_TOKEN</p></td>
</tr>
<tr class="row-even"><td><p>ユーザー名</p></td>
<td><p>EXASTRO_EVENT_COLLECTION_SETTING.USERNAME</p></td>
</tr>
<tr class="row-odd"><td><p>パスワード</p></td>
<td><p>EXASTRO_EVENT_COLLECTION_SETTING.PASSWORD</p></td>
</tr>
<tr class="row-even"><td><p>メールボックス名</p></td>
<td><p>EXASTRO_EVENT_COLLECTION_SETTING.MAILBOXNAME</p></td>
</tr>
<tr class="row-odd"><td><p>パラメータ</p></td>
<td><p>EXASTRO_EVENT_COLLECTION_SETTING.PARAMETER</p></td>
</tr>
<tr class="row-even"><td><p>レスポンスキー</p></td>
<td><p>EXASTRO_EVENT_COLLECTION_SETTING.RESPONSE_KEY</p></td>
</tr>
<tr class="row-odd"><td><p>レスポンスリストフラグ</p></td>
<td><p>EXASTRO_EVENT_COLLECTION_SETTING.RESPONSE_LIST_FLAG</p></td>
</tr>
<tr class="row-even"><td><p>イベントIDキー</p></td>
<td><p>EXASTRO_EVENT_COLLECTION_SETTING.EVENT_ID_KEY</p></td>
</tr>
<tr class="row-odd"><td><p>TTL</p></td>
<td><p>EXASTRO_EVENT_COLLECTION_SETTING.TTL</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="id24">
<h4>設定例<a class="headerlink" href="#id24" title="Link to this heading">¶</a></h4>
<div class="line-block">
<div class="line">各設定箇所での予約変数の使用例を示します。</div>
</div>
<section id="id25">
<h5>接続先での使用例<a class="headerlink" href="#id25" title="Link to this heading">¶</a></h5>
<div class="line-block">
<div class="line">接続先URLに認証トークンを埋め込み、URLパラメータとして渡す。</div>
</div>
<figure class="align-default">
<a class="reference internal image-reference" href="../../_images/oase_connectexample_v2-7.png"><img alt="OASE接続先例" src="../../_images/oase_connectexample_v2-7.png" style="width: 800px;" />
</a>
</figure>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">http://monitor.example.com/api/org_name/workspaces/ws_name/ita/menu/event_collection/filter?token=</span><span class="cp">{{</span> <span class="nv">EXASTRO_EVENT_COLLECTION_SETTING.AUTH_TOKEN</span> <span class="o">|</span> <span class="nf">urlencode</span><span class="o">()</span> <span class="cp">}}</span>
</pre></div>
</div>
</section>
<section id="id26">
<h5>リクエストヘッダーでの使用例<a class="headerlink" href="#id26" title="Link to this heading">¶</a></h5>
<div class="line-block">
<div class="line">APIのリクエストヘッダーにBearerトークンを含めて認証を行う。</div>
</div>
<figure class="align-default">
<a class="reference internal image-reference" href="../../_images/oase_requestexample_v2-7.png"><img alt="OASEリクエストヘッダー例" src="../../_images/oase_requestexample_v2-7.png" style="width: 800px;" />
</a>
</figure>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">{</span>
<span class="x">    &quot;Content-Type&quot;: &quot;application/json&quot;,</span>
<span class="x">    &quot;Authorization&quot;: &quot;Bearer </span><span class="cp">{{</span> <span class="nv">EXASTRO_EVENT_COLLECTION_SETTING.AUTH_TOKEN</span> <span class="cp">}}</span><span class="x">&quot;</span>
<span class="x">}</span>
</pre></div>
</div>
</section>
<section id="id27">
<h5>パラメータでの使用例<a class="headerlink" href="#id27" title="Link to this heading">¶</a></h5>
<ol class="arabic">
<li><div class="line-block">
<div class="line"><strong>イベント収集時に、現在日時や前回取得日時をフィルター条件として指定</strong></div>
</div>
<div class="line-block">
<div class="line">現在日時を指定</div>
</div>
<figure class="align-default">
<a class="reference internal image-reference" href="../../_images/oase_paramexample1_v2-7.png"><img alt="OASEパラメータ例1" src="../../_images/oase_paramexample1_v2-7.png" style="width: 800px;" />
</a>
</figure>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">{</span>
<span class="x">  &quot;discard&quot;: { &quot;NORMAL&quot;: &quot;0&quot; },</span>
<span class="x">  &quot;last_update_date_time&quot;: {</span>
<span class="x">    &quot;RANGE&quot;: {</span>
<span class="x">      &quot;START&quot;: &quot;</span><span class="cp">{{</span> <span class="nv">EXASTRO_CURRENT_TIME</span> <span class="cp">}}</span><span class="x">&quot;</span>
<span class="x">    }</span>
<span class="x">  }</span>
<span class="x">}</span>
</pre></div>
</div>
<div class="line-block">
<div class="line">前回取得日時（YYYY/MM/DD形式）を指定</div>
</div>
<figure class="align-default">
<a class="reference internal image-reference" href="../../_images/oase_paramexample2_v2-7.png"><img alt="OASEパラメータ例2" src="../../_images/oase_paramexample2_v2-7.png" style="width: 800px;" />
</a>
</figure>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">{</span>
<span class="x">  &quot;discard&quot;: { &quot;NORMAL&quot;: &quot;0&quot; },</span>
<span class="x">  &quot;last_update_date_time&quot;: {</span>
<span class="x">    &quot;RANGE&quot;: {</span>
<span class="x">      &quot;START&quot;: &quot;</span><span class="cp">{{</span> <span class="nv">EXASTRO_LAST_FETCHED_YY_MM_DD</span> <span class="cp">}}</span><span class="x">&quot;</span>
<span class="x">    }</span>
<span class="x">  }</span>
<span class="x">}</span>
</pre></div>
</div>
</li>
<li><div class="line-block">
<div class="line"><strong>Zabbix連携での使用</strong></div>
<div class="line">イベント取得時の条件分岐（前回取得イベントの有無による処理の切り替え）</div>
</div>
<ul class="simple">
<li><p>前回取得イベントが存在する場合　：前回取得イベントIDの次のイベントから取得</p></li>
<li><p>前回取得イベントが存在しない場合：前回取得時刻以降のイベントを取得</p></li>
</ul>
<figure class="align-default">
<a class="reference internal image-reference" href="../../_images/oase_paramexample3_v2-7.png"><img alt="OASEパラメータ例3" src="../../_images/oase_paramexample3_v2-7.png" style="width: 800px;" />
</a>
</figure>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">{</span>
<span class="x">    &quot;jsonrpc&quot;: &quot;2.0&quot;,</span>
<span class="x">    &quot;method&quot;: &quot;problem.get&quot;,</span>
<span class="x">    &quot;params&quot;: {</span>
<span class="x">        &quot;output&quot;: &quot;extend&quot;,</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">EXASTRO_LAST_FETCHED_EVENT_IS_EXIST</span> <span class="cp">%}</span>
<span class="x">          &quot;eventid_from&quot;: &quot;</span><span class="cp">{{</span> <span class="nv">EXASTRO_LAST_FETCHED_EVENT.eventid</span><span class="o">|</span><span class="nf">int</span> <span class="o">+</span> <span class="m">1</span> <span class="cp">}}</span><span class="x">&quot;,</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
<span class="x">          &quot;time_from&quot;: &quot;</span><span class="cp">{{</span> <span class="nv">EXASTRO_LAST_FETCHED_TIMESTAMP</span> <span class="cp">}}</span><span class="x">&quot;,</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="x">    },</span>
<span class="x">    &quot;auth&quot;: &quot;</span><span class="cp">{{</span> <span class="nv">EXASTRO_EVENT_COLLECTION_SETTING.AUTH_TOKEN</span> <span class="cp">}}</span><span class="x">&quot;,</span>
<span class="x">    &quot;id&quot;: 1</span>
<span class="x">}</span>
</pre></div>
</div>
</li>
</ol>
</section>
</section>
</section>
<section id="notification-template-sample">
<span id="id28"></span><h3><span class="section-number">2.8.7. </span>通知テンプレート（共通）の設定例<a class="headerlink" href="#notification-template-sample" title="Link to this heading">¶</a></h3>
<section id="servicenow">
<span id="notification-template-sample-servicenow-register"></span><h4>ServiceNow(レコード登録)の設定例<a class="headerlink" href="#servicenow" title="Link to this heading">¶</a></h4>
<p>ServiceNow(レコード登録)を行う通知テンプレート（共通）の設定例を以下に示します。</p>
<ul>
<li><p>ServiceNowのインシデントテーブルにレコード登録を行う設定例</p>
<div class="line-block">
<div class="line">ここでは、デフォルトのテンプレートの内容から、TITLE の内容をServiceNowの short_description に、BODY に、イベントRAWデータ, エージェント の内容をServiceNowの description に設定する例を示します。</div>
<div class="line">イベントRAWデータ(raw_event_data), エージェント(exastro_agents) の内容は、Jinjaテンプレートのループ処理を使用して、動的に設定しています。</div>
</div>
<ul>
<li><div class="line-block">
<div class="line">1.新規イベント（受信時）のテンプレート例: New(received).j2</div>
</div>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">[TITLE]</span>
<span class="x">Event Received. </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">exastro_edit_count</span> <span class="o">==</span> <span class="m">1</span> <span class="cp">%}</span><span class="x">Primary Event</span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span><span class="x">Consolidated Event</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"> (</span><span class="cp">{{</span> <span class="nv">exastro_edit_count</span> <span class="cp">}}</span><span class="x">)</span>

<span class="x">[BODY]</span>
<span class="x">{</span>
<span class="x">    &quot;short_description&quot;: &quot;Event Received. </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">exastro_edit_count</span> <span class="o">==</span> <span class="m">1</span> <span class="cp">%}</span><span class="x">Primary Event</span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span><span class="x">Consolidated Event</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"> (</span><span class="cp">{{</span> <span class="nv">exastro_edit_count</span> <span class="cp">}}</span><span class="x">) &quot;,</span>
<span class="x">    &quot;description&quot;: &quot;RAW Event Data: </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">key</span><span class="o">,</span> <span class="nv">value</span> <span class="k">in</span> <span class="nv">raw_event_data</span> <span class="o">|</span> <span class="nf">default</span><span class="o">({})</span> <span class="o">|</span> <span class="nf">items</span><span class="o">()</span> <span class="cp">%}</span><span class="x">\n  </span><span class="cp">{{</span> <span class="nv">key</span> <span class="cp">}}</span><span class="x">:</span><span class="cp">{{</span> <span class="nv">value</span> <span class="cp">}}{%</span> <span class="k">if</span> <span class="k">not</span> <span class="nb">loop</span><span class="nv">.last</span> <span class="cp">%}</span><span class="x">,</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x">,\n Agent: </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">key</span><span class="o">,</span> <span class="nv">value</span> <span class="k">in</span> <span class="nv">exastro_agents</span> <span class="o">|</span> <span class="nf">default</span><span class="o">({})</span> <span class="o">|</span> <span class="nf">items</span><span class="o">()</span> <span class="cp">%}</span><span class="x">\n  </span><span class="cp">{{</span> <span class="nv">key</span> <span class="cp">}}</span><span class="x">:</span><span class="cp">{{</span> <span class="nv">value</span> <span class="cp">}}{%</span> <span class="k">if</span> <span class="k">not</span> <span class="nb">loop</span><span class="nv">.last</span> <span class="cp">%}</span><span class="x">,</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x">&quot;,</span>
<span class="x">    &quot;caller_id&quot;: &quot;&quot;,</span>
<span class="x">    &quot;impact&quot;: &quot;2&quot;,</span>
<span class="x">    &quot;urgency&quot;: &quot;2&quot;,</span>
<span class="x">    &quot;category&quot;: &quot;Software&quot;,</span>
<span class="x">    &quot;contact_type&quot;: &quot;Phone&quot;,</span>
<span class="x">    &quot;state&quot;: &quot;1&quot;,</span>
<span class="x">    &quot;subcategory&quot;: &quot;Email&quot;,</span>
<span class="x">    &quot;priority&quot;: &quot;3&quot;,</span>
<span class="x">    &quot;service&quot;: &quot;Email Service&quot;</span>
<span class="x">}</span>
</pre></div>
</div>
</li>
<li><div class="line-block">
<div class="line">1.新規イベント（受信時）の通知例</div>
</div>
<figure class="align-default">
<a class="reference internal image-reference" href="../../_images/snow_incident_sample_01_received.drawio.png"><img alt="新規イベント（受信時）: ServiceNow(インシデント)" src="../../_images/snow_incident_sample_01_received.drawio.png" style="width: 800px;" />
</a>
</figure>
</li>
<li><div class="line-block">
<div class="line">2.新規イベント（統合時）のテンプレート例: New(consolidated).j2</div>
</div>
<div class="highlight-jinja notranslate"><div class="highlight"><pre><span></span><span class="x">[TITLE]</span>
<span class="x">Event Consolidated by Deduplication </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">exastro_dup_notification_queue</span> <span class="o">|</span> <span class="nf">default</span><span class="o">(</span><span class="s1">&#39;0&#39;</span><span class="o">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span> <span class="cp">%}</span><span class="x"> (ttl expired) </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

<span class="x">[BODY]</span>
<span class="x">{</span>
<span class="x">    &quot;short_description&quot;: &quot;Event Consolidated by Deduplication </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">exastro_dup_notification_queue</span> <span class="o">|</span> <span class="nf">default</span><span class="o">(</span><span class="s1">&#39;0&#39;</span><span class="o">)</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span> <span class="cp">%}</span><span class="x">(ttl expired)</span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span><span class="x"> </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x">&quot;,</span>
<span class="x">    &quot;description&quot;: &quot;RAW Event Data: </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">key</span><span class="o">,</span> <span class="nv">value</span> <span class="k">in</span> <span class="nv">raw_event_data</span> <span class="o">|</span> <span class="nf">default</span><span class="o">({})</span> <span class="o">|</span> <span class="nf">items</span><span class="o">()</span> <span class="cp">%}</span><span class="x">\n  </span><span class="cp">{{</span> <span class="nv">key</span> <span class="cp">}}</span><span class="x">:</span><span class="cp">{{</span> <span class="nv">value</span> <span class="cp">}}{%</span> <span class="k">if</span> <span class="k">not</span> <span class="nb">loop</span><span class="nv">.last</span> <span class="cp">%}</span><span class="x">,</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x">,\n Agent: </span><span class="cp">{%</span> <span class="k">for</span> <span class="nv">key</span><span class="o">,</span> <span class="nv">value</span> <span class="k">in</span> <span class="nv">exastro_agents</span> <span class="o">|</span> <span class="nf">default</span><span class="o">({})</span> <span class="o">|</span> <span class="nf">items</span><span class="o">()</span> <span class="cp">%}</span><span class="x">\n  </span><span class="cp">{{</span> <span class="nv">key</span> <span class="cp">}}</span><span class="x">:</span><span class="cp">{{</span> <span class="nv">value</span> <span class="cp">}}{%</span> <span class="k">if</span> <span class="k">not</span> <span class="nb">loop</span><span class="nv">.last</span> <span class="cp">%}</span><span class="x">,</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}{%</span> <span class="k">endfor</span> <span class="cp">%}</span><span class="x">&quot;,</span>
<span class="x">    &quot;caller_id&quot;: &quot;&quot;,</span>
<span class="x">    &quot;impact&quot;: &quot;2&quot;,</span>
<span class="x">    &quot;urgency&quot;: &quot;2&quot;,</span>
<span class="x">    &quot;category&quot;: &quot;Software&quot;,</span>
<span class="x">    &quot;contact_type&quot;: &quot;Phone&quot;,</span>
<span class="x">    &quot;state&quot;: &quot;1&quot;,</span>
<span class="x">    &quot;subcategory&quot;: &quot;Email&quot;,</span>
<span class="x">    &quot;priority&quot;: &quot;3&quot;,</span>
<span class="x">    &quot;service&quot;: &quot;Email Service&quot;</span>
<span class="x">}</span>
</pre></div>
</div>
</li>
<li><div class="line-block">
<div class="line">2.新規イベント（統合時）の通知例</div>
</div>
<figure class="align-default">
<a class="reference internal image-reference" href="../../_images/snow_incident_sample_02_merged.drawio.png"><img alt="新規イベント（統合時）: ServiceNow(インシデント)" src="../../_images/snow_incident_sample_02_merged.drawio.png" style="width: 800px;" />
</a>
</figure>
</li>
</ul>
</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<div class="line-block">
<div class="line">TITLEについて</div>
<div class="line">ServiceNow (レコード登録) を通知方法として選択した場合、TITLE に記載した内容は使用されません。</div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<div class="line-block">
<div class="line">BODYについて</div>
</div>
<div class="line-block">
<div class="line">ServiceNow (レコード登録) を通知方法として選択した場合、BODY に記載した内容をリクエストボディとして使用します。</div>
</div>
<div class="line-block">
<div class="line">そのため、BODY には、ServiceNow の REST API でレコード登録を行う際のリクエストボディの形式で記載する必要があります。</div>
</div>
<ul class="simple">
<li><p>テンプレート例はあくまで一例です。実際の運用に合わせて、適宜カスタマイズしてください。</p></li>
<li><p>使用するパラメータについては、ServiceNow の 利用するアプリケーションに応じて、 マニュアルや、REST API リファレンスを参照してください。</p>
<ul>
<li><p><a class="reference external" href="https://www.servicenow.com/docs/ja-JP/bundle/washingtondc-api-reference/page/integrate/inbound-rest/concept/c_TableAPI.html">ServiceNowテーブルAPIマニュアル</a> 参照してください</p></li>
<li><p>REST APIエクスプローラー</p>
<ul>
<li><p><cite>https://&lt;instance-name&gt;.service-now.com/$restapi.do</cite></p></li>
<li><p>REST APIエクスプローラーの利用については、<a class="reference external" href="https://www.servicenow.com/docs/ja-JP/bundle/washingtondc-api-reference/page/integrate/inbound-rest/task/t_GetStartedAccessExplorer.html">ServiceNowのマニュアル</a> を参照してください</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</section>
</section>
</section>
</section>


</div>


<div id="articleNavigation">
  <ul>
    <li class="prev"><a href="oase_common.html" title="前のトピックへ"><span>前のトピックへ</span><span class="section-number">1. </span>OASE共通</a></li>
    <li class="next"><a href="oase.html" title="次のトピックへ"><span>次のトピックへ</span><span class="section-number">3. </span>OASE</a></li>
  </ul>
</div>


<div id="pageTopLink">
  <a href="#container"><i>↑</i> Page Top</a>
</div>

</article>
</div>
</main>
</div><!-- End #contents -->
<div id="footer">
  <footer class="divInner">
    <small>Copyright © 2019-2025 NEC Corporation</small>
    <small><a href="/ja/2.7/terms/ja.html">サイト規約</a></small>
  </footer>
</div><!-- End #footer -->

<div id="overlay"></div>
<div id="grayBack"></div>

</div><!-- End #container -->
  </body>
</html>