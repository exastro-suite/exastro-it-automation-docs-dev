<!DOCTYPE html>

<html lang="ja" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-144561796-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-144561796-1');
    </script>
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <title>実装のベストプラクティス &#8212; Documentation  ドキュメント</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fe63c2af" />
    <link rel="stylesheet" type="text/css" href="../../../_static/option.css?v=49ab891d" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css?v=a5c4661c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/exastro_documents.css?v=99e5f627" />
    <link rel="stylesheet" type="text/css" href="../../../_static/swagger/swagger-ui.css?v=ab82c586" />
    
    <script src="../../../_static/documentation_options.js?v=c033477b"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=3e58b9f8"></script>
    <script src="../../../_static/translations.js?v=4755f45a"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/mermaid@11.12.1/dist/mermaid.esm.min.mjs"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.2.0/dist/mermaid-layout-elk.esm.min.mjs"></script>
    <script type="module">import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.12.1/dist/mermaid.esm.min.mjs";import elkLayouts from "https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.2.0/dist/mermaid-layout-elk.esm.min.mjs";mermaid.registerLayoutLoaders(elkLayouts);mermaid.initialize({startOnLoad:false});</script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
    <script type="module">import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.12.1/dist/mermaid.esm.min.mjs";

const defaultStyle = document.createElement('style');
defaultStyle.textContent = `pre.mermaid {
    /* Same as .mermaid-container > pre */
    display: block;
    width: 100%;
}

pre.mermaid > svg {
    /* Same as .mermaid-container > pre > svg */
    height: 500px;
    width: 100%;
    max-width: 100% !important;
}
`;
document.head.appendChild(defaultStyle);

const fullscreenStyle = document.createElement('style');
fullscreenStyle.textContent = `.mermaid-container {
    display: flex;
    flex-direction: row;
    width: 100%;
}

.mermaid-container > pre {
    display: block;
    width: 100%;
}

.mermaid-container > pre > svg {
    height: 500px;
    width: 100%;
    max-width: 100% !important;
}

.mermaid-fullscreen-btn {
    width: 28px;
    height: 28px;
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid rgba(0, 0, 0, 0.3);
    border-radius: 4px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    font-size: 14px;
    line-height: 1;
    padding: 0;
    color: #333;
}

.mermaid-fullscreen-btn:hover {
    opacity: 100% !important;
    background: rgba(255, 255, 255, 1);
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
    transform: scale(1.1);
}

.mermaid-fullscreen-btn.dark-theme {
    background: rgba(50, 50, 50, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: #e0e0e0;
}

.mermaid-fullscreen-btn.dark-theme:hover {
    background: rgba(60, 60, 60, 1);
    box-shadow: 0 3px 10px rgba(255, 255, 255, 0.2);
}

.mermaid-fullscreen-modal {
    display: none;
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 95vw;
    height: 100vh;
    background: rgba(255, 255, 255, 0.98);
    z-index: 9999;
    padding: 20px;
    overflow: auto;
}

.mermaid-fullscreen-modal.dark-theme {
    background: rgba(0, 0, 0, 0.98);
}

.mermaid-fullscreen-modal.active {
    display: flex;
    align-items: center;
    justify-content: center;
}

.mermaid-container-fullscreen {
    position: relative;
    width: 95vw;
    height: 90vh;
    max-width: 95vw;
    max-height: 90vh;
    background: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    overflow: auto;
    display: flex;
    align-items: center;
    justify-content: center;
}

.mermaid-container-fullscreen.dark-theme {
    background: #1a1a1a;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8);
}

.mermaid-container-fullscreen pre.mermaid {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.mermaid-container-fullscreen .mermaid svg {
    height: 100% !important;
    width: 100% !important;
    cursor: grab;
}

.mermaid-fullscreen-close {
    position: fixed !important;
    top: 20px !important;
    right: 20px !important;
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.95);
    border: 1px solid rgba(0, 0, 0, 0.2);
    border-radius: 50%;
    cursor: pointer;
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    transition: all 0.2s;
    font-size: 24px;
    line-height: 1;
    color: #333;
}

.mermaid-fullscreen-close:hover {
    background: white;
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
    transform: scale(1.1);
}

.mermaid-fullscreen-close.dark-theme {
    background: rgba(50, 50, 50, 0.95);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: #e0e0e0;
}

.mermaid-fullscreen-close.dark-theme:hover {
    background: rgba(60, 60, 60, 1);
    box-shadow: 0 6px 16px rgba(255, 255, 255, 0.2);
}

.mermaid-fullscreen-modal .mermaid-fullscreen-btn {
    display: none !important;
}`;
document.head.appendChild(fullscreenStyle);

// Detect if page has dark background
const isDarkTheme = () => {
    const bgColor = window.getComputedStyle(document.body).backgroundColor;
    const match = bgColor.match(/rgb\((\d+),\s*(\d+),\s*(\d+)/);
    if (match) {
        const r = parseInt(match[1]);
        const g = parseInt(match[2]);
        const b = parseInt(match[3]);
        const brightness = (r * 299 + g * 587 + b * 114) / 1000;
        return brightness < 128;
    }
    return false;
};

const load = async () => {
    await mermaid.run();

    const all_mermaids = document.querySelectorAll(".mermaid");
    const mermaids_processed = document.querySelectorAll(".mermaid[data-processed='true']");

    if ("False" === "True") {
        const mermaids_to_add_zoom = -1 === -1 ? all_mermaids.length : -1;
        if(mermaids_to_add_zoom > 0) {
            var svgs = d3.selectAll("");
            if(all_mermaids.length !== mermaids_processed.length) {
                setTimeout(load, 200);
                return;
            } else if(svgs.size() !== mermaids_to_add_zoom) {
                setTimeout(load, 200);
                return;
            } else {
                svgs.each(function() {
                    var svg = d3.select(this);
                    svg.html("<g class='wrapper'>" + svg.html() + "</g>");
                    var inner = svg.select("g");
                    var zoom = d3.zoom().on("zoom", function(event) {
                        inner.attr("transform", event.transform);
                    });
                    svg.call(zoom);
                });
            }
        }
    } else if(all_mermaids.length !== mermaids_processed.length) {
        // Wait for mermaid to process all diagrams
        setTimeout(load, 200);
        return;
    }

    const darkTheme = isDarkTheme();

    // Stop here if not adding fullscreen capability
    if ("True" !== "True") return;

    const modal = document.createElement('div');
    modal.className = 'mermaid-fullscreen-modal' + (darkTheme ? ' dark-theme' : '');
    modal.setAttribute('role', 'dialog');
    modal.setAttribute('aria-modal', 'true');
    modal.setAttribute('aria-label', 'Fullscreen diagram viewer');
    modal.innerHTML = `
        <button class="mermaid-fullscreen-close${darkTheme ? ' dark-theme' : ''}" aria-label="Close fullscreen">✕</button>
        <div class="mermaid-container-fullscreen${darkTheme ? ' dark-theme' : ''}"></div>
    `;
    document.body.appendChild(modal);

    const modalContent = modal.querySelector('.mermaid-container-fullscreen');
    const closeBtn = modal.querySelector('.mermaid-fullscreen-close');

    let previousScrollOffset = [window.scrollX, window.scrollY];

    const closeModal = () => {
        modal.classList.remove('active');
        modalContent.innerHTML = '';
        document.body.style.overflow = ''
        window.scrollTo({left: previousScrollOffset[0], top: previousScrollOffset[1], behavior: 'instant'});
    };

    closeBtn.addEventListener('click', closeModal);
    modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
    });
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && modal.classList.contains('active')) {
            closeModal();
        }
    });

    const allButtons = [];

    document.querySelectorAll('.mermaid').forEach((mermaidDiv) => {
        if (mermaidDiv.parentNode.classList.contains('mermaid-container') ||
            mermaidDiv.closest('.mermaid-fullscreen-modal')) {
            return;
        }

        const container = document.createElement('div');
        container.className = 'mermaid-container';
        mermaidDiv.parentNode.insertBefore(container, mermaidDiv);
        container.appendChild(mermaidDiv);

        const fullscreenBtn = document.createElement('button');
        fullscreenBtn.className = 'mermaid-fullscreen-btn' + (darkTheme ? ' dark-theme' : '');
        fullscreenBtn.setAttribute('aria-label', 'View diagram in fullscreen');
        fullscreenBtn.textContent = '⛶';
        fullscreenBtn.style.opacity = '50%';

        // Calculate dynamic position based on diagram's margin and padding
        const diagramStyle = window.getComputedStyle(mermaidDiv);
        const marginTop = parseFloat(diagramStyle.marginTop) || 0;
        const marginRight = parseFloat(diagramStyle.marginRight) || 0;
        const paddingTop = parseFloat(diagramStyle.paddingTop) || 0;
        const paddingRight = parseFloat(diagramStyle.paddingRight) || 0;
        fullscreenBtn.style.top = `${marginTop + paddingTop + 4}px`;
        fullscreenBtn.style.right = `${marginRight + paddingRight + 4}px`;

        fullscreenBtn.addEventListener('click', () => {
            previousScrollOffset = [window.scroll, window.scrollY];
            const clone = mermaidDiv.cloneNode(true);
            modalContent.innerHTML = '';
            modalContent.appendChild(clone);

            const svg = clone.querySelector('svg');
            if (svg) {
                svg.removeAttribute('width');
                svg.removeAttribute('height');
                svg.style.width = '100%';
                svg.style.height = 'auto';
                svg.style.maxWidth = '100%';
                svg.style.sdisplay = 'block';

                if ("False" === "True") {
                    setTimeout(() => {
                        const g = svg.querySelector('g');
                        if (g) {
                            var svgD3 = d3.select(svg);
                            svgD3.html("<g class='wrapper'>" + svgD3.html() + "</g>");
                            var inner = svgD3.select("g");
                            var zoom = d3.zoom().on("zoom", function(event) {
                                inner.attr("transform", event.transform);
                            });
                            svgD3.call(zoom);
                        }
                    }, 100);
                }
            }

            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        });

        container.appendChild(fullscreenBtn);
        allButtons.push(fullscreenBtn);
    });

    // Update theme classes when theme changes
    const updateTheme = () => {
        const dark = isDarkTheme();
        allButtons.forEach(btn => {
            if (dark) {
                btn.classList.add('dark-theme');
            } else {
                btn.classList.remove('dark-theme');
            }
        });
        if (dark) {
            modal.classList.add('dark-theme');
            modalContent.classList.add('dark-theme');
            closeBtn.classList.add('dark-theme');
        } else {
            modal.classList.remove('dark-theme');
            modalContent.classList.remove('dark-theme');
            closeBtn.classList.remove('dark-theme');
        }
    };

    // Watch for theme changes
    const observer = new MutationObserver(updateTheme);
    observer.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['class', 'style', 'data-theme']
    });
    observer.observe(document.body, {
        attributes: true,
        attributeFilter: ['class', 'style']
    });
};

window.addEventListener("load", load);
</script>
    <script src="../../../_static/jquery-3.6.3.min.js?v=25455f10"></script>
    <script src="../../../_static/exastro_documents.js?v=ff50fb31"></script>
    <script src="../../../_static/swagger/swagger-ui-bundle.js?v=ec73a32a"></script>
    <script src="../../../_static/swagger/swagger-ui-standalone-preset.js?v=88d26966"></script>
    <link rel="icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="検索" href="../../../search.html" /> 
  </head>
<body id="page" class="ja">


<div id="container">

<div id="header">
  <header class="divInner">
    <!-- Exastro logo -->
    <div id="logo"><a href="https://ita.exastro.org/"><img src="../../../_static/img/exastro.svg" alt="Exastro"></a></div>
    <!-- Project name -->
    <div id="projectName"><a href="../../../index.html">Documentation</a></div>
    <!-- Heaedr navigation -->
    <div id="headerSearch">
      <form class="search" action="../../../search.html" method="get">
        <input type="text" name="q" aria-labelledby="searchlabel">
        <button type="submit" value="検索"><img src="../../../_static/img/search.png" alt="検索"></button>
      </form>
    </div>
  </header>
</div><!-- End #header -->


<div id="toolbar">
  <div class="divInner">
    
    <div id="documentVersion">
      <dl>
        <dt>Document version</dt>
        <dd>
          <div>
            <select name="version" style="height: 20px;" onchange="location.href=value;">
              <option value="../../../../../ja/2.7/learn/automation_guide/implementation/index.html">current</option>
              <option value="../../../../../ja/2.7/learn/automation_guide/implementation/index.html">2.7(current)</option>
              <option value="../../../../../ja/2.6/learn/automation_guide/implementation/index.html" selected>2.6</option>
              <option value="../../../../../ja/2.5/learn/automation_guide/implementation/index.html">2.5</option>
              <option value="../../../../../ja/2.4/learn/automation_guide/implementation/index.html">2.4</option>
              <option value="../../../../../ja/2.3/learn/automation_guide/implementation/index.html">2.3</option>
              <option value="../../../../../ja/2.2/learn/automation_guide/implementation/index.html">2.2</option>
              <option value="../../../../../ja/2.1/learn/automation_guide/implementation/index.html">2.1</option>
              <option value="../../../../../ja/2.0/learn/automation_guide/implementation/index.html">2.0</option>
            </select>
          </div>
        </dd>
      </dl>
    </div>

    <div id="documentLanguage">
      <dl>
        <dt>Language</dt>
        <dd>
          <div>
            <select name="lang" style="height: 20px;" onchange="location.href=value;">
              <option value="../../../../../ja/2.6/learn/automation_guide/implementation/index.html" selected>日本語</option>
              <option value="../../../../../en/2.6/learn/automation_guide/implementation/index.html">English</option>
            </select>
          </div>
        </dd>
      </dl>
    </div>
    <div id="toolbarNavigation">
      <ul>
      </ul>
    </div>
  </div>
</div><!-- End #toolbar -->

<div id="sideMenu">

  <div id="menuButton"></div>
  
  <aside class="divInner">
    <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../overview/index.html">概要</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../configuration/index.html">構成・構築ガイド</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/index.html">インストール／アップグレード</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Learn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../manuals/index.html">マニュアル</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../templates/index.html">テンプレート</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">リファレンス</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kb/index.html">ナレッジベース</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary/index.html">用語集</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../release_notes/index.html">リリースノート</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribute/index.html">貢献</a></li>
</ul>

    <!-- <ul>
      <li class="toctree-l1"><a class="reference internal" href="../../../../genindex.html">索引</a></li>
    </ul> -->
    
  </aside>
</div><!-- End #sideMenu -->



<div id="contents">
<main class="divInner">

 <div id="breadcrumbs">
  <ul>
    <li><a href="../../../index.html">HOME</a></li>
    
    <li>実装のベストプラクティス</li>
  </ul>
</div>

<div id="article">
<article class="divInner">
<div class="body" role="main">

  <section id="id1">
<h1>実装のベストプラクティス<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h1>
<div class="line-block">
<div class="line">この章では、設計した自動化の仕組みを実際のExastroコンポーネントとして実装する際のベストプラクティスを学習します。</div>
<div class="line">良い実装は運用時の安定性と拡張性を大きく左右するため、実践的なテクニックを身につけることが重要です。</div>
</div>
<section id="id2">
<h2>実装の全体的なアプローチ<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<section id="id3">
<h3>段階的実装戦略<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">自動化の実装は以下の段階で進めることを推奨します：</div>
</div>
<pre  class="mermaid">
        graph TD
    A[プロトタイプ] --&gt; B[MVP実装]
    B --&gt; C[段階的拡張]
    C --&gt; D[本格運用]

    A1[基本機能のみ] --&gt; A
    B1[コア機能中心] --&gt; B
    C1[順次機能追加] --&gt; C
    D1[フル機能運用] --&gt; D
    </pre><p><strong>各段階の特徴</strong>:</p>
<ol class="arabic simple">
<li><p><strong>プロトタイプ段階</strong>
- 最小限の機能で動作確認
- 単一環境での検証
- エラー処理は最低限</p></li>
<li><p><strong>MVP(Minimum Viable Product)段階</strong>
- 実用最小限の機能セット
- 基本的なエラー処理を実装
- 限定的な本番適用</p></li>
<li><p><strong>段階的拡張段階</strong>
- 順次機能を追加・改善
- 運用フィードバックを反映
- パフォーマンス最適化</p></li>
<li><p><strong>本格運用段階</strong>
- 全機能が安定動作
- 包括的なエラー処理
- 監視・メトリクス完備</p></li>
</ol>
</section>
</section>
<section id="id4">
<h2>パラメータシートの実装<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h2>
<section id="id5">
<h3>既存資産からの段階的実装アプローチ<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">パラメータシートの実装は、既存の構築手順書やPlaybookを分析し、段階的に実装していくことが成功の鍵です。</div>
</div>
<p><strong>ステップ1: 既存手順書の詳細分析</strong></p>
<div class="line-block">
<div class="line">まず、既存の手順書から実装に必要な情報を体系的に抽出します：</div>
</div>
<div class="literal-block-wrapper docutils container" id="id19">
<div class="code-block-caption"><span class="caption-text">手順書分析の実例（Apache構築手順より）</span><a class="headerlink" href="#id19" title="Link to this code">¶</a></div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>========== 元の手順書 ==========
1. Apache HTTPDパッケージをインストール
   $ sudo yum install httpd

2. 設定ファイルを編集
   ファイル: /etc/httpd/conf/httpd.conf
   - ServerName: www.example.com  ← 環境により変更
   - Listen: 80                   ← 環境により変更
   - DocumentRoot: /var/www/html  ← 固定値
   - ErrorLog: logs/error_log     ← 固定値
   - LogLevel: warn               ← 環境により変更（dev:debug, prod:warn）

3. SSL設定（本番環境のみ）
   ファイル: /etc/httpd/conf.d/ssl.conf
   - SSLEngine: on
   - SSLCertificateFile: /etc/ssl/certs/server.crt    ← 環境により変更
   - SSLCertificateKeyFile: /etc/ssl/private/server.key ← 環境により変更

4. ファイアウォール設定
   $ sudo firewall-cmd --permanent --add-port=80/tcp
   $ sudo firewall-cmd --permanent --add-port=443/tcp  ← SSL有効時のみ

5. サービス起動
   $ sudo systemctl enable httpd
   $ sudo systemctl start httpd
</pre></div>
</div>
</div>
<p><strong>分析結果とパラメータ抽出</strong></p>
<table class="docutils align-default" id="id20">
<caption><span class="caption-text">手順書分析結果</span><a class="headerlink" href="#id20" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 20.0%" />
<col style="width: 15.0%" />
<col style="width: 15.0%" />
<col style="width: 20.0%" />
<col style="width: 30.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>設定項目</p></th>
<th class="head"><p>データ型</p></th>
<th class="head"><p>必須性</p></th>
<th class="head"><p>変更タイミング</p></th>
<th class="head"><p>抽出理由</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>ServerName</strong></p></td>
<td><p>string</p></td>
<td><p>必須</p></td>
<td><p>環境構築時</p></td>
<td><p>環境ごとに異なるFQDN</p></td>
</tr>
<tr class="row-odd"><td><p><strong>Listen</strong></p></td>
<td><p>integer</p></td>
<td><p>必須</p></td>
<td><p>構築時/設定変更時</p></td>
<td><p>セキュリティ要件で変更される</p></td>
</tr>
<tr class="row-even"><td><p><strong>LogLevel</strong></p></td>
<td><p>select</p></td>
<td><p>任意</p></td>
<td><p>運用中</p></td>
<td><p>環境ごとのデバッグレベル</p></td>
</tr>
<tr class="row-odd"><td><p><strong>SSL関連</strong></p></td>
<td><p>boolean+paths</p></td>
<td><p>条件付き</p></td>
<td><p>構築時</p></td>
<td><p>本番環境でのみ必要</p></td>
</tr>
<tr class="row-even"><td><p><strong>DocumentRoot</strong></p></td>
<td><p>string</p></td>
<td><p>任意</p></td>
<td><p>まれ</p></td>
<td><p>標準パスから変更の可能性</p></td>
</tr>
</tbody>
</table>
<p><strong>ステップ2: パラメータシート設計の具体的実装</strong></p>
<div class="literal-block-wrapper docutils container" id="id21">
<div class="code-block-caption"><span class="caption-text">抽出結果からのパラメータシート設計</span><a class="headerlink" href="#id21" title="Link to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># パラメータシート: Apache Webサーバ設定</span>
<span class="nt">parameter_sheet_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;WebServer_Configuration&quot;</span>
<span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Apache</span><span class="nv"> </span><span class="s">HTTPDサーバの構築・運用パラメータ&quot;</span>

<span class="c1"># 基本設定グループ</span>
<span class="nt">basic_settings</span><span class="p">:</span>
<span class="w">  </span><span class="nt">hostname</span><span class="p">:</span>
<span class="w">    </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;サーバホスト名&quot;</span>
<span class="w">    </span><span class="nt">data_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;string&quot;</span>
<span class="w">    </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">max_length</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">63</span>
<span class="w">    </span><span class="nt">validation_pattern</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;^[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9]$&quot;</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;サーバのホスト名（FQDN形式推奨）&quot;</span>
<span class="w">    </span><span class="nt">example</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;web01.example.com&quot;</span>
<span class="w">    </span><span class="nt">input_helper</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;例:</span><span class="nv"> </span><span class="s">web01.example.com&quot;</span>

<span class="w">  </span><span class="nt">server_name</span><span class="p">:</span>
<span class="w">    </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Apache</span><span class="nv"> </span><span class="s">ServerName&quot;</span>
<span class="w">    </span><span class="nt">data_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;string&quot;</span>
<span class="w">    </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">default_expression</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">hostname</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Apache設定のServerName（通常はホスト名と同じ）&quot;</span>
<span class="w">    </span><span class="nt">linked_parameter</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;hostname&quot;</span>

<span class="w">  </span><span class="nt">http_port</span><span class="p">:</span>
<span class="w">    </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;HTTPポート番号&quot;</span>
<span class="w">    </span><span class="nt">data_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;integer&quot;</span>
<span class="w">    </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">    </span><span class="nt">min_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">max_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">65535</span>
<span class="w">    </span><span class="nt">validation_note</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1024未満のポートは管理者権限が必要&quot;</span>
<span class="w">    </span><span class="nt">common_values</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">80</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">8080</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">8000</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">8888</span><span class="p p-Indicator">]</span>

<span class="c1"># 環境設定グループ</span>
<span class="nt">environment_settings</span><span class="p">:</span>
<span class="w">  </span><span class="nt">environment_type</span><span class="p">:</span>
<span class="w">    </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;環境種別&quot;</span>
<span class="w">    </span><span class="nt">data_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;pulldown&quot;</span>
<span class="w">    </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">options</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;development&quot;</span>
<span class="w">        </span><span class="nt">label</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;開発環境&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;staging&quot;</span>
<span class="w">        </span><span class="nt">label</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ステージング環境&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;production&quot;</span>
<span class="w">        </span><span class="nt">label</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;本番環境&quot;</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;デプロイ対象の環境種別&quot;</span>

<span class="w">  </span><span class="nt">log_level</span><span class="p">:</span>
<span class="w">    </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ログレベル&quot;</span>
<span class="w">    </span><span class="nt">data_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;pulldown&quot;</span>
<span class="w">    </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">default_by_environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">development</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;debug&quot;</span>
<span class="w">      </span><span class="nt">staging</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;info&quot;</span>
<span class="w">      </span><span class="nt">production</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;warn&quot;</span>
<span class="w">    </span><span class="nt">options</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;debug&quot;</span>
<span class="w">        </span><span class="nt">label</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;DEBUG（詳細ログ）&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;info&quot;</span>
<span class="w">        </span><span class="nt">label</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;INFO（情報ログ）&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;warn&quot;</span>
<span class="w">        </span><span class="nt">label</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;WARN（警告のみ）&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;error&quot;</span>
<span class="w">        </span><span class="nt">label</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ERROR（エラーのみ）&quot;</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Apache</span><span class="nv"> </span><span class="s">ErrorLogのログレベル&quot;</span>

<span class="c1"># SSL設定グループ（条件付き表示）</span>
<span class="nt">ssl_settings</span><span class="p">:</span>
<span class="w">  </span><span class="nt">ssl_enabled</span><span class="p">:</span>
<span class="w">    </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;SSL有効化&quot;</span>
<span class="w">    </span><span class="nt">data_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;boolean&quot;</span>
<span class="w">    </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">    </span><span class="nt">default_by_environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">development</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">      </span><span class="nt">staging</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">production</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;HTTPS通信を有効にする&quot;</span>
<span class="w">    </span><span class="nt">conditional_display</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">  </span><span class="nt">ssl_certificate_file</span><span class="p">:</span>
<span class="w">    </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;SSL証明書ファイルパス&quot;</span>
<span class="w">    </span><span class="nt">data_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;string&quot;</span>
<span class="w">    </span><span class="nt">required_when</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ssl_enabled</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">true&quot;</span>
<span class="w">    </span><span class="nt">validation_pattern</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;^/.+\\.(crt|pem)$&quot;</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;SSL証明書ファイルの絶対パス&quot;</span>
<span class="w">    </span><span class="nt">example</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/etc/ssl/certs/server.crt&quot;</span>
<span class="w">    </span><span class="nt">file_existence_check</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">  </span><span class="nt">ssl_private_key_file</span><span class="p">:</span>
<span class="w">    </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;SSL秘密鍵ファイルパス&quot;</span>
<span class="w">    </span><span class="nt">data_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;string&quot;</span>
<span class="w">    </span><span class="nt">required_when</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ssl_enabled</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">true&quot;</span>
<span class="w">    </span><span class="nt">validation_pattern</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;^/.+\\.(key|pem)$&quot;</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;SSL秘密鍵ファイルの絶対パス&quot;</span>
<span class="w">    </span><span class="nt">example</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/etc/ssl/private/server.key&quot;</span>
<span class="w">    </span><span class="nt">file_existence_check</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">security_level</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;high&quot;</span>

<span class="w">  </span><span class="nt">https_port</span><span class="p">:</span>
<span class="w">    </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;HTTPSポート番号&quot;</span>
<span class="w">    </span><span class="nt">data_type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;integer&quot;</span>
<span class="w">    </span><span class="nt">required_when</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ssl_enabled</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">true&quot;</span>
<span class="w">    </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">443</span>
<span class="w">    </span><span class="nt">min_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">    </span><span class="nt">max_value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">65535</span>
<span class="w">    </span><span class="nt">validation_rule</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http_port</span><span class="nv"> </span><span class="s">!=</span><span class="nv"> </span><span class="s">https_port&quot;</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;HTTPS通信用のポート番号&quot;</span>
</pre></div>
</div>
</div>
<p><strong>ステップ3: 高度なバリデーション実装</strong></p>
<div class="literal-block-wrapper docutils container" id="id22">
<div class="code-block-caption"><span class="caption-text">実装レベルでのバリデーション詳細</span><a class="headerlink" href="#id22" title="Link to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># 複合バリデーションルール</span>
<span class="nt">advanced_validations</span><span class="p">:</span>
<span class="w">  </span><span class="nt">environment_consistency</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;環境整合性チェック&quot;</span>
<span class="w">    </span><span class="nt">trigger_parameters</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;environment_type&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;ssl_enabled&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;log_level&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">validation_logic</span><span class="p">:</span>
<span class="w">      </span><span class="nt">rules</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;environment_type</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&#39;production&#39;</span><span class="nv"> </span><span class="s">AND</span><span class="nv"> </span><span class="s">ssl_enabled</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">false&quot;</span>
<span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;error&quot;</span>
<span class="w">          </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;本番環境ではSSLの有効化が必須です&quot;</span>
<span class="w">          </span><span class="nt">auto_fix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ssl_enabled</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">true&quot;</span>

<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;environment_type</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&#39;production&#39;</span><span class="nv"> </span><span class="s">AND</span><span class="nv"> </span><span class="s">log_level</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&#39;debug&#39;&quot;</span>
<span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;warning&quot;</span>
<span class="w">          </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;本番環境でDEBUGログレベルはパフォーマンスに影響します&quot;</span>
<span class="w">          </span><span class="nt">recommendation</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;log_level</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">&#39;warn&#39;&quot;</span>

<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ssl_enabled</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">true</span><span class="nv"> </span><span class="s">AND</span><span class="nv"> </span><span class="s">(ssl_certificate_file</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&#39;&#39;</span><span class="nv"> </span><span class="s">OR</span><span class="nv"> </span><span class="s">ssl_private_key_file</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&#39;&#39;)&quot;</span>
<span class="w">          </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;error&quot;</span>
<span class="w">          </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;SSL有効時は証明書ファイルと秘密鍵ファイルの指定が必要です&quot;</span>

<span class="w">  </span><span class="nt">network_configuration</span><span class="p">:</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ネットワーク設定チェック&quot;</span>
<span class="w">    </span><span class="nt">trigger_parameters</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;http_port&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;https_port&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">validation_logic</span><span class="p">:</span>
<span class="w">      </span><span class="nt">pre_execution_checks</span><span class="p">:</span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ポート重複チェック&quot;</span>
<span class="w">          </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;port_availability_check&quot;</span>
<span class="w">          </span><span class="nt">target_ports</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">http_port</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">https_port</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">ssl_enabled</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="p p-Indicator">]</span>

<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ファイアウォール確認&quot;</span>
<span class="w">          </span><span class="nt">test</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;firewall_rule_check&quot;</span>
<span class="w">          </span><span class="nt">required_ports</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">http_port</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">https_port</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">ssl_enabled</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="p p-Indicator">]</span>

<span class="c1"># カスタムバリデーション関数</span>
<span class="nt">custom_validators</span><span class="p">:</span>
<span class="w">  </span><span class="nt">certificate_validation</span><span class="p">:</span>
<span class="w">    </span><span class="nt">function_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;validate_ssl_certificate&quot;</span>
<span class="w">    </span><span class="nt">parameters</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;ssl_certificate_file&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;ssl_private_key_file&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">implementation</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no"># SSL証明書と秘密鍵の整合性チェック</span>
<span class="w">      </span><span class="no">cert_modulus = execute(&quot;openssl x509 -noout -modulus -in {{ ssl_certificate_file }}&quot;)</span>
<span class="w">      </span><span class="no">key_modulus = execute(&quot;openssl rsa -noout -modulus -in {{ ssl_private_key_file }}&quot;)</span>

<span class="w">      </span><span class="no">if cert_modulus != key_modulus:</span>
<span class="w">        </span><span class="no">return ValidationError(&quot;証明書と秘密鍵が一致しません&quot;)</span>

<span class="w">      </span><span class="no"># 証明書有効期限チェック</span>
<span class="w">      </span><span class="no">expiry_date = execute(&quot;openssl x509 -noout -enddate -in {{ ssl_certificate_file }}&quot;)</span>
<span class="w">      </span><span class="no">if days_until(expiry_date) &lt; 30:</span>
<span class="w">        </span><span class="no">return ValidationWarning(&quot;証明書の有効期限が30日以内です&quot;)</span>

<span class="w">      </span><span class="no">return ValidationSuccess()</span>

<span class="w">  </span><span class="nt">performance_estimation</span><span class="p">:</span>
<span class="w">    </span><span class="nt">function_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;estimate_performance_impact&quot;</span>
<span class="w">    </span><span class="nt">parameters</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;log_level&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;ssl_enabled&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;expected_concurrent_users&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">implementation</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="w">      </span><span class="no"># パフォーマンス影響の概算</span>
<span class="w">      </span><span class="no">base_performance = 1000  # req/sec</span>

<span class="w">      </span><span class="no">if log_level == &quot;debug&quot;:</span>
<span class="w">        </span><span class="no">performance_multiplier *= 0.7  # 30%低下</span>
<span class="w">      </span><span class="no">elif log_level == &quot;info&quot;:</span>
<span class="w">        </span><span class="no">performance_multiplier *= 0.9  # 10%低下</span>

<span class="w">      </span><span class="no">if ssl_enabled:</span>
<span class="w">        </span><span class="no">performance_multiplier *= 0.8  # 20%低下</span>

<span class="w">      </span><span class="no">estimated_capacity = base_performance * performance_multiplier</span>

<span class="w">      </span><span class="no">if expected_concurrent_users &gt; estimated_capacity:</span>
<span class="w">        </span><span class="no">return ValidationWarning(&quot;予想負荷がサーバ性能を超過する可能性があります&quot;)</span>
</pre></div>
</div>
</div>
<p><strong>ステップ4: Playbook連携の実装</strong></p>
<div class="literal-block-wrapper docutils container" id="id23">
<div class="code-block-caption"><span class="caption-text">パラメータシートとPlaybook変数の自動マッピング</span><a class="headerlink" href="#id23" title="Link to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># パラメータマッピング定義</span>
<span class="nt">parameter_mapping</span><span class="p">:</span>
<span class="w">  </span><span class="nt">target_playbook</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;apache_setup.yml&quot;</span>
<span class="w">  </span><span class="nt">variable_mapping</span><span class="p">:</span>
<span class="w">    </span><span class="c1"># 直接マッピング</span>
<span class="w">    </span><span class="nt">direct_mapping</span><span class="p">:</span>
<span class="w">      </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;target_hostname&quot;</span>
<span class="w">      </span><span class="nt">server_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;apache_server_name&quot;</span>
<span class="w">      </span><span class="nt">http_port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;apache_http_port&quot;</span>
<span class="w">      </span><span class="nt">log_level</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;apache_log_level&quot;</span>

<span class="w">    </span><span class="c1"># 条件付きマッピング</span>
<span class="w">    </span><span class="nt">conditional_mapping</span><span class="p">:</span>
<span class="w">      </span><span class="nt">ssl_settings</span><span class="p">:</span>
<span class="w">        </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ssl_enabled</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">true&quot;</span>
<span class="w">        </span><span class="nt">variables</span><span class="p">:</span>
<span class="w">          </span><span class="nt">ssl_certificate_file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;apache_ssl_cert_path&quot;</span>
<span class="w">          </span><span class="nt">ssl_private_key_file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;apache_ssl_key_path&quot;</span>
<span class="w">          </span><span class="nt">https_port</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;apache_https_port&quot;</span>

<span class="w">    </span><span class="c1"># 計算マッピング</span>
<span class="w">    </span><span class="nt">calculated_mapping</span><span class="p">:</span>
<span class="w">      </span><span class="nt">firewall_ports</span><span class="p">:</span>
<span class="w">        </span><span class="nt">expression</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;[{{</span><span class="nv"> </span><span class="s">http_port</span><span class="nv"> </span><span class="s">}}]</span><span class="nv"> </span><span class="s">+</span><span class="nv"> </span><span class="s">([{{</span><span class="nv"> </span><span class="s">https_port</span><span class="nv"> </span><span class="s">}}]</span><span class="nv"> </span><span class="s">if</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">ssl_enabled</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">else</span><span class="nv"> </span><span class="s">[])&quot;</span>
<span class="w">        </span><span class="nt">target_variable</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;firewall_allowed_ports&quot;</span>

<span class="w">      </span><span class="nt">ssl_enabled_flag</span><span class="p">:</span>
<span class="w">        </span><span class="nt">expression</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ssl_enabled</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">lower</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">target_variable</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;apache_ssl_enable&quot;</span>

<span class="c1"># 実行時変数生成</span>
<span class="nt">runtime_variables</span><span class="p">:</span>
<span class="w">  </span><span class="nt">auto_generated</span><span class="p">:</span>
<span class="w">    </span><span class="nt">deployment_timestamp</span><span class="p">:</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ansible_date_time.iso8601</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;デプロイ実行時刻&quot;</span>

<span class="w">    </span><span class="nt">parameter_checksum</span><span class="p">:</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">(parameter_values</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">to_json</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">hash(&#39;sha256&#39;))[:8]</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;パラメータ設定のチェックサム（変更検出用）&quot;</span>

<span class="w">    </span><span class="nt">environment_tag</span><span class="p">:</span>
<span class="w">      </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;env:{{</span><span class="nv"> </span><span class="s">environment_type</span><span class="nv"> </span><span class="s">}}-app:apache-ver:{{</span><span class="nv"> </span><span class="s">apache_version</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">default(&#39;latest&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;環境識別タグ&quot;</span>
</pre></div>
</div>
</div>
</section>
<section id="id6">
<h3>段階的実装とテスト戦略<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h3>
<p><strong>フェーズ1: 基本パラメータシートの実装</strong></p>
<div class="literal-block-wrapper docutils container" id="id24">
<div class="code-block-caption"><span class="caption-text">最小限のパラメータシート（MVP版）</span><a class="headerlink" href="#id24" title="Link to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># MVP: 最小限の実用パラメータシート</span>
<span class="nt">mvp_parameter_sheet</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Apache_Basic_Config&quot;</span>
<span class="w">  </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Apache基本構築用最小パラメータセット&quot;</span>

<span class="w">  </span><span class="nt">essential_parameters</span><span class="p">:</span>
<span class="w">    </span><span class="nt">hostname</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;string&quot;</span>
<span class="w">      </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">validation</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;basic_hostname_pattern&quot;</span>

<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;select&quot;</span>
<span class="w">      </span><span class="nt">options</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;dev&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;stg&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;prod&quot;</span><span class="p p-Indicator">]</span>
<span class="w">      </span><span class="nt">required</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">    </span><span class="nt">ssl_enabled</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;boolean&quot;</span>
<span class="w">      </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="w">  </span><span class="c1"># 簡易バリデーション</span>
<span class="w">  </span><span class="nt">basic_validations</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">rule</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;hostname</span><span class="nv"> </span><span class="s">!=</span><span class="nv"> </span><span class="s">&#39;&#39;&quot;</span>
<span class="w">      </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ホスト名は必須です&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">rule</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;environment</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">[&#39;dev&#39;,</span><span class="nv"> </span><span class="s">&#39;stg&#39;,</span><span class="nv"> </span><span class="s">&#39;prod&#39;]&quot;</span>
<span class="w">      </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;正しい環境を選択してください&quot;</span>
</pre></div>
</div>
</div>
<p><strong>フェーズ2: 高度な機能の追加</strong></p>
<div class="literal-block-wrapper docutils container" id="id25">
<div class="code-block-caption"><span class="caption-text">機能拡張版パラメータシート</span><a class="headerlink" href="#id25" title="Link to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># 機能拡張版</span>
<span class="nt">enhanced_parameter_sheet</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Apache_Advanced_Config&quot;</span>
<span class="w">  </span><span class="nt">inherit_from</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Apache_Basic_Config&quot;</span>

<span class="w">  </span><span class="nt">additional_parameters</span><span class="p">:</span>
<span class="w">    </span><span class="nt">performance_tuning</span><span class="p">:</span>
<span class="w">      </span><span class="nt">worker_processes</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;integer&quot;</span>
<span class="w">        </span><span class="nt">min</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">        </span><span class="nt">max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">32</span>
<span class="w">        </span><span class="nt">default_calculation</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ansible_processor_vcpus</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">2</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Workerプロセス数（CPU数の2倍を推奨）&quot;</span>

<span class="w">      </span><span class="nt">max_connections</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;integer&quot;</span>
<span class="w">        </span><span class="nt">min</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="w">        </span><span class="nt">max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10000</span>
<span class="w">        </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1000</span>
<span class="w">        </span><span class="nt">dependency</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;worker_processes</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">25&quot;</span>

<span class="w">    </span><span class="nt">monitoring</span><span class="p">:</span>
<span class="w">      </span><span class="nt">status_page_enabled</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;boolean&quot;</span>
<span class="w">        </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;サーバステータスページの有効化&quot;</span>

<span class="w">      </span><span class="nt">access_log_format</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;select&quot;</span>
<span class="w">        </span><span class="nt">options</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;common&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;combined&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;custom&quot;</span><span class="p p-Indicator">]</span>
<span class="w">        </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;combined&quot;</span>

<span class="w">  </span><span class="c1"># 高度なバリデーション</span>
<span class="w">  </span><span class="nt">advanced_validations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">performance_check</span><span class="p">:</span>
<span class="w">      </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;max_connections</span><span class="nv"> </span><span class="s">&gt;</span><span class="nv"> </span><span class="s">(worker_processes</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">100)&quot;</span>
<span class="w">      </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;warning&quot;</span>
<span class="w">      </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;接続数設定がWorkerプロセス数に対して高すぎる可能性があります&quot;</span>
</pre></div>
</div>
</div>
<p><strong>フェーズ3: 運用統合版の実装</strong></p>
<div class="literal-block-wrapper docutils container" id="id26">
<div class="code-block-caption"><span class="caption-text">運用統合版パラメータシート</span><a class="headerlink" href="#id26" title="Link to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># 運用統合版</span>
<span class="nt">production_ready_sheet</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Apache_Production_Config&quot;</span>
<span class="w">  </span><span class="nt">inherit_from</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Apache_Advanced_Config&quot;</span>

<span class="w">  </span><span class="nt">operational_parameters</span><span class="p">:</span>
<span class="w">    </span><span class="nt">backup_settings</span><span class="p">:</span>
<span class="w">      </span><span class="nt">config_backup_enabled</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;boolean&quot;</span>
<span class="w">        </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;設定変更時の自動バックアップ&quot;</span>

<span class="w">      </span><span class="nt">backup_retention_days</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;integer&quot;</span>
<span class="w">        </span><span class="nt">min</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7</span>
<span class="w">        </span><span class="nt">max</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">365</span>
<span class="w">        </span><span class="nt">default_by_environment</span><span class="p">:</span>
<span class="w">          </span><span class="nt">dev</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7</span>
<span class="w">          </span><span class="nt">stg</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<span class="w">          </span><span class="nt">prod</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">90</span>

<span class="w">    </span><span class="nt">maintenance</span><span class="p">:</span>
<span class="w">      </span><span class="nt">auto_restart_enabled</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;boolean&quot;</span>
<span class="w">        </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;設定変更時の自動再起動&quot;</span>

<span class="w">      </span><span class="nt">maintenance_window</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;time_range&quot;</span>
<span class="w">        </span><span class="nt">format</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;HH:MM-HH:MM&quot;</span>
<span class="w">        </span><span class="nt">example</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;02:00-04:00&quot;</span>
<span class="w">        </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;メンテナンス実行可能時間帯&quot;</span>

<span class="w">  </span><span class="c1"># 運用レベルバリデーション</span>
<span class="w">  </span><span class="nt">operational_validations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">maintenance_schedule</span><span class="p">:</span>
<span class="w">      </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;auto_restart_enabled</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">true&quot;</span>
<span class="w">      </span><span class="nt">requirement</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;maintenance_window</span><span class="nv"> </span><span class="s">!=</span><span class="nv"> </span><span class="s">&#39;&#39;&quot;</span>
<span class="w">      </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;自動再起動を有効にする場合はメンテナンス時間帯の指定が必要です&quot;</span>

<span class="w">    </span><span class="nt">backup_storage</span><span class="p">:</span>
<span class="w">      </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;config_backup_enabled</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">true&quot;</span>
<span class="w">      </span><span class="nt">pre_check</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;disk_space_available&quot;</span>
<span class="w">      </span><span class="nt">minimum_space</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1GB&quot;</span>
<span class="w">      </span><span class="nt">message</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;バックアップ用のディスク容量が不足しています&quot;</span>
</pre></div>
</div>
</div>
</section>
<section id="id7">
<h3>実装のベストプラクティス<a class="headerlink" href="#id7" title="Link to this heading">¶</a></h3>
<p><strong>1. パラメータシートの可読性向上</strong></p>
<div class="literal-block-wrapper docutils container" id="id27">
<div class="code-block-caption"><span class="caption-text">可読性を高める実装テクニック</span><a class="headerlink" href="#id27" title="Link to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># グループ化と表示制御</span>
<span class="nt">parameter_groups</span><span class="p">:</span>
<span class="w">  </span><span class="nt">basic_info</span><span class="p">:</span>
<span class="w">    </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;基本設定&quot;</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;サーバの基本的な設定項目&quot;</span>
<span class="w">    </span><span class="nt">icon</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;server&quot;</span>
<span class="w">    </span><span class="nt">expanded_by_default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">  </span><span class="nt">ssl_config</span><span class="p">:</span>
<span class="w">    </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;SSL/TLS設定&quot;</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;HTTPS通信に関する設定&quot;</span>
<span class="w">    </span><span class="nt">icon</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;shield&quot;</span>
<span class="w">    </span><span class="nt">visible_when</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ssl_enabled</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">true&quot;</span>
<span class="w">    </span><span class="nt">help_text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;本番環境では必ずSSLを有効にしてください&quot;</span>

<span class="w">  </span><span class="nt">advanced_tuning</span><span class="p">:</span>
<span class="w">    </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;詳細チューニング&quot;</span>
<span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;パフォーマンス関連の詳細設定&quot;</span>
<span class="w">    </span><span class="nt">icon</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;tune&quot;</span>
<span class="w">    </span><span class="nt">collapsed_by_default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">warning_text</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;これらの設定は上級者向けです&quot;</span>

<span class="c1"># 入力支援機能</span>
<span class="nt">input_assistance</span><span class="p">:</span>
<span class="w">  </span><span class="nt">hostname</span><span class="p">:</span>
<span class="w">    </span><span class="nt">placeholder</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;例:</span><span class="nv"> </span><span class="s">web01.example.com&quot;</span>
<span class="w">    </span><span class="nt">auto_completion</span><span class="p">:</span>
<span class="w">      </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;dns_lookup&quot;</span>
<span class="w">      </span><span class="nt">suggestions</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;web01&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;web02&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;app01&quot;</span><span class="p p-Indicator">]</span>

<span class="w">    </span><span class="nt">real_time_validation</span><span class="p">:</span>
<span class="w">      </span><span class="nt">dns_resolution</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">format_check</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">duplicate_check</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">  </span><span class="nt">ssl_certificate_file</span><span class="p">:</span>
<span class="w">    </span><span class="nt">file_browser</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">file_filters</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;.crt&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;.pem&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;.cert&quot;</span><span class="p p-Indicator">]</span>
<span class="w">    </span><span class="nt">preview_enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">validation_preview</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;certificate_info_display&quot;</span>
</pre></div>
</div>
</div>
<p><strong>2. パフォーマンス最適化</strong></p>
<div class="literal-block-wrapper docutils container" id="id28">
<div class="code-block-caption"><span class="caption-text">大規模環境での最適化</span><a class="headerlink" href="#id28" title="Link to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># 大量データ対応</span>
<span class="nt">performance_optimizations</span><span class="p">:</span>
<span class="w">  </span><span class="nt">lazy_loading</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">parameters_per_page</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50</span>
<span class="w">    </span><span class="nt">search_index</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;hostname&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;environment&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;server_name&quot;</span><span class="p p-Indicator">]</span>

<span class="w">  </span><span class="nt">bulk_operations</span><span class="p">:</span>
<span class="w">    </span><span class="nt">bulk_update_enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">validation_mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;background&quot;</span>
<span class="w">    </span><span class="nt">progress_tracking</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">  </span><span class="nt">caching</span><span class="p">:</span>
<span class="w">    </span><span class="nt">parameter_schema_cache</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1hour&quot;</span>
<span class="w">    </span><span class="nt">validation_result_cache</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;5minutes&quot;</span>
<span class="w">    </span><span class="nt">dependency_calculation_cache</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;30minutes&quot;</span>

<span class="c1"># バリデーション最適化</span>
<span class="nt">validation_optimization</span><span class="p">:</span>
<span class="w">  </span><span class="nt">async_validation</span><span class="p">:</span>
<span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;30seconds&quot;</span>
<span class="w">    </span><span class="nt">retry_count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>

<span class="w">  </span><span class="nt">batch_validation</span><span class="p">:</span>
<span class="w">    </span><span class="nt">group_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">    </span><span class="nt">parallel_execution</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">max_parallel_groups</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="playbook">
<h2>Playbook実装のベストプラクティス<a class="headerlink" href="#playbook" title="Link to this heading">¶</a></h2>
<section id="id8">
<h3>モジュール化の技法<a class="headerlink" href="#id8" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">Playbookは以下の構造でモジュール化します：</div>
</div>
<p><strong>1. 役割別ディレクトリ構造</strong></p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>playbooks/
├── common/              # 共通処理
│   ├── setup.yml       # 初期設定
│   ├── security.yml    # セキュリティ設定
│   └── monitoring.yml  # 監視設定
├── webserver/          # Webサーバ関連
│   ├── install.yml     # インストール
│   ├── configure.yml   # 設定
│   └── maintain.yml    # メンテナンス
└── database/           # データベース関連
    ├── install.yml
    ├── backup.yml
    └── restore.yml
</pre></div>
</div>
<p><strong>2. 共通タスクの抽象化</strong></p>
<div class="literal-block-wrapper docutils container" id="id29">
<div class="code-block-caption"><span class="caption-text">共通タスクの例</span><a class="headerlink" href="#id29" title="Link to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># common/package_management.yml</span>
<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;パッケージ管理の共通処理&quot;</span>
<span class="w">  </span><span class="nt">block</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;パッケージキャッシュの更新&quot;</span>
<span class="w">      </span><span class="nt">package</span><span class="p">:</span>
<span class="w">        </span><span class="nt">update_cache</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">      </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_os_family == &quot;Debian&quot;</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;パッケージのインストール&quot;</span>
<span class="w">      </span><span class="nt">package</span><span class="p">:</span>
<span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">packages</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;インストール結果の確認&quot;</span>
<span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">item</span><span class="nv"> </span><span class="s">}}</span><span class="nv"> </span><span class="s">--version&quot;</span>
<span class="w">      </span><span class="nt">loop</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">packages</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">version_check</span>
<span class="w">      </span><span class="nt">failed_when</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">version_check.rc != 0</span>
</pre></div>
</div>
</div>
</section>
<section id="id9">
<h3>エラーハンドリングの実装<a class="headerlink" href="#id9" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">堅牢なエラーハンドリングを実装します：</div>
</div>
<p><strong>1. 前提条件チェック</strong></p>
<div class="literal-block-wrapper docutils container" id="id30">
<div class="code-block-caption"><span class="caption-text">前提条件チェックの例</span><a class="headerlink" href="#id30" title="Link to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;前提条件チェック&quot;</span>
<span class="w">  </span><span class="nt">block</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ディスク容量チェック&quot;</span>
<span class="w">      </span><span class="nt">assert</span><span class="p">:</span>
<span class="w">        </span><span class="nt">that</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_facts[&#39;mounts&#39;][0][&#39;size_available&#39;] &gt; 1073741824</span>
<span class="w">        </span><span class="nt">fail_msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ディスク容量が不足しています（最低1GB必要）&quot;</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;メモリ容量チェック&quot;</span>
<span class="w">      </span><span class="nt">assert</span><span class="p">:</span>
<span class="w">        </span><span class="nt">that</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ansible_facts[&#39;memtotal_mb&#39;] &gt; 512</span>
<span class="w">        </span><span class="nt">fail_msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;メモリ容量が不足しています（最低512MB必要）&quot;</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ネットワーク接続チェック&quot;</span>
<span class="w">      </span><span class="nt">uri</span><span class="p">:</span>
<span class="w">        </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;https://example.com&quot;</span>
<span class="w">        </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HEAD</span>
<span class="w">        </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">      </span><span class="nt">delegate_to</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
</pre></div>
</div>
</div>
<p><strong>2. グレースフルなエラー処理</strong></p>
<div class="literal-block-wrapper docutils container" id="id31">
<div class="code-block-caption"><span class="caption-text">グレースフルエラー処理の例</span><a class="headerlink" href="#id31" title="Link to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Webサーバ設定変更&quot;</span>
<span class="w">  </span><span class="nt">block</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;設定ファイルのバックアップ&quot;</span>
<span class="w">      </span><span class="nt">copy</span><span class="p">:</span>
<span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">config_file</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">config_file</span><span class="nv"> </span><span class="s">}}.backup.{{</span><span class="nv"> </span><span class="s">ansible_date_time.epoch</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">remote_src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;新しい設定ファイルの配布&quot;</span>
<span class="w">      </span><span class="nt">template</span><span class="p">:</span>
<span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;httpd.conf.j2&quot;</span>
<span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">config_file</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">backup</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>
<span class="w">      </span><span class="nt">notify</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">restart_httpd</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;設定ファイルの構文チェック&quot;</span>
<span class="w">      </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;httpd</span><span class="nv"> </span><span class="s">-t&quot;</span>
<span class="w">      </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">syntax_check</span>

<span class="w">  </span><span class="nt">rescue</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;設定ファイルの復元&quot;</span>
<span class="w">      </span><span class="nt">copy</span><span class="p">:</span>
<span class="w">        </span><span class="nt">src</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">config_file</span><span class="nv"> </span><span class="s">}}.backup.{{</span><span class="nv"> </span><span class="s">ansible_date_time.epoch</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">dest</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">config_file</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">        </span><span class="nt">remote_src</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">yes</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;エラーログの出力&quot;</span>
<span class="w">      </span><span class="nt">debug</span><span class="p">:</span>
<span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;設定変更に失敗しました:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">syntax_check.stderr</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">default(&#39;Unknown</span><span class="nv"> </span><span class="s">error&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;処理の中断&quot;</span>
<span class="w">      </span><span class="nt">fail</span><span class="p">:</span>
<span class="w">        </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Webサーバ設定変更に失敗しました。設定を復元しました。&quot;</span>
</pre></div>
</div>
</div>
</section>
<section id="id10">
<h3>ログとデバッグの実装<a class="headerlink" href="#id10" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">運用時の問題解決を支援するログ機能を実装します：</div>
</div>
<p><strong>1. 構造化ログ</strong></p>
<div class="literal-block-wrapper docutils container" id="id32">
<div class="code-block-caption"><span class="caption-text">構造化ログの例</span><a class="headerlink" href="#id32" title="Link to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;構造化ログの出力&quot;</span>
<span class="w">  </span><span class="nt">debug</span><span class="p">:</span>
<span class="w">    </span><span class="nt">msg</span><span class="p">:</span>
<span class="w">      </span><span class="nt">timestamp</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ansible_date_time.iso8601</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">inventory_hostname</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="nt">task</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ansible_task_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">task_status</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="nt">duration</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">task_duration</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="nt">details</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">task_details</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>
</div>
</div>
<p><strong>2. パフォーマンス測定</strong></p>
<div class="literal-block-wrapper docutils container" id="id33">
<div class="code-block-caption"><span class="caption-text">パフォーマンス測定の例</span><a class="headerlink" href="#id33" title="Link to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;処理時間測定の開始&quot;</span>
<span class="w">  </span><span class="nt">set_fact</span><span class="p">:</span>
<span class="w">    </span><span class="nt">task_start_time</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ansible_date_time.epoch</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;時間のかかる処理&quot;</span>
<span class="w">  </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;some_long_running_command&quot;</span>
<span class="w">  </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">result</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;処理時間の計算と記録&quot;</span>
<span class="w">  </span><span class="nt">set_fact</span><span class="p">:</span>
<span class="w">    </span><span class="nt">task_duration</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ansible_date_time.epoch</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">int</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">task_start_time</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">int</span><span class="nv"> </span><span class="s">}}&quot;</span>

<span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;パフォーマンスログの出力&quot;</span>
<span class="w">  </span><span class="nt">debug</span><span class="p">:</span>
<span class="w">    </span><span class="nt">msg</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;処理時間:</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">task_duration</span><span class="nv"> </span><span class="s">}}秒</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">ansible_task_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="movement">
<h2>Movement実装のパターン<a class="headerlink" href="#movement" title="Link to this heading">¶</a></h2>
<section id="id11">
<h3>標準的なMovementパターン<a class="headerlink" href="#id11" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">よく使用されるMovementパターンを標準化します：</div>
</div>
<p><strong>1. インストールパターン</strong></p>
<div class="literal-block-wrapper docutils container" id="id34">
<div class="code-block-caption"><span class="caption-text">インストールMovementの例</span><a class="headerlink" href="#id34" title="Link to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Movement: Apache Webサーバインストール</span>
<span class="nt">phases</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;事前チェック&quot;</span>
<span class="w">    </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">前提条件確認</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">リソース確認</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">既存インストール確認</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;インストール実行&quot;</span>
<span class="w">    </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">パッケージインストール</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">初期設定</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">サービス有効化</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;事後確認&quot;</span>
<span class="w">    </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">インストール確認</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">サービス起動確認</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">疎通確認</span>
</pre></div>
</div>
</div>
<p><strong>2. 設定変更パターン</strong></p>
<div class="literal-block-wrapper docutils container" id="id35">
<div class="code-block-caption"><span class="caption-text">設定変更Movementの例</span><a class="headerlink" href="#id35" title="Link to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Movement: 設定ファイル更新</span>
<span class="nt">phases</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;変更前処理&quot;</span>
<span class="w">    </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">現在設定のバックアップ</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">変更内容の妥当性確認</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">影響範囲の特定</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;設定変更実行&quot;</span>
<span class="w">    </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">設定ファイル更新</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">構文チェック</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">サービス再起動</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;変更後確認&quot;</span>
<span class="w">    </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">動作確認</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ログ確認</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">性能確認</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="conductor">
<h2>Conductor実装の高度なテクニック<a class="headerlink" href="#conductor" title="Link to this heading">¶</a></h2>
<section id="id12">
<h3>条件分岐とループ制御<a class="headerlink" href="#id12" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">Conductorで複雑なワークフローを実装します：</div>
</div>
<p><strong>1. 動的な分岐制御</strong></p>
<div class="literal-block-wrapper docutils container" id="id36">
<div class="code-block-caption"><span class="caption-text">動的分岐の例</span><a class="headerlink" href="#id36" title="Link to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">workflow</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;環境タイプ判定&quot;</span>
<span class="w">    </span><span class="nt">movement</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;check_environment_type&quot;</span>
<span class="w">    </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">env_type</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;本番環境処理&quot;</span>
<span class="w">    </span><span class="nt">movement</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;production_deployment&quot;</span>
<span class="w">    </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;env_type.result</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&#39;production&#39;&quot;</span>
<span class="w">    </span><span class="nt">parallel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;検証環境処理&quot;</span>
<span class="w">    </span><span class="nt">movement</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;staging_deployment&quot;</span>
<span class="w">    </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;env_type.result</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">&#39;staging&#39;&quot;</span>
<span class="w">    </span><span class="nt">parallel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">parallel_count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</pre></div>
</div>
</div>
<p><strong>2. 動的なループ処理</strong></p>
<div class="literal-block-wrapper docutils container" id="id37">
<div class="code-block-caption"><span class="caption-text">動的ループの例</span><a class="headerlink" href="#id37" title="Link to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">workflow</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;対象サーバリスト取得&quot;</span>
<span class="w">    </span><span class="nt">movement</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;get_target_servers&quot;</span>
<span class="w">    </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">server_list</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;サーバ別処理実行&quot;</span>
<span class="w">    </span><span class="nt">movement</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;server_maintenance&quot;</span>
<span class="w">    </span><span class="nt">loop</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">server_list.servers</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">loop_var</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;target_server&quot;</span>
<span class="w">    </span><span class="nt">parallel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">max_parallel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="id13">
<h2>テスト実装の自動化<a class="headerlink" href="#id13" title="Link to this heading">¶</a></h2>
<section id="id14">
<h3>テスト用Movementの作成<a class="headerlink" href="#id14" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">自動化の品質を保証するテスト用Movementを作成します：</div>
</div>
<p><strong>1. 単体テスト用Movement</strong></p>
<div class="literal-block-wrapper docutils container" id="id38">
<div class="code-block-caption"><span class="caption-text">単体テスト用Movementの例</span><a class="headerlink" href="#id38" title="Link to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Movement: Apache設定テスト</span>
<span class="nt">test_cases</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;設定ファイル構文テスト&quot;</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;httpd</span><span class="nv"> </span><span class="s">-t&quot;</span>
<span class="w">    </span><span class="nt">expected_rc</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;サービス起動テスト&quot;</span>
<span class="w">    </span><span class="nt">service</span><span class="p">:</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">httpd</span>
<span class="w">      </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">started</span>
<span class="w">    </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">service_status</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ポート待受テスト&quot;</span>
<span class="w">    </span><span class="nt">wait_for</span><span class="p">:</span>
<span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
<span class="w">      </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;HTTP応答テスト&quot;</span>
<span class="w">    </span><span class="nt">uri</span><span class="p">:</span>
<span class="w">      </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://{{</span><span class="nv"> </span><span class="s">inventory_hostname</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">      </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GET</span>
<span class="w">    </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http_response</span>
</pre></div>
</div>
</div>
<p><strong>2. 統合テスト用Conductor</strong></p>
<div class="literal-block-wrapper docutils container" id="id39">
<div class="code-block-caption"><span class="caption-text">統合テスト用Conductorの例</span><a class="headerlink" href="#id39" title="Link to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">integration_test</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;環境初期化&quot;</span>
<span class="w">    </span><span class="nt">movement</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;environment_reset&quot;</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;システム構築&quot;</span>
<span class="w">    </span><span class="nt">movement</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;full_system_build&quot;</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;機能テスト実行&quot;</span>
<span class="w">    </span><span class="nt">movement</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;functional_tests&quot;</span>
<span class="w">    </span><span class="nt">register</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test_results</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;パフォーマンステスト実行&quot;</span>
<span class="w">    </span><span class="nt">movement</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;performance_tests&quot;</span>
<span class="w">    </span><span class="nt">when</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;test_results.success</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">true&quot;</span>

<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;テスト結果レポート&quot;</span>
<span class="w">    </span><span class="nt">movement</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;generate_test_report&quot;</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="id15">
<h2>継続的改善の仕組み<a class="headerlink" href="#id15" title="Link to this heading">¶</a></h2>
<section id="id16">
<h3>メトリクス収集の実装<a class="headerlink" href="#id16" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">自動化の効果を測定するメトリクスを収集します：</div>
</div>
<div class="literal-block-wrapper docutils container" id="id40">
<div class="code-block-caption"><span class="caption-text">メトリクス収集の例</span><a class="headerlink" href="#id40" title="Link to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">metrics_collection</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;実行時間メトリクス&quot;</span>
<span class="w">    </span><span class="nt">vars</span><span class="p">:</span>
<span class="w">      </span><span class="nt">start_time</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ansible_date_time.epoch</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">    </span><span class="nt">tasks</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;処理実行&quot;</span>
<span class="w">        </span><span class="c1"># ... 実際の処理 ...</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;実行時間記録&quot;</span>
<span class="w">        </span><span class="nt">uri</span><span class="p">:</span>
<span class="w">          </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">metrics_endpoint</span><span class="nv"> </span><span class="s">}}/execution_time&quot;</span>
<span class="w">          </span><span class="nt">method</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">POST</span>
<span class="w">          </span><span class="nt">body_format</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">json</span>
<span class="w">          </span><span class="nt">body</span><span class="p">:</span>
<span class="w">            </span><span class="nt">timestamp</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ansible_date_time.iso8601</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">            </span><span class="nt">movement</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">movement_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">            </span><span class="nt">duration</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ansible_date_time.epoch</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">int</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">start_time</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">int</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">            </span><span class="nt">status</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;success&quot;</span>
</pre></div>
</div>
</div>
</section>
<section id="id17">
<h3>フィードバックループの実装<a class="headerlink" href="#id17" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">運用フィードバックを自動化改善に活用する仕組みを実装します：</div>
</div>
<pre  class="mermaid">
        graph LR
    A[運用実行] --&gt; B[メトリクス収集]
    B --&gt; C[分析・評価]
    C --&gt; D[改善提案]
    D --&gt; E[実装・検証]
    E --&gt; A
    </pre></section>
</section>
<section id="id18">
<h2>次のステップ<a class="headerlink" href="#id18" title="Link to this heading">¶</a></h2>
<div class="line-block">
<div class="line">実装技法を理解したら、次は <a class="reference internal" href="../operations/index.html"><span class="doc">運用とガバナンス</span></a> で運用のベストプラクティスを学習しましょう。</div>
<div class="line">運用フェーズでは、実装した自動化基盤を継続的に改善・発展させる方法を解説します。</div>
</div>
</section>
</section>


</div>



<div id="pageTopLink">
  <a href="#container"><i>↑</i> Page Top</a>
</div>

</article>
</div>
</main>
</div><!-- End #contents -->
<div id="footer">
  <footer class="divInner">
    <small>Copyright © 2019-2025 NEC Corporation</small>
    <small><a href="/ja/2.6/terms/ja.html">サイト規約</a></small>
  </footer>
</div><!-- End #footer -->

<div id="overlay"></div>
<div id="grayBack"></div>

</div><!-- End #container -->
  </body>
</html>