================
データの物理削除
================

目的
====
| 不要となったデータを削除することによるリソースの削減、およびパフォーマンスの向上が挙げられます。
| また、削除対象のリソースによっては、機密情報の完全削除を通じてセキュリティを強化することも可能です。

前提条件
========
| 削除できるユーザーは、:menuselection:`管理コンソール-->ロール-メニュー紐付管理` で設定したメニューの紐付 :program:`メンテナンス＋削除可` となっているロールのユーザーとなります。
| また、削除対象となるメニューについては、:menuselection:`基本コンソール-->メニュー-テーブル紐付管理` から削除許可フラグを :program:`有効（True）` にする必要があります。
| :menuselection:`基本コンソール-->メニュー-テーブル紐付管理` は、初期状態では非表示（廃止データ扱い）となっているため :program:`復活` ならびに :program:`メンテナンス可` への変更が必要です。

概要
====
| Exastro IT Automation におけるデータの物理削除とは、データベースからのデータ物理削除、ならびに、ファイルの削除となります。
| 削除されたデータやファイルは復元することができません。

.. danger::
   | 物理削除は、データ復旧ができないというリスクを伴うため、慎重に検討する必要があります。
   | システムに初期状態で存在するデータを削除した場合、正常に動作しなくなる恐れがあるため注意が必要です。

詳細
====

メニュー「基本コンソール:メニュー-テーブル紐付管理」の復活・設定
----------------------------------------------------------------

| 該当メニューの物理削除を実行するためには、メニュー :menuselection:`基本コンソール-->メニュー-テーブル紐付管理` を使用できることが前提となります。
| 初期状態では、メニュー :menuselection:`基本コンソール-->メニュー-テーブル紐付管理` は表示されず、該当メニューの情報を削除することができません。
| メニュー :menuselection:`基本コンソール-->メニュー-テーブル紐付管理` を使用できるようにするには、以下の手順で状態を変更する必要があります。
| すでに、復活状態で紐付 :program:`メンテナンス可` 状態となっている場合は、設定不要です。

#. | メニュー :menuselection:`メニュー-テーブル紐付管理` の復活

   | メニュー :menuselection:`メニュー-テーブル紐付管理` を復活するには以下の手順で実施します。
   |
   | フィルタで、廃止：廃止のみ、メニュー： :program:`基本コンソール:メニュー-テーブル紐付管理` を絞り込みます。
   | 表示されている明細を選択して、:guilabel:`編集` ⇒ :guilabel:`復活` ⇒ :guilabel:`編集確認` ⇒ :guilabel:`編集反映` を実施します。

   .. figure:: /images/ja/manuals/it-automation/physical_deletion/filter_menu_table.png
      :alt: メニュー「基本コンソール:メニュー-テーブル紐付管理」の復活
      :width: 600px
      :align: left
      :class: with-border-thin

#. | メニュー :menuselection:`メニュー-テーブル紐付管理` の紐付 :program:`メンテナンス可` 設定

   | フィルタで、:program:`メニュー：基本コンソール:メニュー-テーブル紐付管理` を絞り込みます。
   | 表示されている明細を選択して、:guilabel:`編集` ⇒ 紐付 :program:`メンテナンス可` 選択 ⇒ :guilabel:`編集反映` を実施します。

   .. figure:: /images/ja/manuals/it-automation/physical_deletion/menu_table_link_update.png
      :alt: メニュー「基本コンソール:メニュー-テーブル紐付管理」の紐付「メンテナンス可」設定
      :width: 600px
      :align: left
      :class: with-border-thin

該当メニューの紐付設定
----------------------

| 続いて、削除したい情報が存在するメニューのロールを変更する必要があります。
| すでに、紐付 :program:`メンテナンス＋削除可` となっている場合は、設定不要です。


#. | 該当メニューの紐付 :program:`メンテナンス＋削除可` 設定

   | フィルタで、メニュー：該当メニューを絞り込みます。
   | 表示されている明細を選択、編集⇒紐付 :program:`メンテナンス＋削除可` 選択⇒編集反映を実施します。

   .. figure:: /images/ja/manuals/it-automation/physical_deletion/user_menu_update.png
      :alt: メニュー「基本コンソール:メニュー-テーブル紐付管理」の紐付「メンテナンス可」設定
      :width: 600px
      :align: left
      :class: with-border-thin

.. note::
   | 一部のメニューについては、紐付で :program:`メンテナンス＋削除可` を設定できますが、削除することができないメニュー、削除するとシステムが動作しなくなるメニューがあります。
   | 削除非推奨メニューついては、次の内容を確認してください。

削除非推奨のメニュー
^^^^^^^^^^^^^^^^^^^^
.. list-table:: 削除非推奨のメニュー
   :widths: 10 20 15
   :header-rows: 1
   :align: left
   :class: filter-table

   * - | UUID
     -	| メニュー
     - | 補足
   * - | 110103
     - | イベント:イベントフロー
     - | 削除不可
   * - | 110104
     - | イベント:イベント履歴
     - | 削除不可
   * - | 110104-001
     - | イベント:イベント履歴
     - | 削除不可
   * - | 20208
     - | Ansible-Legacy:作業実行
     - | 削除不可
   * - | 20208-001
     - | Ansible-Legacy:作業実行
     - | 削除不可
   * - | 20209
     - | Ansible-Legacy:作業状態確認
     - | 削除不可
   * - | 20310
     - | Ansible-Pioneer:作業実行
     - | 削除不可
   * - | 20310-001
     - | Ansible-Pioneer:作業実行
     - | 削除不可
   * - | 20311
     - | Ansible-Pioneer:作業状態確認
     - | 削除不可
   * - | 20410
     - | Ansible-LegacyRole:作業実行
     - | 削除不可
   * - | 20410-001
     - | Ansible-LegacyRole:作業実行
     - | 削除不可
   * - | 20411
     - | Ansible-LegacyRole:作業状態確認
     - | 削除不可
   * - | 30101
     - | Conductor:Conductorインターフェース情報
     - | 全件削除時にConductor編集/作業実行でエラーとなる
   * - | 30104
     - | Conductor:Conductor編集/作業実行
     - | 削除不可
   * - | 30106
     - | Conductor:Conductor作業確認
     - | 削除不可
   * - | 50101
     - | パラメータシート作成:パラメータシート定義・作成
     - | 削除不可
   * - | 50501
     - | パラメータ集:パラメータ集
     - | 削除不可
   * - | 60101
     - | エクスポート/インポート:メニューエクスポート
     - | 削除不可
   * - | 60102
     - | エクスポート/インポート:メニューインポート
     - | 削除不可
   * - | 60104
     - | エクスポート/インポート:Excel一括エクスポート
     - | 削除不可
   * - | 60105
     - | エクスポート/インポート:Excel一括インポート
     - | 削除不可
   * - | 80113
     - | Terraform-Cloud/EP:作業実行
     - | 削除不可
   * - | 80115
     - | Terraform-Cloud/EP:作業状態確認
     - | 削除不可
   * - | 90108
     - | Terraform-CLI:作業実行
     - | 削除不可
   * - | 90110
     - | Terraform-CLI:作業状態確認
     - | 削除不可
   * - | [システムで付与されたID]
     - | [独自のメニューグループ]
     - | 削除不可

該当メニューの削除許可フラグ有効化
----------------------------------

| 続いて、削除したい情報が存在するメニューの削除許可フラグを有効化する必要があります。
| 削除許可フラグの有効化は、メニュー :menuselection:`基本コンソール-->メニュー-テーブル紐付管理` より行います。
| すでに、削除許可フラグが有効化されている場合は、設定不要です。

#. | 該当メニューの削除許可フラグ有効化

   | フィルタで、メニュー：該当メニューを絞り込みます。
   | 表示されている明細を選択して、編集⇒削除許可フラグ :program:`True` 選択⇒編集反映を実施します。

   .. figure:: /images/ja/manuals/it-automation/physical_deletion/menu_table_link_list_update.png
      :alt: 該当メニューの削除許可フラグ有効化
      :width: 600px
      :align: left
      :class: with-border-thin

情報の削除
----------

| 上述した、設定を行うことで、該当情報の削除が行えるようになります。
| 該当情報の削除は、該当メニューを選択して、フィルタやデフォルト表示された一覧から、削除対象となる情報を選択して削除します。
| :guilabel:`削除` ボタンが非表示の場合は、設定を再度確認してください。

該当情報の選択
^^^^^^^^^^^^^^
| 該当メニューで、情報を絞り込む際は、フィルタで情報を絞り込みます。（メニューによっては、フィルタが無い場合もあります）
| 表示されている明細を選択して、:guilabel:`削除` ボタンを押下することで、削除対象確認が表示されます。

.. figure:: /images/ja/manuals/it-automation/physical_deletion/delete_target_select.png
   :alt: 該当情報の選択
   :width: 600px
   :align: left
   :class: with-border-thin


削除対象確認
^^^^^^^^^^^^

| 選択された削除対象の情報が表示されます。
| 対象に問題が無ければ、:guilabel:`削除` ボタン押下します。
| 押下後、削除の実行確認が表示されます。
| 削除の実行確認で、:kbd:`delete` を入力することで、選択された情報が削除されます。

.. figure:: /images/ja/manuals/it-automation/physical_deletion/delete_target_confirm.png
   :alt: 削除対象確認
   :width: 600px
   :align: left
   :class: with-border-thin

.. figure:: /images/ja/manuals/it-automation/physical_deletion/delete_execute_confirm.png
   :alt: 削除の実行確認
   :width: 600px
   :align: left
   :class: with-border-thin

.. note::
   | ファイルがCloud上のストレージに格納されている場合は、削除に時間がかかる場合があります。
   | タイムアウトによりエラーが発生した場合でも、実際の削除処理が継続されている可能性がありますので、フィルタで画面を更新し、対象が消えるまでお待ちください。

.. danger::
   | 物理削除されたデータ、ならびに、ファイルは復旧することはできません。
   | また、履歴がある場合は、履歴を含めたすべての内容が削除されます。



