<!DOCTYPE html>

<html lang="ja" data-content_root="../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-144561796-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-144561796-1');
    </script>
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    <title>Exastro on Kubernetes - Offline &#8212; Documentation  ドキュメント</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fe63c2af" />
    <link rel="stylesheet" type="text/css" href="../../../_static/option.css?v=49ab891d" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/tabs.css?v=a5c4661c" />
    <link rel="stylesheet" type="text/css" href="../../../_static/exastro_documents.css?v=57fb2187" />
    <link rel="stylesheet" type="text/css" href="../../../_static/swagger/swagger-ui.css?v=ab82c586" />
    
    <script src="../../../_static/documentation_options.js?v=c033477b"></script>
    <script src="../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=3e58b9f8"></script>
    <script src="../../../_static/translations.js?v=4755f45a"></script>
    <script src="../../../_static/jquery-3.6.3.min.js?v=25455f10"></script>
    <script src="../../../_static/exastro_documents.js?v=ff50fb31"></script>
    <script src="../../../_static/swagger/swagger-ui-bundle.js?v=ec73a32a"></script>
    <script src="../../../_static/swagger/swagger-ui-standalone-preset.js?v=88d26966"></script>
    <link rel="icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="検索" href="../../../search.html" />
    <link rel="next" title="Exastro on Docker Compose - Offline" href="docker_compose.html" />
    <link rel="prev" title="Exastro" href="index.html" /> 
  </head>
<body id="page" class="ja">


<div id="container">

<div id="header">
  <header class="divInner">
    <!-- Exastro logo -->
    <div id="logo"><a href="https://ita.exastro.org/"><img src="../../../_static/img/exastro.svg" alt="Exastro"></a></div>
    <!-- Project name -->
    <div id="projectName"><a href="../../../index.html">Documentation</a></div>
    <!-- Heaedr navigation -->
    <div id="headerSearch">
      <form class="search" action="../../../search.html" method="get">
        <input type="text" name="q" aria-labelledby="searchlabel">
        <button type="submit" value="検索"><img src="../../../_static/img/search.png" alt="検索"></button>
      </form>
    </div>
  </header>
</div><!-- End #header -->


<div id="toolbar">
  <div class="divInner">
    
    <div id="documentVersion">
      <dl>
        <dt>Document version</dt>
        <dd>
          <div>
            <select name="version" onchange="location.href=value;">
              <option value="../../../../../ja/2.5/installation/offline/exastro/kubernetes.html" selected>current</option>
              <option value="../../../../../ja/2.5/installation/offline/exastro/kubernetes.html" selected>2.5(current)</option>
              <option value="../../../../../ja/2.4/installation/offline/exastro/kubernetes.html">2.4</option>
              <option value="../../../../../ja/2.3/installation/offline/exastro/kubernetes.html">2.3</option>
              <option value="../../../../../ja/2.2/installation/offline/exastro/kubernetes.html">2.2</option>
              <option value="../../../../../ja/2.1/installation/offline/exastro/kubernetes.html">2.1</option>
              <option value="../../../../../ja/2.0/installation/offline/exastro/kubernetes.html">2.0</option>
            </select>
          </div>
        </dd>
      </dl>
    </div>

    <div id="documentLanguage">
      <dl>
        <dt>Language</dt>
        <dd>
          <div>
            <select name="lang" onchange="location.href=value;">
              <option value="../../../../../ja/2.5/installation/offline/exastro/kubernetes.html" selected>日本語</option>
              <option value="../../../../../en/2.5/installation/offline/exastro/kubernetes.html">English</option>
            </select>
          </div>
        </dd>
      </dl>
    </div>
    <div id="toolbarNavigation">
      <ul>
        <li class="prev"><a href="index.html" title="前のトピックへ">Exastro</a></li>
        <li class="next"><a href="docker_compose.html" title="次のトピックへ">Exastro on Docker Compose - Offline</a></li>
      </ul>
    </div>
  </div>
</div><!-- End #toolbar -->

<div id="sideMenu">

  <div id="menuButton"></div>
  
  <aside class="divInner">
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../configuration/index.html">構成・構築ガイド</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../index.html">インストール</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../online/index.html">オンライン</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">オフライン</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="index.html">Exastro</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">Exastro on Kubernetes - Offline</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#id1">目的</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id2">特徴</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id3">前提条件</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id4">全体の流れ</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id7">オンライン環境(インターネットに接続できる環境)での作業</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id18">オフライン環境(インターネットに接続できない環境)での作業</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id28">オーガナイゼーションの作成</a></li>
<li class="toctree-l5"><a class="reference internal" href="#id29">ワークスペースの作成</a></li>
<li class="toctree-l5"><a class="reference internal" href="#kubesprayexastro">kubespray及びExastroのインストール時にエラーが発生した場合の対応</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="docker_compose.html">Exastro on Docker Compose - Offline</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../learn/index.html">Learn</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../manuals/index.html">マニュアル</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../templates/index.html">テンプレート</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">リファレンス</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contribute/index.html">貢献</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../kb/index.html">ナレッジベース</a></li>
</ul>

    <!-- <ul>
      <li class="toctree-l1"><a class="reference internal" href="../../../../genindex.html">索引</a></li>
    </ul> -->
    
  </aside>
</div><!-- End #sideMenu -->


<div id="tableOfContents">
  <div id="tocButton"></div>
  <ul>
<li><a class="reference internal" href="#">Exastro on Kubernetes - Offline</a><ul>
<li><a class="reference internal" href="#id1">目的</a></li>
<li><a class="reference internal" href="#id2">特徴</a></li>
<li><a class="reference internal" href="#id3">前提条件</a></li>
<li><a class="reference internal" href="#id4">全体の流れ</a><ul>
<li><a class="reference internal" href="#id5">オンライン環境での手順</a></li>
<li><a class="reference internal" href="#id6">オフライン環境での手順</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id7">オンライン環境(インターネットに接続できる環境)での作業</a><ul>
<li><a class="reference internal" href="#id8">①事前準備</a></li>
<li><a class="reference internal" href="#helm">②helmリポジトリ及び設定ファイルの編集</a><ul>
<li><a class="reference internal" href="#id10">サービス公開の設定</a></li>
<li><a class="reference internal" href="#id11">データベース連携</a></li>
<li><a class="reference internal" href="#db">アプリケーションの DB ユーザー設定</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id12">設定例</a><ul>
<li><a class="reference internal" href="#gitlab">GitLab 連携設定</a></li>
<li><a class="reference internal" href="#id13">システム管理者の作成</a></li>
<li><a class="reference internal" href="#id14">永続ボリュームの設定</a></li>
</ul>
</li>
<li><a class="reference internal" href="#kubespraykubernetes">③kubespray及びkubernetesのコンテナイメージの取得</a></li>
<li><a class="reference internal" href="#id15">④パッケージファイルの取得</a></li>
<li><a class="reference internal" href="#exastro">⑤Exastroのコンテナイメージを取得</a></li>
<li><a class="reference internal" href="#id16">⑥オフライン環境で使用するシェルスクリプト等を作成</a></li>
<li><a class="reference internal" href="#id17">資材の転送</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id18">オフライン環境(インターネットに接続できない環境)での作業</a><ul>
<li><a class="reference internal" href="#id19">⑦資材受け取り</a></li>
<li><a class="reference internal" href="#ansible">⑧Ansible実行サーバでの準備</a></li>
<li><a class="reference internal" href="#id20">⑨Exastroインストールサーバでの準備</a></li>
<li><a class="reference internal" href="#id21">⑩kubernetesのコンテナイメージの設定</a></li>
<li><a class="reference internal" href="#nginx">⑪自己署名証明書及びNginxの設定</a></li>
<li><a class="reference internal" href="#id22">⑫パッケージのインストール</a></li>
<li><a class="reference internal" href="#kubespray">⑬kubesprayのインストール</a></li>
<li><a class="reference internal" href="#id23">⑭Exastroのインストール</a></li>
<li><a class="reference internal" href="#id24">⑮Exastroインストール後の設定</a><ul>
<li><a class="reference internal" href="#id25">管理コンソールへのログイン</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id28">オーガナイゼーションの作成</a></li>
<li><a class="reference internal" href="#id29">ワークスペースの作成</a></li>
<li><a class="reference internal" href="#kubesprayexastro">kubespray及びExastroのインストール時にエラーが発生した場合の対応</a></li>
</ul>
</li>
</ul>

</div>


<div id="contents">
<main class="divInner">

 <div id="breadcrumbs">
  <ul>
    <li><a href="../../../index.html">HOME</a></li>
    <li><a href="../../index.html">インストール</a></li>
    <li><a href="../index.html">オフライン</a></li>
    <li><a href="index.html">Exastro</a></li>
    
    <li>Exastro on Kubernetes - Offline</li>
  </ul>
</div>

<div id="article">
<article class="divInner">
<div class="body" role="main">

  <script>
$(window).on('load', function () {
   setTimeout(function(){
     for (var i = 0; i < $("table.filter-table").length; i++) {
       $("[id^='ft-data-" + i + "-2-r']").removeAttr("checked");
       $("[id^='select-all-" + i + "-2']").removeAttr("checked");
       $("[id^='ft-data-" + i + "-2-r'][value^='可']").prop('checked', true);
       $("[id^='ft-data-" + i + "-2-r'][value*='必須']").prop('checked', true);
       tFilterGo(i);
     }
   },200);
});
</script><section id="exastro-on-kubernetes-offline">
<h1>Exastro on Kubernetes - Offline<a class="headerlink" href="#exastro-on-kubernetes-offline" title="Link to this heading">¶</a></h1>
<section id="id1">
<h2>目的<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h2>
<div class="line-block">
<div class="line">本書では、Exastro IT Automation を利用する際に必要となる、Exastro Platform および Exastro IT Automation を Kubernetes 上に導入する手順について説明します。</div>
</div>
</section>
<section id="id2">
<h2>特徴<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<div class="line-block">
<div class="line">高い可用性やサービスレベルを必要とされる際の、Exastro IT Automation の導入方法となります。</div>
<div class="line">評価や一時的な利用など、簡単に利用を開始したい場合には、<a class="reference internal" href="docker_compose.html"><span class="doc">Docker Compose 版</span></a> の利用を推奨します。</div>
</div>
</section>
<section id="id3">
<h2>前提条件<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h2>
<div class="line-block">
<div class="line">資材を収集する環境とインストールする環境では、OSを一致させる必要があります。</div>
<div class="line">資材を収集するサーバは <strong class="command">curl</strong> コマンドが実行できる必要があります。</div>
<div class="line">オフライン環境として使用するサーバはFirewalldがインストールされている必要があります。</div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line">kubernetesのオフライン用設定ファイルを適用するため、Exastroをインストールサーバは外部と通信できないことを確認してください。</div>
</div>
</div>
<ul>
<li><p>クライアント要件</p>
<div class="line-block">
<div class="line">動作確認が取れているクライアントアプリケーションのバージョンは下記のとおりです。</div>
</div>
<table class="docutils align-default" id="id30">
<caption><span class="caption-number">表 51 </span><span class="caption-text">クライアント要件</span><a class="headerlink" href="#id30" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 50.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>アプリケーション</p></th>
<th class="head"><p>バージョン</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Helm</p></td>
<td><p>v3.9.x</p></td>
</tr>
<tr class="row-odd"><td><p>kubectl</p></td>
<td><p>1.23</p></td>
</tr>
</tbody>
</table>
</li>
<li><p>動作確認済みオペレーティングシステム</p>
<p>以下は、動作確認済のバージョンとなります。</p>
<table class="docutils align-default" id="id31">
<caption><span class="caption-number">表 52 </span><span class="caption-text">オペレーティングシステム</span><a class="headerlink" href="#id31" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 50.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>種別</p></th>
<th class="head"><p>バージョン</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Red Hat Enterprise Linux</p></td>
<td><p>バージョン    8.9</p></td>
</tr>
</tbody>
</table>
</li>
<li><p>デプロイ環境</p>
<div class="line-block">
<div class="line">動作確認が取れているコンテナ環境の最小要求リソースとバージョンは下記のとおりです。</div>
</div>
<table class="docutils align-default" id="id32">
<caption><span class="caption-number">表 53 </span><span class="caption-text">ハードウェア要件(最小構成)</span><a class="headerlink" href="#id32" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 50.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>リソース種別</p></th>
<th class="head"><p>要求リソース</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CPU</p></td>
<td><p>2 Cores (3.0 GHz, x86_64)</p></td>
</tr>
<tr class="row-odd"><td><p>Memory</p></td>
<td><p>4GB</p></td>
</tr>
<tr class="row-even"><td><p>Storage (Container image size)</p></td>
<td><p>10GB</p></td>
</tr>
<tr class="row-odd"><td><p>Kubernetes (Container image size)</p></td>
<td><p>1.23 以上</p></td>
</tr>
</tbody>
</table>
<table class="docutils align-default" id="id33">
<caption><span class="caption-number">表 54 </span><span class="caption-text">ハードウェア要件(推奨構成)</span><a class="headerlink" href="#id33" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 50.0%" />
<col style="width: 50.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>リソース種別</p></th>
<th class="head"><p>要求リソース</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>CPU</p></td>
<td><p>4 Cores (3.0 GHz, x86_64)</p></td>
</tr>
<tr class="row-odd"><td><p>Memory</p></td>
<td><p>16GB</p></td>
</tr>
<tr class="row-even"><td><p>Storage (Container image size)</p></td>
<td><p>120GB</p></td>
</tr>
<tr class="row-odd"><td><p>Kubernetes (Container image size)</p></td>
<td><p>1.23 以上</p></td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line">要求リソースは Exastro IT Automation のコア機能に対する値です。同一クラスタ上に Keycloak や MariaDB などの外部ツールをデプロイする場合は、その分のリソースが別途必要となります。</div>
<div class="line">データベースおよびファイルの永続化のために、別途ストレージ領域を用意する必要があります。</div>
<div class="line">Storage サイズには、Exastro IT Automation が使用する入出力データのファイルは含まれていないため、利用状況に応じて容量を見積もる必要があります。</div>
</div>
</div>
</li>
<li><p>通信要件</p>
<ul>
<li><div class="line-block">
<div class="line">クライアントからデプロイ先のコンテナ環境にアクセスできる必要があります。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Platform 管理者用と一般ユーザー用の2つ通信ポートが使用となります。</div>
</div>
</li>
<li><div class="line-block">
<div class="line">コンテナ環境からコンテナイメージの取得のために、Docker Hub に接続できる必要があります。</div>
</div>
</li>
</ul>
</li>
<li><p>外部コンポーネント</p>
<ul>
<li><div class="line-block">
<div class="line">MariaDB、もしくは、MySQL サーバ</div>
</div>
</li>
<li><div class="line-block">
<div class="line">GitLab リポジトリ、および、アカウントの払い出しが可能なこと</div>
</div>
</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line">GitLab 環境を同一クラスタに構築する場合は、GitLab のシステム要件に対応する最小要件を追加で容易する必要があります。</div>
<div class="line">Database 環境を同一クラスタに構築する場合は、使用する Database のシステム要件に対応する最小要件を定義する必要があります</div>
</div>
</div>
</li>
</ul>
</section>
<section id="id4">
<h2>全体の流れ<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h2>
<div class="line-block">
<div class="line">オンライン環境での作業完了後に、オフライン環境にてインストールを実施します。</div>
<div class="line">※本説明では、資材収集サーバー1台、Ansible実行サーバ1台、Exastroインストールサーバ1台の計3台で実施しています。</div>
</div>
<figure class="align-default">
<a class="reference internal image-reference" href="../../../_images/k8s_flow.png"><img alt="フローイメージ" src="../../../_images/k8s_flow.png" style="width: 900px;" />
</a>
</figure>
<section id="id5">
<h3>オンライン環境での手順<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">①事前準備</div>
<div class="line">②helmリポジトリ及び設定ファイルの取得</div>
<div class="line">③kubespray及びkubernetesのコンテナイメージの取得</div>
<div class="line">④パッケージファイルの取得</div>
<div class="line">⑤Exastroのコンテナイメージを取得</div>
<div class="line">⑥オフライン環境で使用するシェルスクリプト等を作成</div>
</div>
</section>
<section id="id6">
<h3>オフライン環境での手順<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">⑦資材受け取り</div>
<div class="line">⑧Ansible実行サーバでの準備</div>
<div class="line">⑨Exastroインストールサーバでの準備</div>
<div class="line">⑩kubernetesのコンテナイメージの設定</div>
<div class="line">⑪自己署名証明書及びNginxの設定</div>
<div class="line">⑫パッケージのインストール</div>
<div class="line">⑬kubesprayのインストール</div>
<div class="line">⑭Exastroのインストール</div>
<div class="line">⑮Exastroインストール後の設定</div>
</div>
</section>
</section>
<section id="id7">
<h2>オンライン環境(インターネットに接続できる環境)での作業<a class="headerlink" href="#id7" title="Link to this heading">¶</a></h2>
<div class="line-block">
<div class="line">資材の収集を行います。</div>
</div>
<section id="id8">
<h3>①事前準備<a class="headerlink" href="#id8" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">コンテナイメージを取得するため <strong class="command">docker</strong> コマンドを使用します。</div>
<div class="line">インストールされていない場合は以下の手順でdockerをインストールします。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id34">
<div class="code-block-caption"><span class="caption-number">リスト 188 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id34" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dnf<span class="w"> </span>config-manager<span class="w"> </span>--add-repo<span class="o">=</span>https://download.docker.com/linux/centos/docker-ce.repo

dnf<span class="w"> </span>remove<span class="w"> </span>-y<span class="w"> </span>runc

dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>docker-ce<span class="w"> </span>docker-ce-cli<span class="w"> </span>containerd.io<span class="w"> </span>container-selinux

systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>docker

cat<span class="w"> </span>/etc/group<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>docker
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">ユーザーがグループに追加されていない場合は以下を実行します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id35">
<div class="code-block-caption"><span class="caption-number">リスト 189 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id35" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>usermod<span class="w"> </span>-aG<span class="w"> </span>docker<span class="w"> </span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span>

cat<span class="w"> </span>/etc/group<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>docker

reboot
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">コンテナイメージを取得する際、dockerのバージョンによってはDocker Image Format v1 及び Docker Image manifestについてのエラーが起きることがあります。</div>
<div class="line">環境変数を追加し、事前に対応します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id36">
<div class="code-block-caption"><span class="caption-number">リスト 190 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id36" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w">  </span>/etc/systemd/system/docker.service.d

<span class="c1">#docker.service.dディレクトリが存在しない場合は新しく作成する</span>
<span class="nb">cd</span><span class="w">  </span>/etc/systemd/system/

mkdir<span class="w"> </span>docker.service.d<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>docker.service.d
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">http-proxy.confが存在しない場合は新しく作成し、以下の2行を記載します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id37">
<div class="code-block-caption"><span class="caption-number">リスト 191 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id37" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>vi<span class="w"> </span>http-proxy.conf

<span class="o">[</span>Service<span class="o">]</span>
<span class="nv">Environment</span><span class="o">=</span><span class="s2">&quot;DOCKER_ENABLE_DEPRECATED_PULL_SCHEMA_1_IMAGE=1&quot;</span>
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">ファイルが存在する場合はEnvironment=&quot;DOCKER_ENABLE_DEPRECATED_PULL_SCHEMA_1_IMAGE=1&quot;を追記します。</div>
</div>
</div>
<div class="line-block">
<div class="line">dockerを再起動し、追加した環境変数を確認します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id38">
<div class="code-block-caption"><span class="caption-number">リスト 192 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id38" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>systemctl<span class="w"> </span>daemon-reload

systemctl<span class="w"> </span>restart<span class="w"> </span>docker

systemctl<span class="w"> </span>show<span class="w"> </span>--property<span class="o">=</span>Environment<span class="w"> </span>docker
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">その他に必要なパッケージをインストールします。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id39">
<div class="code-block-caption"><span class="caption-number">リスト 193 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id39" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>git<span class="w"> </span>python39

pip3.9<span class="w"> </span>install<span class="w"> </span>ruamel-yaml

pip3.9<span class="w"> </span>install<span class="w"> </span>ansible
</pre></div>
</div>
</div>
</section>
<section id="helm">
<h3>②helmリポジトリ及び設定ファイルの編集<a class="headerlink" href="#helm" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">作業用ディレクトリを作成します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id40">
<div class="code-block-caption"><span class="caption-number">リスト 194 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id40" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/tmp

mkdir<span class="w"> </span>work<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>work
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line"><strong class="command">helm</strong> コマンドがインストールされていない場合、以下の手順でインストールします。</div>
<div class="line">詳細は <a class="reference external" href="https://helm.sh/ja/docs/intro/install/">helmの公式ドキュメント</a> をご参照ください。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id41">
<div class="code-block-caption"><span class="caption-number">リスト 195 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id41" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>-fsSL<span class="w"> </span>-o<span class="w"> </span>get_helm.sh<span class="w"> </span>https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3

chmod<span class="w"> </span><span class="m">700</span><span class="w"> </span>get_helm.sh

./get_helm.sh

helm<span class="w"> </span>version
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">Exastro システムの Helm リポジトリを登録後、リポジトリを取得します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id42">
<div class="code-block-caption"><span class="caption-number">リスト 196 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id42" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>exastro<span class="w"> </span>https://exastro-suite.github.io/exastro-helm/<span class="w"> </span>--namespace<span class="w"> </span>exastro

helm<span class="w"> </span>repo<span class="w"> </span>update

helm<span class="w"> </span>pull<span class="w"> </span>exastro/exastro

rm<span class="w"> </span>-f<span class="w"> </span>get_helm.sh
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">設定ファイルを取得し、以降の手順でパラメータを設定していきます。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id43">
<div class="code-block-caption"><span class="caption-number">リスト 197 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id43" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>helm<span class="w"> </span>show<span class="w"> </span>values<span class="w"> </span>exastro/exastro<span class="w"> </span>&gt;<span class="w"> </span>exastro.yaml
</pre></div>
</div>
</div>
<details>
  <summary>exastro.yaml</summary><div class="literal-block-wrapper docutils container" id="id44">
<div class="code-block-caption"><span class="caption-number">リスト 198 </span><span class="caption-text">exastro.yaml</span><a class="headerlink" href="#id44" title="Link to this code">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="c1"># Default values for Exastro.</span>
<span class="linenos">  2</span><span class="c1"># This is a YAML-formatted file.</span>
<span class="linenos">  3</span><span class="c1"># Declare variables to be passed into your templates.</span>
<span class="linenos">  4</span><span class="nt">global</span><span class="p">:</span>
<span class="linenos">  5</span><span class="w">  </span><span class="nt">itaGlobalDefinition</span><span class="p">:</span>
<span class="linenos">  6</span><span class="w">    </span><span class="nt">config</span><span class="p">:</span>
<span class="linenos">  7</span><span class="w">      </span><span class="nt">DEFAULT_LANGUAGE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ja&quot;</span>
<span class="linenos">  8</span><span class="w">      </span><span class="nt">LANGUAGE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;en&quot;</span>
<span class="linenos">  9</span><span class="w">      </span><span class="nt">TZ</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Asia/Tokyo&quot;</span>
<span class="linenos"> 10</span><span class="w">    </span><span class="nt">secret</span><span class="p">:</span>
<span class="linenos"> 11</span><span class="w">      </span><span class="nt">ENCRYPT_KEY</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos"> 12</span><span class="w">    </span><span class="nt">persistence</span><span class="p">:</span>
<span class="linenos"> 13</span><span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos"> 14</span><span class="w">      </span><span class="nt">accessMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteMany</span>
<span class="linenos"> 15</span><span class="w">      </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10Gi</span>
<span class="linenos"> 16</span><span class="w">      </span><span class="nt">volumeType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hostPath</span><span class="w"> </span><span class="c1"># e.g.) hostPath or AKS</span>
<span class="linenos"> 17</span><span class="w">      </span><span class="nt">storageClass</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="w"> </span><span class="c1"># e.g.) azurefile or - (None)</span>
<span class="linenos"> 18</span><span class="w">      </span><span class="c1"># matchLabels:</span>
<span class="linenos"> 19</span><span class="w">      </span><span class="c1">#   release: &quot;stable&quot;</span>
<span class="linenos"> 20</span><span class="w">      </span><span class="c1"># matchExpressions:</span>
<span class="linenos"> 21</span><span class="w">      </span><span class="c1">#   - {key: environment, operator: In, values: [dev]}</span>
<span class="linenos"> 22</span><span class="w">  </span><span class="nt">itaDatabaseDefinition</span><span class="p">:</span>
<span class="linenos"> 23</span><span class="w">    </span><span class="nt">config</span><span class="p">:</span>
<span class="linenos"> 24</span><span class="w">      </span><span class="nt">DB_VENDOR</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb&quot;</span>
<span class="linenos"> 25</span><span class="w">      </span><span class="nt">DB_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb&quot;</span>
<span class="linenos"> 26</span><span class="w">      </span><span class="nt">DB_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3306&quot;</span>
<span class="linenos"> 27</span><span class="w">      </span><span class="nt">DB_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ITA_DB&quot;</span>
<span class="linenos"> 28</span><span class="w">    </span><span class="nt">secret</span><span class="p">:</span>
<span class="linenos"> 29</span><span class="w">      </span><span class="nt">DB_ADMIN_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;root&quot;</span>
<span class="linenos"> 30</span><span class="w">      </span><span class="nt">DB_ADMIN_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Ch@ngeMeDBAdm&quot;</span>
<span class="linenos"> 31</span><span class="w">      </span><span class="nt">DB_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ITA_USER&quot;</span>
<span class="linenos"> 32</span><span class="w">      </span><span class="nt">DB_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Ch@ngeMeITADB&quot;</span>
<span class="linenos"> 33</span><span class="w">  </span><span class="nt">pfGlobalDefinition</span><span class="p">:</span>
<span class="linenos"> 34</span><span class="w">    </span><span class="nt">config</span><span class="p">:</span>
<span class="linenos"> 35</span><span class="w">      </span><span class="nt">DEFAULT_LANGUAGE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ja&quot;</span>
<span class="linenos"> 36</span><span class="w">      </span><span class="nt">LANGUAGE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;en&quot;</span>
<span class="linenos"> 37</span><span class="w">      </span><span class="nt">TZ</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Asia/Tokyo&quot;</span>
<span class="linenos"> 38</span><span class="w">    </span><span class="nt">secret</span><span class="p">:</span>
<span class="linenos"> 39</span><span class="w">      </span><span class="nt">ENCRYPT_KEY</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos"> 40</span><span class="w">  </span><span class="nt">pfAuditLogDefinition</span><span class="p">:</span>
<span class="linenos"> 41</span><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pf-auditlog</span>
<span class="linenos"> 42</span><span class="w">    </span><span class="nt">persistence</span><span class="p">:</span>
<span class="linenos"> 43</span><span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="linenos"> 44</span><span class="w">      </span><span class="nt">reinstall</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="linenos"> 45</span><span class="w">      </span><span class="nt">accessMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteMany</span>
<span class="linenos"> 46</span><span class="w">      </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10Gi</span>
<span class="linenos"> 47</span><span class="w">      </span><span class="nt">volumeType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hostPath</span><span class="w"> </span><span class="c1"># e.g.) hostPath or AKS</span>
<span class="linenos"> 48</span><span class="w">      </span><span class="nt">storageClass</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="w"> </span><span class="c1"># e.g.) azurefile or - (None)</span>
<span class="linenos"> 49</span><span class="w">      </span><span class="c1"># matchLabels:</span>
<span class="linenos"> 50</span><span class="w">      </span><span class="c1">#   release: &quot;stable&quot;</span>
<span class="linenos"> 51</span><span class="w">      </span><span class="c1"># matchExpressions:</span>
<span class="linenos"> 52</span><span class="w">      </span><span class="c1">#   - {key: environment, operator: In, values: [dev]}</span>
<span class="linenos"> 53</span><span class="w">  </span><span class="nt">pfDatabaseDefinition</span><span class="p">:</span>
<span class="linenos"> 54</span><span class="w">    </span><span class="nt">config</span><span class="p">:</span>
<span class="linenos"> 55</span><span class="w">      </span><span class="nt">DB_VENDOR</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb&quot;</span>
<span class="linenos"> 56</span><span class="w">      </span><span class="nt">DB_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mariadb&quot;</span>
<span class="linenos"> 57</span><span class="w">      </span><span class="nt">DB_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3306&quot;</span>
<span class="linenos"> 58</span><span class="w">      </span><span class="nt">DB_DATABASE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform&quot;</span>
<span class="linenos"> 59</span><span class="w">    </span><span class="nt">secret</span><span class="p">:</span>
<span class="linenos"> 60</span><span class="w">      </span><span class="nt">DB_ADMIN_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;root&quot;</span>
<span class="linenos"> 61</span><span class="w">      </span><span class="nt">DB_ADMIN_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Ch@ngeMeDBAdm&quot;</span>
<span class="linenos"> 62</span><span class="w">      </span><span class="nt">DB_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;pf-user&quot;</span>
<span class="linenos"> 63</span><span class="w">      </span><span class="nt">DB_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Ch@ngeMePFDB&quot;</span>
<span class="linenos"> 64</span><span class="w">  </span><span class="nt">keycloakDefinition</span><span class="p">:</span>
<span class="linenos"> 65</span><span class="w">    </span><span class="nt">secret</span><span class="p">:</span>
<span class="linenos"> 66</span><span class="w">      </span><span class="nt">SYSTEM_ADMIN</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;admin&quot;</span>
<span class="linenos"> 67</span><span class="w">      </span><span class="nt">SYSTEM_ADMIN_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Ch@ngeMeKCAdm&quot;</span>
<span class="linenos"> 68</span><span class="w">      </span><span class="nt">KEYCLOAK_DB_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;keycloak&quot;</span>
<span class="linenos"> 69</span><span class="w">      </span><span class="nt">KEYCLOAK_DB_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Ch@ngeMeKCADB&quot;</span>
<span class="linenos"> 70</span><span class="w">  </span><span class="nt">gitlabDefinition</span><span class="p">:</span>
<span class="linenos"> 71</span><span class="w">    </span><span class="nt">config</span><span class="p">:</span>
<span class="linenos"> 72</span><span class="w">      </span><span class="nt">GITLAB_PROTOCOL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http&quot;</span>
<span class="linenos"> 73</span><span class="w">      </span><span class="nt">GITLAB_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="w"> </span><span class="c1"># &quot;gitlab&quot; if use container.</span>
<span class="linenos"> 74</span><span class="w">      </span><span class="nt">GITLAB_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8080&quot;</span>
<span class="linenos"> 75</span><span class="w">    </span><span class="nt">secret</span><span class="p">:</span>
<span class="linenos"> 76</span><span class="w">      </span><span class="nt">GITLAB_ROOT_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Ch@ngeMeGL&quot;</span>
<span class="linenos"> 77</span><span class="w">      </span><span class="nt">GITLAB_ROOT_TOKEN</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;change-this-token&quot;</span>
<span class="linenos"> 78</span><span class="w">  </span><span class="nt">mongoDefinition</span><span class="p">:</span>
<span class="linenos"> 79</span><span class="w">    </span><span class="nt">config</span><span class="p">:</span>
<span class="linenos"> 80</span><span class="w">      </span><span class="nt">MONGO_PROTOCOL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http&quot;</span>
<span class="linenos"> 81</span><span class="w">      </span><span class="nt">MONGO_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;mongo&quot;</span><span class="w"> </span><span class="c1"># &quot;mongo&quot; if use container.</span>
<span class="linenos"> 82</span><span class="w">      </span><span class="nt">MONGO_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;27017&quot;</span>
<span class="linenos"> 83</span><span class="w">    </span><span class="nt">secret</span><span class="p">:</span>
<span class="linenos"> 84</span><span class="w">      </span><span class="nt">MONGO_ADMIN_USER</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;admin&quot;</span>
<span class="linenos"> 85</span><span class="w">      </span><span class="nt">MONGO_ADMIN_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Ch@ngeMeMGAdm&quot;</span>
<span class="linenos"> 86</span>
<span class="linenos"> 87</span><span class="nt">exastro-it-automation</span><span class="p">:</span>
<span class="linenos"> 88</span><span class="w">  </span><span class="nt">ita-api-admin</span><span class="p">:</span>
<span class="linenos"> 89</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos"> 90</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos"> 91</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-it-automation-api-admin&quot;</span>
<span class="linenos"> 92</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos"> 93</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos"> 94</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos"> 95</span><span class="w">      </span><span class="nt">PLATFORM_API_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform-api&quot;</span>
<span class="linenos"> 96</span><span class="w">      </span><span class="nt">PLATFORM_API_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos"> 97</span>
<span class="linenos"> 98</span><span class="w">  </span><span class="nt">ita-api-organization</span><span class="p">:</span>
<span class="linenos"> 99</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">100</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">101</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-it-automation-api-organization&quot;</span>
<span class="linenos">102</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">103</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">104</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">105</span><span class="w">      </span><span class="nt">PLATFORM_API_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform-api&quot;</span>
<span class="linenos">106</span><span class="w">      </span><span class="nt">PLATFORM_API_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos">107</span>
<span class="linenos">108</span><span class="w">  </span><span class="nt">ita-api-oase-receiver</span><span class="p">:</span>
<span class="linenos">109</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">110</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">111</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-it-automation-api-oase-receiver&quot;</span>
<span class="linenos">112</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">113</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">114</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">115</span><span class="w">      </span><span class="nt">LISTEN_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos">116</span><span class="w">      </span><span class="nt">PLATFORM_API_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform-api&quot;</span>
<span class="linenos">117</span><span class="w">      </span><span class="nt">PLATFORM_API_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos">118</span>
<span class="linenos">119</span><span class="w">  </span><span class="nt">ita-api-ansible-execution-receiver</span><span class="p">:</span>
<span class="linenos">120</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">121</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">122</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-it-automation-api-ansible-execution-receiver&quot;</span>
<span class="linenos">123</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">124</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">125</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">126</span><span class="w">      </span><span class="nt">LISTEN_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos">127</span><span class="w">      </span><span class="nt">PLATFORM_API_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform-api&quot;</span>
<span class="linenos">128</span><span class="w">      </span><span class="nt">PLATFORM_API_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos">129</span>
<span class="linenos">130</span><span class="w">  </span><span class="nt">ita-by-ansible-execute</span><span class="p">:</span>
<span class="linenos">131</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">132</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">133</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-it-automation-by-ansible-execute&quot;</span>
<span class="linenos">134</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">135</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">136</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">137</span><span class="w">      </span><span class="nt">EXECUTE_INTERVAL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3&quot;</span>
<span class="linenos">138</span><span class="w">      </span><span class="nt">ANSIBLE_AGENT_IMAGE</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-it-automation-by-ansible-agent&quot;</span>
<span class="linenos">139</span><span class="w">      </span><span class="nt">ANSIBLE_AGENT_IMAGE_TAG</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">140</span><span class="w">      </span><span class="nt">PLATFORM_API_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform-api&quot;</span>
<span class="linenos">141</span><span class="w">      </span><span class="nt">PLATFORM_API_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos">142</span><span class="w">    </span><span class="nt">serviceAccount</span><span class="p">:</span>
<span class="linenos">143</span><span class="w">      </span><span class="nt">create</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="linenos">144</span><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;ita-by-ansible-execute-sa&quot;</span>
<span class="linenos">145</span>
<span class="linenos">146</span><span class="w">  </span><span class="nt">ita-by-ansible-legacy-role-vars-listup</span><span class="p">:</span>
<span class="linenos">147</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">148</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">149</span><span class="w">      </span><span class="nt">EXECUTE_INTERVAL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10&quot;</span>
<span class="linenos">150</span><span class="w">      </span><span class="nt">PLATFORM_API_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform-api&quot;</span>
<span class="linenos">151</span><span class="w">      </span><span class="nt">PLATFORM_API_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos">152</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">153</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-it-automation-by-ansible-legacy-role-vars-listup&quot;</span>
<span class="linenos">154</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">155</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">156</span>
<span class="linenos">157</span><span class="w">  </span><span class="nt">ita-by-ansible-legacy-vars-listup</span><span class="p">:</span>
<span class="linenos">158</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">159</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">160</span><span class="w">      </span><span class="nt">EXECUTE_INTERVAL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10&quot;</span>
<span class="linenos">161</span><span class="w">      </span><span class="nt">PLATFORM_API_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform-api&quot;</span>
<span class="linenos">162</span><span class="w">      </span><span class="nt">PLATFORM_API_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos">163</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">164</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-it-automation-by-ansible-legacy-vars-listup&quot;</span>
<span class="linenos">165</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">166</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">167</span>
<span class="linenos">168</span><span class="w">  </span><span class="nt">ita-by-ansible-pioneer-vars-listup</span><span class="p">:</span>
<span class="linenos">169</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">170</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">171</span><span class="w">      </span><span class="nt">EXECUTE_INTERVAL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10&quot;</span>
<span class="linenos">172</span><span class="w">      </span><span class="nt">PLATFORM_API_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform-api&quot;</span>
<span class="linenos">173</span><span class="w">      </span><span class="nt">PLATFORM_API_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos">174</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">175</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-it-automation-by-ansible-pioneer-vars-listup&quot;</span>
<span class="linenos">176</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">177</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">178</span>
<span class="linenos">179</span><span class="w">  </span><span class="nt">ita-by-ansible-towermaster-sync</span><span class="p">:</span>
<span class="linenos">180</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">181</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">182</span><span class="w">      </span><span class="nt">EXECUTE_INTERVAL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10&quot;</span>
<span class="linenos">183</span><span class="w">      </span><span class="nt">PLATFORM_API_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform-api&quot;</span>
<span class="linenos">184</span><span class="w">      </span><span class="nt">PLATFORM_API_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos">185</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">186</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-it-automation-by-ansible-towermaster-sync&quot;</span>
<span class="linenos">187</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">188</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">189</span>
<span class="linenos">190</span><span class="w">  </span><span class="nt">ita-by-cicd-for-iac</span><span class="p">:</span>
<span class="linenos">191</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">192</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">193</span><span class="w">      </span><span class="nt">EXECUTE_INTERVAL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10&quot;</span>
<span class="linenos">194</span><span class="w">      </span><span class="nt">PLATFORM_API_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform-api&quot;</span>
<span class="linenos">195</span><span class="w">      </span><span class="nt">PLATFORM_API_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos">196</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">197</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-it-automation-by-cicd-for-iac&quot;</span>
<span class="linenos">198</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">199</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">200</span>
<span class="linenos">201</span><span class="w">  </span><span class="nt">ita-by-collector</span><span class="p">:</span>
<span class="linenos">202</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">203</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">204</span><span class="w">      </span><span class="nt">EXECUTE_INTERVAL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10&quot;</span>
<span class="linenos">205</span><span class="w">      </span><span class="nt">PLATFORM_API_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform-api&quot;</span>
<span class="linenos">206</span><span class="w">      </span><span class="nt">PLATFORM_API_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos">207</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">208</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-it-automation-by-collector&quot;</span>
<span class="linenos">209</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">210</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">211</span>
<span class="linenos">212</span><span class="w">  </span><span class="nt">ita-by-conductor-regularly</span><span class="p">:</span>
<span class="linenos">213</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">214</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">215</span><span class="w">      </span><span class="nt">EXECUTE_INTERVAL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10&quot;</span>
<span class="linenos">216</span><span class="w">      </span><span class="nt">PLATFORM_API_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform-api&quot;</span>
<span class="linenos">217</span><span class="w">      </span><span class="nt">PLATFORM_API_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos">218</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">219</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-it-automation-by-conductor-regularly&quot;</span>
<span class="linenos">220</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">221</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">222</span>
<span class="linenos">223</span><span class="w">  </span><span class="nt">ita-by-conductor-synchronize</span><span class="p">:</span>
<span class="linenos">224</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">225</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">226</span><span class="w">      </span><span class="nt">EXECUTE_INTERVAL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3&quot;</span>
<span class="linenos">227</span><span class="w">      </span><span class="nt">PLATFORM_API_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform-api&quot;</span>
<span class="linenos">228</span><span class="w">      </span><span class="nt">PLATFORM_API_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos">229</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">230</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-it-automation-by-conductor-synchronize&quot;</span>
<span class="linenos">231</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">232</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">233</span>
<span class="linenos">234</span><span class="w">  </span><span class="nt">ita-by-excel-export-import</span><span class="p">:</span>
<span class="linenos">235</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">236</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">237</span><span class="w">      </span><span class="nt">EXECUTE_INTERVAL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10&quot;</span>
<span class="linenos">238</span><span class="w">      </span><span class="nt">PLATFORM_API_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform-api&quot;</span>
<span class="linenos">239</span><span class="w">      </span><span class="nt">PLATFORM_API_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos">240</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">241</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-it-automation-by-excel-export-import&quot;</span>
<span class="linenos">242</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">243</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">244</span>
<span class="linenos">245</span><span class="w">  </span><span class="nt">ita-by-execinstance-dataautoclean</span><span class="p">:</span>
<span class="linenos">246</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">247</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">248</span><span class="w">      </span><span class="nt">EXECUTE_INTERVAL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10&quot;</span>
<span class="linenos">249</span><span class="w">      </span><span class="nt">PLATFORM_API_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform-api&quot;</span>
<span class="linenos">250</span><span class="w">      </span><span class="nt">PLATFORM_API_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos">251</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">252</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-it-automation-by-execinstance-dataautoclean&quot;</span>
<span class="linenos">253</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">254</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">255</span>
<span class="linenos">256</span><span class="w">  </span><span class="nt">ita-by-file-autoclean</span><span class="p">:</span>
<span class="linenos">257</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">258</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">259</span><span class="w">      </span><span class="nt">EXECUTE_INTERVAL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10&quot;</span>
<span class="linenos">260</span><span class="w">      </span><span class="nt">PLATFORM_API_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform-api&quot;</span>
<span class="linenos">261</span><span class="w">      </span><span class="nt">PLATFORM_API_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos">262</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">263</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-it-automation-by-file-autoclean&quot;</span>
<span class="linenos">264</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">265</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">266</span>
<span class="linenos">267</span><span class="w">  </span><span class="nt">ita-by-hostgroup-split</span><span class="p">:</span>
<span class="linenos">268</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">269</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">270</span><span class="w">      </span><span class="nt">EXECUTE_INTERVAL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10&quot;</span>
<span class="linenos">271</span><span class="w">      </span><span class="nt">PLATFORM_API_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform-api&quot;</span>
<span class="linenos">272</span><span class="w">      </span><span class="nt">PLATFORM_API_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos">273</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">274</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-it-automation-by-hostgroup-split&quot;</span>
<span class="linenos">275</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">276</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">277</span>
<span class="linenos">278</span><span class="w">  </span><span class="nt">ita-by-menu-create</span><span class="p">:</span>
<span class="linenos">279</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">280</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">281</span><span class="w">      </span><span class="nt">EXECUTE_INTERVAL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10&quot;</span>
<span class="linenos">282</span><span class="w">      </span><span class="nt">PLATFORM_API_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform-api&quot;</span>
<span class="linenos">283</span><span class="w">      </span><span class="nt">PLATFORM_API_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos">284</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">285</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-it-automation-by-menu-create&quot;</span>
<span class="linenos">286</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">287</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">288</span>
<span class="linenos">289</span><span class="w">  </span><span class="nt">ita-by-menu-export-import</span><span class="p">:</span>
<span class="linenos">290</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">291</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">292</span><span class="w">      </span><span class="nt">EXECUTE_INTERVAL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10&quot;</span>
<span class="linenos">293</span><span class="w">      </span><span class="nt">PLATFORM_API_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform-api&quot;</span>
<span class="linenos">294</span><span class="w">      </span><span class="nt">PLATFORM_API_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos">295</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">296</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-it-automation-by-menu-export-import&quot;</span>
<span class="linenos">297</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">298</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">299</span>
<span class="linenos">300</span><span class="w">  </span><span class="nt">ita-by-oase-conclusion</span><span class="p">:</span>
<span class="linenos">301</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">302</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">303</span><span class="w">      </span><span class="nt">EXECUTE_INTERVAL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10&quot;</span>
<span class="linenos">304</span><span class="w">      </span><span class="nt">PLATFORM_API_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform-api&quot;</span>
<span class="linenos">305</span><span class="w">      </span><span class="nt">PLATFORM_API_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos">306</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">307</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-it-automation-by-oase-conclusion&quot;</span>
<span class="linenos">308</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">309</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">310</span>
<span class="linenos">311</span><span class="w">  </span><span class="nt">ita-by-terraform-cli-execute</span><span class="p">:</span>
<span class="linenos">312</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">313</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">314</span><span class="w">      </span><span class="nt">EXECUTE_INTERVAL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3&quot;</span>
<span class="linenos">315</span><span class="w">      </span><span class="nt">PLATFORM_API_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform-api&quot;</span>
<span class="linenos">316</span><span class="w">      </span><span class="nt">PLATFORM_API_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos">317</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">318</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-it-automation-by-terraform-cli-execute&quot;</span>
<span class="linenos">319</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">320</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">321</span>
<span class="linenos">322</span><span class="w">  </span><span class="nt">ita-by-terraform-cli-vars-listup</span><span class="p">:</span>
<span class="linenos">323</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">324</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">325</span><span class="w">      </span><span class="nt">EXECUTE_INTERVAL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10&quot;</span>
<span class="linenos">326</span><span class="w">      </span><span class="nt">PLATFORM_API_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform-api&quot;</span>
<span class="linenos">327</span><span class="w">      </span><span class="nt">PLATFORM_API_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos">328</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">329</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-it-automation-by-terraform-cli-vars-listup&quot;</span>
<span class="linenos">330</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">331</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">332</span>
<span class="linenos">333</span><span class="w">  </span><span class="nt">ita-by-terraform-cloud-ep-execute</span><span class="p">:</span>
<span class="linenos">334</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">335</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">336</span><span class="w">      </span><span class="nt">EXECUTE_INTERVAL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;3&quot;</span>
<span class="linenos">337</span><span class="w">      </span><span class="nt">PLATFORM_API_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform-api&quot;</span>
<span class="linenos">338</span><span class="w">      </span><span class="nt">PLATFORM_API_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos">339</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">340</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-it-automation-by-terraform-cloud-ep-execute&quot;</span>
<span class="linenos">341</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">342</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">343</span>
<span class="linenos">344</span><span class="w">  </span><span class="nt">ita-by-terraform-cloud-ep-vars-listup</span><span class="p">:</span>
<span class="linenos">345</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">346</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">347</span><span class="w">      </span><span class="nt">EXECUTE_INTERVAL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10&quot;</span>
<span class="linenos">348</span><span class="w">      </span><span class="nt">PLATFORM_API_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform-api&quot;</span>
<span class="linenos">349</span><span class="w">      </span><span class="nt">PLATFORM_API_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos">350</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">351</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-it-automation-by-terraform-cloud-ep-vars-listup&quot;</span>
<span class="linenos">352</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">353</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">354</span>
<span class="linenos">355</span><span class="w">  </span><span class="nt">ita-web-server</span><span class="p">:</span>
<span class="linenos">356</span><span class="w">    </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="linenos">357</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">358</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-it-automation-web-server&quot;</span>
<span class="linenos">359</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">360</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">361</span>
<span class="linenos">362</span><span class="w">  </span><span class="nt">ita-migration</span><span class="p">:</span>
<span class="linenos">363</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">364</span><span class="w">      </span><span class="nt">PLATFORM_API_HOST</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;platform-api&quot;</span>
<span class="linenos">365</span><span class="w">      </span><span class="nt">PLATFORM_API_PORT</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;8000&quot;</span>
<span class="linenos">366</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">367</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-it-automation-migration&quot;</span>
<span class="linenos">368</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">369</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">370</span>
<span class="linenos">371</span><span class="nt">exastro-platform</span><span class="p">:</span>
<span class="linenos">372</span><span class="w">  </span><span class="nt">platform-api</span><span class="p">:</span>
<span class="linenos">373</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">374</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-platform-api&quot;</span>
<span class="linenos">375</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">376</span>
<span class="linenos">377</span><span class="w">  </span><span class="nt">platform-auth</span><span class="p">:</span>
<span class="linenos">378</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">379</span><span class="w">      </span><span class="c1"># Please set the URL to access</span>
<span class="linenos">380</span><span class="w">      </span><span class="nt">EXTERNAL_URL</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">381</span><span class="w">      </span><span class="nt">EXTERNAL_URL_MNG</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">382</span><span class="w">    </span><span class="nt">ingress</span><span class="p">:</span>
<span class="linenos">383</span><span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">384</span><span class="w">      </span><span class="nt">hosts</span><span class="p">:</span>
<span class="linenos">385</span><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exastro-suite.example.local</span>
<span class="linenos">386</span><span class="w">          </span><span class="nt">paths</span><span class="p">:</span>
<span class="linenos">387</span><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class="linenos">388</span><span class="w">              </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<span class="linenos">389</span><span class="w">              </span><span class="nt">backend</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http&quot;</span>
<span class="linenos">390</span><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">exastro-suite-mng.example.local</span>
<span class="linenos">391</span><span class="w">          </span><span class="nt">paths</span><span class="p">:</span>
<span class="linenos">392</span><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
<span class="linenos">393</span><span class="w">              </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span>
<span class="linenos">394</span><span class="w">              </span><span class="nt">backend</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;httpMng&quot;</span>
<span class="linenos">395</span><span class="w">      </span><span class="nt">tls</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="linenos">396</span><span class="w">        </span><span class="c1"># - secretName: chart-example-tls</span>
<span class="linenos">397</span><span class="w">        </span><span class="c1">#   hosts:</span>
<span class="linenos">398</span><span class="w">        </span><span class="c1">#     - chart-example.local</span>
<span class="linenos">399</span><span class="w">      </span><span class="nt">secrets</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="linenos">400</span><span class="w">        </span><span class="c1"># - name: chart-example-tls</span>
<span class="linenos">401</span><span class="w">        </span><span class="c1">#   certificate: |-</span>
<span class="linenos">402</span><span class="w">        </span><span class="c1">#     -----BEGIN CERTIFICATE-----</span>
<span class="linenos">403</span><span class="w">        </span><span class="c1">#     ...</span>
<span class="linenos">404</span><span class="w">        </span><span class="c1">#     -----END CERTIFICATE-----</span>
<span class="linenos">405</span><span class="w">        </span><span class="c1">#   key: |-</span>
<span class="linenos">406</span><span class="w">        </span><span class="c1">#     -----BEGIN PRIVATE KEY-----</span>
<span class="linenos">407</span><span class="w">        </span><span class="c1">#     ...</span>
<span class="linenos">408</span><span class="w">        </span><span class="c1">#     -----END PRIVATE KEY-----</span>
<span class="linenos">409</span><span class="w">    </span><span class="nt">service</span><span class="p">:</span>
<span class="linenos">410</span><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
<span class="linenos">411</span><span class="w">      </span><span class="c1"># http:</span>
<span class="linenos">412</span><span class="w">      </span><span class="c1">#   nodePort: 30080</span>
<span class="linenos">413</span><span class="w">      </span><span class="c1"># httpMng:</span>
<span class="linenos">414</span><span class="w">      </span><span class="c1">#   nodePort: 30081</span>
<span class="linenos">415</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">416</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-platform-auth&quot;</span>
<span class="linenos">417</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">418</span>
<span class="linenos">419</span><span class="w">  </span><span class="nt">platform-job</span><span class="p">:</span>
<span class="linenos">420</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">421</span><span class="w">      </span><span class="c1"># LOG_LEVEL: &quot;INFO&quot;</span>
<span class="linenos">422</span><span class="w">      </span><span class="c1"># SUB_PROCESS_TERMINATE_REQUEST_SECONDS: &quot;1800&quot;</span>
<span class="linenos">423</span><span class="w">      </span><span class="c1"># SUB_PROCESS_ACCEPTABLE: &quot;2&quot;</span>
<span class="linenos">424</span><span class="w">      </span><span class="c1"># SUB_PROCESS_MAX_JOBS: &quot;10&quot;</span>
<span class="linenos">425</span><span class="w">      </span><span class="c1"># SUB_PROCESS_WATCH_INTERVAL_SECONDS: &quot;1.0&quot;</span>
<span class="linenos">426</span><span class="w">      </span><span class="c1"># SUB_PROCESS_DB_RECONNECT_INTERVAL_SECONDS: &quot;60&quot;</span>
<span class="linenos">427</span><span class="w">      </span><span class="c1"># SUB_PROCESS_DB_HEALTH_CHECK_INTERVAL_SECONDS: &quot;5&quot;</span>
<span class="linenos">428</span><span class="w">      </span><span class="c1"># SUB_PROCESS_MAX_CANCEL_TIMEOUT: &quot;10&quot;</span>
<span class="linenos">429</span><span class="w">      </span><span class="c1"># JOB_STATUS_WATCH_INTERVAL_SECONDS: &quot;1.0&quot;</span>
<span class="linenos">430</span><span class="w">      </span><span class="c1"># JOB_CANCEL_TIMEOUT_SECONDS: &quot;5.0&quot;</span>
<span class="linenos">431</span><span class="w">      </span><span class="c1"># JOB_NOTIFICATION_TIMEOUT_SECONDS: &quot;20&quot;</span>
<span class="linenos">432</span><span class="w">      </span><span class="c1"># JOB_NOTIFICATION_TEAMS_CONNECTION_TIMEOUT: &quot;3.0&quot;</span>
<span class="linenos">433</span><span class="w">      </span><span class="c1"># JOB_NOTIFICATION_TEAMS_READ_TIMEOUT: &quot;10.0&quot;</span>
<span class="linenos">434</span><span class="w">      </span><span class="c1"># JOB_NOTIFICATION_SMTP_TIMEOUT: &quot;10.0&quot;</span>
<span class="linenos">435</span><span class="w">      </span><span class="c1"># JOB_NOTIFICATION_SMTPS_SSL_VERIFY_ENABLED: &quot;TRUE&quot;</span>
<span class="linenos">436</span><span class="w">      </span><span class="c1"># JOB_FORCE_UPDATE_STATUS_TIMEOUT_SECONDS: &quot;60&quot;</span>
<span class="linenos">437</span><span class="w">      </span><span class="c1"># JOB_FORCE_UPDATE_STATUS_INTERVAL_SECONDS: &quot;180&quot;</span>
<span class="linenos">438</span><span class="w">      </span><span class="c1"># JOB_FORCE_UPDATE_STATUS_PROGRASS_SECONDS: &quot;600&quot;</span>
<span class="linenos">439</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">440</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-platform-job&quot;</span>
<span class="linenos">441</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">442</span>
<span class="linenos">443</span><span class="w">  </span><span class="nt">platform-migration</span><span class="p">:</span>
<span class="linenos">444</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">445</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-platform-migration&quot;</span>
<span class="linenos">446</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">447</span>
<span class="linenos">448</span><span class="w">  </span><span class="nt">platform-web</span><span class="p">:</span>
<span class="linenos">449</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">450</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/exastro-platform-web&quot;</span>
<span class="linenos">451</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">452</span>
<span class="linenos">453</span><span class="w">  </span><span class="nt">mariadb</span><span class="p">:</span>
<span class="linenos">454</span><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">455</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">456</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/mariadb&quot;</span>
<span class="linenos">457</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;10.11&quot;</span>
<span class="linenos">458</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">459</span><span class="w">    </span><span class="nt">imagePullSecrets</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[]</span>
<span class="linenos">460</span><span class="w">    </span><span class="nt">persistence</span><span class="p">:</span>
<span class="linenos">461</span><span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">462</span><span class="w">      </span><span class="nt">accessMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<span class="linenos">463</span><span class="w">      </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20Gi</span>
<span class="linenos">464</span><span class="w">      </span><span class="nt">storageClass</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="w"> </span><span class="c1"># e.g.) azurefile or - (None)</span>
<span class="linenos">465</span><span class="w">      </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="linenos">466</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pv-database</span>
<span class="linenos">467</span><span class="w">      </span><span class="nt">matchExpressions</span><span class="p">:</span>
<span class="linenos">468</span><span class="w">        </span><span class="c1"># - {key: name, operator: In, values: [pv-database]}</span>
<span class="linenos">469</span><span class="w">    </span><span class="nt">dbSetup</span><span class="p">:</span>
<span class="linenos">470</span><span class="w">      </span><span class="nt">dbConfInfo</span><span class="p">:</span>
<span class="linenos">471</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mysql-server-conf-config</span>
<span class="linenos">472</span><span class="w">        </span><span class="nt">customCnf</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|-</span>
<span class="linenos">473</span><span class="w">          </span><span class="no">[mysqld]</span>
<span class="linenos">474</span><span class="w">          </span><span class="no">character-set-server=utf8mb4</span>
<span class="linenos">475</span><span class="w">          </span><span class="no">collation-server=utf8mb4_bin</span>
<span class="linenos">476</span><span class="w">          </span><span class="no">secure_file_priv=/tmp</span>
<span class="linenos">477</span><span class="w">          </span><span class="no">lower_case_table_names=1</span>
<span class="linenos">478</span><span class="w">          </span><span class="no">[client]</span>
<span class="linenos">479</span><span class="w">          </span><span class="no">default-character-set=utf8mb4</span>
<span class="linenos">480</span><span class="w">    </span><span class="nt">resources</span><span class="p">:</span>
<span class="linenos">481</span><span class="w">      </span><span class="nt">requests</span><span class="p">:</span>
<span class="linenos">482</span><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;256Mi&quot;</span>
<span class="linenos">483</span><span class="w">        </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1m&quot;</span>
<span class="linenos">484</span><span class="w">      </span><span class="nt">limits</span><span class="p">:</span>
<span class="linenos">485</span><span class="w">        </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2Gi&quot;</span>
<span class="linenos">486</span><span class="w">        </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;4&quot;</span>
<span class="linenos">487</span>
<span class="linenos">488</span><span class="w">  </span><span class="nt">keycloak</span><span class="p">:</span>
<span class="linenos">489</span><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">490</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">491</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/exastro/keycloak&quot;</span>
<span class="linenos">492</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;&quot;</span>
<span class="linenos">493</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">494</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">495</span><span class="w">      </span><span class="c1"># If you use Azure MySQL, add options like below</span>
<span class="linenos">496</span><span class="w">      </span><span class="c1"># KC_DB_URL_PROPERTIES: &quot;?useSSL=false&quot;</span>
<span class="linenos">497</span><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="linenos">498</span><span class="w">      </span><span class="c1"># requests:</span>
<span class="linenos">499</span><span class="w">      </span><span class="c1">#   memory: &quot;256Mi&quot;</span>
<span class="linenos">500</span><span class="w">      </span><span class="c1">#   cpu: &quot;1m&quot;</span>
<span class="linenos">501</span><span class="w">      </span><span class="c1"># limits:</span>
<span class="linenos">502</span><span class="w">      </span><span class="c1">#   memory: &quot;2Gi&quot;</span>
<span class="linenos">503</span><span class="w">      </span><span class="c1">#   cpu: &quot;4&quot;</span>
<span class="linenos">504</span>
<span class="linenos">505</span><span class="w">  </span><span class="nt">gitlab</span><span class="p">:</span>
<span class="linenos">506</span><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
<span class="linenos">507</span><span class="w">    </span><span class="nt">extraEnv</span><span class="p">:</span>
<span class="linenos">508</span><span class="w">      </span><span class="nt">GITLAB_OMNIBUS_CONFIG</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="linenos">509</span><span class="w">        </span><span class="no">postgresql[&#39;shared_buffers&#39;] = &quot;2048MB&quot;</span>
<span class="linenos">510</span><span class="w">        </span><span class="no">postgresql[&#39;work_mem&#39;] = &quot;128MB&quot;</span>
<span class="linenos">511</span><span class="w">        </span><span class="no">postgresql[&#39;maintenance_work_mem&#39;] = &quot;128MB&quot;</span>
<span class="linenos">512</span><span class="w">        </span><span class="no">postgresql[&#39;effective_cache_size&#39;] = &quot;128MB&quot;</span>
<span class="linenos">513</span><span class="w">        </span><span class="no">postgresql[&#39;checkpoint_segments&#39;] = 16</span>
<span class="linenos">514</span><span class="w">        </span><span class="no">postgresql[&#39;checkpoint_timeout&#39;] = &quot;10min&quot;</span>
<span class="linenos">515</span><span class="w">        </span><span class="no">external_url &#39;http://gitlab:40080&#39;</span>
<span class="linenos">516</span><span class="w">        </span><span class="no">nginx[&#39;listen_port&#39;] = 40080</span>
<span class="linenos">517</span><span class="w">        </span><span class="no">gitlab_rails[&#39;initial_root_password&#39;] = &quot;${GITLAB_ROOT_PASSWORD:-}&quot;</span>
<span class="linenos">518</span><span class="w">        </span><span class="no">gitlab_rails[&#39;registry_enabled&#39;] = false;</span>
<span class="linenos">519</span><span class="w">        </span><span class="no">gitlab_rails[&#39;db_prepared_statements&#39;] = false;</span>
<span class="linenos">520</span><span class="w">        </span><span class="no">gitlab_rails[&#39;monitoring_whitelist&#39;] = [&#39;0.0.0.0/0&#39;]</span>
<span class="linenos">521</span><span class="w">        </span><span class="no"># gitlab_rails[&#39;env&#39;] = {&#39;MALLOC_CONF&#39; =&gt; &#39;dirty_decay_ms:1000,muzzy_decay_ms:1000&#39;}</span>
<span class="linenos">522</span><span class="w">        </span><span class="no"># puma[&#39;worker_processes&#39;] = 0</span>
<span class="linenos">523</span><span class="w">        </span><span class="no">prometheus_monitoring[&#39;enable&#39;] = false</span>
<span class="linenos">524</span><span class="w">        </span><span class="no"># sidekiq[&#39;max_concurrency&#39;] = 10</span>
<span class="linenos">525</span><span class="w">        </span><span class="no"># gitaly[&#39;env&#39;] = {&#39;MALLOC_CONF&#39; =&gt; &#39;dirty_decay_ms:1000,muzzy_decay_ms:1000&#39;, &#39;GITALY_COMMAND_SPAWN_MAX_PARALLEL&#39; =&gt; &#39;2&#39;}</span>
<span class="linenos">526</span><span class="w">      </span><span class="nt">GITLAB_POST_RECONFIGURE_SCRIPT</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="linenos">527</span><span class="w">        </span><span class="no">while ! curl -sfI -o /dev/null http://localhost:40080/-/readiness;</span>
<span class="linenos">528</span><span class="w">        </span><span class="no">do</span>
<span class="linenos">529</span><span class="w">        </span><span class="no">echo &quot;GitLab service is not ready.&quot;</span>
<span class="linenos">530</span><span class="w">        </span><span class="no">sleep 1</span>
<span class="linenos">531</span><span class="w">        </span><span class="no">done</span>
<span class="linenos">532</span><span class="w">        </span><span class="no">echo &quot;GitLab service started normally&quot;</span>
<span class="linenos">533</span><span class="w">        </span><span class="no">curl -Ssf -H &quot;PRIVATE-TOKEN: ${GITLAB_ROOT_TOKEN:-}&quot; &quot;http://localhost:40080/api/v4/version&quot; || (</span>
<span class="linenos">534</span><span class="w">          </span><span class="no">gitlab-rails runner &quot;token = User.find_by_username(&#39;root&#39;).personal_access_tokens.create(scopes: [:api, :write_repository, :sudo], name: &#39;exastro system token&#39;); token.set_token(&#39;${GITLAB_ROOT_TOKEN:-}&#39;); token.save!&quot;</span>
<span class="linenos">535</span><span class="w">        </span><span class="no">)</span>
<span class="linenos">536</span><span class="w">        </span><span class="no">echo &quot;GitLab post reconfigure script ended.&quot;</span>
<span class="linenos">537</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">538</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/gitlab/gitlab-ce&quot;</span>
<span class="linenos">539</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;15.11.13-ce.0&quot;</span>
<span class="linenos">540</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">541</span><span class="w">      </span><span class="c1"># Overrides the image tag whose default is the chart appVersion.</span>
<span class="linenos">542</span><span class="w">    </span><span class="nt">persistence</span><span class="p">:</span>
<span class="linenos">543</span><span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">544</span><span class="w">      </span><span class="nt">volumeName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pv-gitlab</span>
<span class="linenos">545</span><span class="w">      </span><span class="nt">accessMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteMany</span>
<span class="linenos">546</span><span class="w">      </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20Gi</span>
<span class="linenos">547</span><span class="w">      </span><span class="nt">storageClass</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="w"> </span><span class="c1"># e.g.) azurefile or - (None)</span>
<span class="linenos">548</span><span class="w">      </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="linenos">549</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pv-gitlab</span>
<span class="linenos">550</span><span class="w">      </span><span class="nt">matchExpressions</span><span class="p">:</span>
<span class="linenos">551</span><span class="w">        </span><span class="c1"># - {key: name, operator: In, values: [pv-gitlab]}</span>
<span class="linenos">552</span><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="linenos">553</span><span class="w">      </span><span class="c1"># requests:</span>
<span class="linenos">554</span><span class="w">      </span><span class="c1">#   memory: &quot;4Gi&quot;</span>
<span class="linenos">555</span><span class="w">      </span><span class="c1">#   cpu: &quot;4&quot;</span>
<span class="linenos">556</span><span class="w">      </span><span class="c1"># limits:</span>
<span class="linenos">557</span><span class="w">      </span><span class="c1">#   memory: &quot;8Gi&quot;</span>
<span class="linenos">558</span><span class="w">      </span><span class="c1">#   cpu: &quot;8&quot;</span>
<span class="linenos">559</span><span class="w">    </span><span class="nt">service</span><span class="p">:</span>
<span class="linenos">560</span><span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
<span class="linenos">561</span><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gitlab</span>
<span class="linenos">562</span><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">40080</span>
<span class="linenos">563</span><span class="w">      </span><span class="c1"># nodePort: 30082</span>
<span class="linenos">564</span>
<span class="linenos">565</span><span class="w">  </span><span class="nt">mongo</span><span class="p">:</span>
<span class="linenos">566</span><span class="w">    </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">567</span><span class="w">    </span><span class="nt">image</span><span class="p">:</span>
<span class="linenos">568</span><span class="w">      </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;docker.io/mongo&quot;</span>
<span class="linenos">569</span><span class="w">      </span><span class="nt">pullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
<span class="linenos">570</span><span class="w">      </span><span class="c1"># Overrides the image tag whose default is the chart appVersion.</span>
<span class="linenos">571</span><span class="w">      </span><span class="nt">tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;6.0&quot;</span>
<span class="linenos">572</span><span class="w">    </span><span class="nt">persistence</span><span class="p">:</span>
<span class="linenos">573</span><span class="w">      </span><span class="nt">enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="linenos">574</span><span class="w">      </span><span class="nt">accessMode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteOnce</span>
<span class="linenos">575</span><span class="w">      </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20Gi</span>
<span class="linenos">576</span><span class="w">      </span><span class="nt">storageClass</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;-&quot;</span><span class="w"> </span><span class="c1"># e.g.) azurefile, local-path or - (None)</span>
<span class="linenos">577</span><span class="w">      </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="linenos">578</span><span class="w">        </span><span class="c1"># release: &quot;pv-mongo&quot;</span>
<span class="linenos">579</span><span class="w">      </span><span class="nt">matchExpressions</span><span class="p">:</span>
<span class="linenos">580</span><span class="w">        </span><span class="c1"># - {key: name, operator: In, values: [pv-mongo]}</span>
<span class="linenos">581</span><span class="w">    </span><span class="nt">dbSetup</span><span class="p">:</span>
<span class="linenos">582</span><span class="w">      </span><span class="nt">dbConfInfo</span><span class="p">:</span>
<span class="linenos">583</span><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongo-server-conf-config</span>
<span class="linenos">584</span><span class="w">        </span><span class="nt">customCnf</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
<span class="linenos">585</span><span class="w">          </span><span class="no">systemLog:</span>
<span class="linenos">586</span><span class="w">            </span><span class="no">verbosity: 0</span>
<span class="linenos">587</span><span class="w">            </span><span class="no"># destination: file</span>
<span class="linenos">588</span><span class="w">            </span><span class="no"># path: /root/logs/mongod.log</span>
<span class="linenos">589</span><span class="w">            </span><span class="no">timeStampFormat: iso8601-utc</span>
<span class="linenos">590</span><span class="w">          </span><span class="no"># storage:</span>
<span class="linenos">591</span><span class="w">          </span><span class="no">#   directoryPerDB: true</span>
<span class="linenos">592</span><span class="w">          </span><span class="no">#   dbPath: /root/data</span>
<span class="linenos">593</span><span class="w">          </span><span class="no">#   engine: wiredTiger</span>
<span class="linenos">594</span><span class="w">          </span><span class="no">#   wiredTiger:</span>
<span class="linenos">595</span><span class="w">          </span><span class="no">#     engineConfig:</span>
<span class="linenos">596</span><span class="w">          </span><span class="no">#       cacheSizeGB: 1</span>
<span class="linenos">597</span><span class="w">          </span><span class="no">#   journal:</span>
<span class="linenos">598</span><span class="w">          </span><span class="no">#     enabled: true</span>
<span class="linenos">599</span><span class="w">          </span><span class="no"># processManagement:</span>
<span class="linenos">600</span><span class="w">          </span><span class="no">#   fork: true</span>
<span class="linenos">601</span><span class="w">          </span><span class="no"># net:</span>
<span class="linenos">602</span><span class="w">          </span><span class="no">#   port: 27017</span>
<span class="linenos">603</span><span class="w">          </span><span class="no">#   bindIp: 0.0.0.0</span>
<span class="linenos">604</span><span class="w">          </span><span class="no"># security:</span>
<span class="linenos">605</span><span class="w">          </span><span class="no">#   authorization: enabled</span>
<span class="linenos">606</span><span class="w">    </span><span class="nt">resources</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
<span class="linenos">607</span><span class="w">      </span><span class="c1"># requests:</span>
<span class="linenos">608</span><span class="w">      </span><span class="c1">#   memory: &quot;4Gi&quot;</span>
<span class="linenos">609</span><span class="w">      </span><span class="c1">#   cpu: &quot;4&quot;</span>
<span class="linenos">610</span><span class="w">      </span><span class="c1"># limits:</span>
<span class="linenos">611</span><span class="w">      </span><span class="c1">#   memory: &quot;8Gi&quot;</span>
<span class="linenos">612</span><span class="w">      </span><span class="c1">#   cpu: &quot;4&quot;</span>
<span class="linenos">613</span><span class="w">    </span><span class="nt">affinity</span><span class="p">:</span>
<span class="linenos">614</span><span class="w">      </span><span class="nt">podAntiAffinity</span><span class="p">:</span>
<span class="linenos">615</span><span class="w">        </span><span class="nt">requiredDuringSchedulingIgnoredDuringExecution</span><span class="p">:</span>
<span class="linenos">616</span><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">labelSelector</span><span class="p">:</span>
<span class="linenos">617</span><span class="w">            </span><span class="nt">matchExpressions</span><span class="p">:</span>
<span class="linenos">618</span><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">name</span>
<span class="linenos">619</span><span class="w">              </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">In</span>
<span class="linenos">620</span><span class="w">              </span><span class="nt">values</span><span class="p">:</span>
<span class="linenos">621</span><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">mongo</span>
<span class="linenos">622</span><span class="w">          </span><span class="nt">topologyKey</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubernetes.io/hostname</span>
</pre></div>
</div>
</div>
</details><section id="id10">
<h4>サービス公開の設定<a class="headerlink" href="#id10" title="Link to this heading">¶</a></h4>
<div class="line-block">
<div class="line"><code class="file docutils literal notranslate"><span class="pre">exastro.yaml</span></code> を編集しサービス公開に必要なパラメータを設定していきます。</div>
<div class="line">ここではNodePortを使用する方法を例に記載しています。</div>
<div class="line">EXTERNAL_URLとEXTERNAL_URL_MNGはExastroをインストールするサーバのIPアドレスを指定します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id45">
<div class="code-block-caption"><span class="caption-number">リスト 199 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id45" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>EXTERNAL_URL:<span class="w"> </span><span class="s2">&quot;http://xx.xx.xx.xx:30080&quot;</span>
EXTERNAL_URL_MNG:<span class="w"> </span><span class="s2">&quot;http://xx.xx.xx.xx:30081&quot;</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id46">
<div class="code-block-caption"><span class="caption-number">リスト 200 </span><span class="caption-text">exastro.yaml</span><a class="headerlink" href="#id46" title="Link to this code">¶</a></div>
<div class="highlight-udiff notranslate"><div class="highlight"><pre><span></span><span class="gd">--- /home/runner/work/exastro-it-automation-docs-dev/exastro-it-automation-docs-dev/workspace/src/ja/2.6/installation/literal_includes/exastro.yaml</span>
<span class="gi">+++ /home/runner/work/exastro-it-automation-docs-dev/exastro-it-automation-docs-dev/workspace/src/ja/2.6/installation/literal_includes/exastro_nodeport_setting.yaml</span>
<span class="gu">@@ -377,10 +377,10 @@</span>
<span class="w"> </span>  platform-auth:
<span class="w"> </span>    extraEnv:
<span class="w"> </span>      # Please set the URL to access
<span class="gd">-      EXTERNAL_URL: &quot;&quot;</span>
<span class="gd">-      EXTERNAL_URL_MNG: &quot;&quot;</span>
<span class="gi">+      EXTERNAL_URL: &quot;http://10.10.10.10:30080&quot;</span>
<span class="gi">+      EXTERNAL_URL_MNG: &quot;http://10.10.10.10:30081&quot;</span>
<span class="w"> </span>    ingress:
<span class="gd">-      enabled: true</span>
<span class="gi">+      enabled: false</span>
<span class="w"> </span>      hosts:
<span class="w"> </span>        - host: exastro-suite.example.local
<span class="w"> </span>          paths:
<span class="gu">@@ -407,11 +407,11 @@</span>
<span class="w"> </span>        #     ...
<span class="w"> </span>        #     -----END PRIVATE KEY-----
<span class="w"> </span>    service:
<span class="gd">-      type: ClusterIP</span>
<span class="gd">-      # http:</span>
<span class="gd">-      #   nodePort: 30080</span>
<span class="gd">-      # httpMng:</span>
<span class="gd">-      #   nodePort: 30081</span>
<span class="gi">+      type: NodePort</span>
<span class="gi">+        http:</span>
<span class="gi">+          nodePort: 30080</span>
<span class="gi">+        httpMng:</span>
<span class="gi">+          nodePort: 30081</span>
<span class="w"> </span>    image:
<span class="w"> </span>      repository: &quot;docker.io/exastro/exastro-platform-auth&quot;
<span class="w"> </span>      tag: &quot;&quot;
</pre></div>
</div>
</div>
</section>
<section id="id11">
<h4>データベース連携<a class="headerlink" href="#id11" title="Link to this heading">¶</a></h4>
<div class="line-block">
<div class="line">Exastro サービスを利用するためには、CMDB やオーガナイゼーションの管理のためのデータベースが必要となります。</div>
<div class="line">データベースコンテナの root パスワードを作成し、他のコンテナからもアクセスできるように作成した root アカウントのパスワードを設定します。</div>
<div class="line">また、データベースのデータを永続化するために利用するストレージを指定します。</div>
<div class="line">ここではデータベースコンテナ 及び hostPathを使用する方法を例に記載しています。</div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line"><strong class="command">DB_ADMIN_USER</strong> と <strong class="command">MONGO_ADMIN_USER</strong> で指定するDBの管理ユーザには、データベースとユーザを作成する権限が必要です。</div>
</div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line">認証情報などはすべて平文で問題ありません。(Base64エンコードは不要)</div>
</div>
</div>
<ol class="arabic" id="configuration-database-container">
<li><div class="line-block">
<div class="line">データベースコンテナの設定</div>
</div>
<div class="line-block">
<div class="line">データベースコンテナの root パスワードを設定します。</div>
<div class="line">また、データベースのデータを永続化するために利用するストレージを指定します。</div>
</div>
<table class="filter-table docutils align-left" id="id47">
<caption><span class="caption-number">表 55 </span><span class="caption-text">共通設定 (Exastro 共用データベース) のオプションパラメータ</span><a class="headerlink" href="#id47" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 31.2%" />
<col style="width: 31.2%" />
<col style="width: 12.5%" />
<col style="width: 25.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>パラメータ</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>変更</p></th>
<th class="head"><p>デフォルト値・選択可能な設定値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>global.databaseDefinition.name</p></td>
<td><p>Exastro 共用データベースの定義名</p></td>
<td><p>不可</p></td>
<td><p>&quot;mariadb&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.databaseDefinition.enabled</p></td>
<td><p>Exastro 共用データベースの定義の利用有無</p></td>
<td><p>不可</p></td>
<td><p>true</p></td>
</tr>
<tr class="row-even"><td><p>global.databaseDefinition.secret.MARIADB_ROOT_PASSWORD</p></td>
<td><p>Exastro 共用データベースの root アカウントに設定するパスワード(エンコードなし)</p></td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
<tr class="row-odd"><td><p>global.databaseDefinition.persistence.enabled</p></td>
<td><p>Exastro 共用データベースのデータ永続化の有効フラグ</p></td>
<td><p>可</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">&quot;true&quot;</strong> (デフォルト): データを永続化する</div>
<div class="line"><strong class="program">&quot;false&quot;</strong>: データを永続化しない</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>global.databaseDefinition.persistence.reinstall</p></td>
<td><p>再インストール時にデータ領域の初期化の要否</p></td>
<td><p>可 (データ永続化時)</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">&quot;true&quot;</strong> (デフォルト): データを初期化(削除)する</div>
<div class="line"><strong class="program">&quot;false&quot;</strong>: データを初期化(削除)しない</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>global.databaseDefinition.persistence.accessMode</p></td>
<td><p>永続ボリュームのアクセスモードの指定。</p></td>
<td><p>不可</p></td>
<td><p>&quot;ReadWriteOnce&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.databaseDefinition.persistence.size</p></td>
<td><p>永続ボリュームのディスク容量</p></td>
<td><p>可 (データ永続化時)</p></td>
<td><p>&quot;20Gi&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.databaseDefinition.persistence.volumeType</p></td>
<td><p>永続ボリュームのボリュームタイプ</p></td>
<td><p>可 (現在無効)</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">&quot;hostPath&quot;</strong> (デフォルト): Kubernetes クラスタのノード上にデータを保存(非推奨)</div>
<div class="line"><strong class="program">&quot;AKS&quot;</strong>: AKS のストレージクラスを利用</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>global.databaseDefinition.persistence.storageClass</p></td>
<td><p>永続ボリュームにストレージクラスを利用する場合のクラスを指定</p></td>
<td><p>可 (データ永続化時)</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">&quot;-&quot;</strong> (デフォルト): ストレージクラスを指定しない。</div>
<div class="line"><strong class="program">ストレージクラス名</strong>: クラウドプロバイダなどから提供されるストレージクラス名を指定。</div>
</div>
</td>
</tr>
</tbody>
</table>
<div class="literal-block-wrapper docutils container" id="id48">
<div class="code-block-caption"><span class="caption-number">リスト 201 </span><span class="caption-text">exastro.yaml</span><a class="headerlink" href="#id48" title="Link to this code">¶</a></div>
<div class="highlight-udiff notranslate"><div class="highlight"><pre><span></span><span class="gd">--- /home/runner/work/exastro-it-automation-docs-dev/exastro-it-automation-docs-dev/workspace/src/ja/2.6/installation/literal_includes/exastro.yaml</span>
<span class="gi">+++ /home/runner/work/exastro-it-automation-docs-dev/exastro-it-automation-docs-dev/workspace/src/ja/2.6/installation/literal_includes/exastro_database_hostpath.yaml</span>
<span class="gu">@@ -460,7 +460,7 @@</span>
<span class="w"> </span>    persistence:
<span class="w"> </span>      enabled: true
<span class="w"> </span>      accessMode: ReadWriteOnce
<span class="gd">-      size: 20Gi</span>
<span class="gi">+      size: XXGi                                       # 必要な容量に変更</span>
<span class="w"> </span>      storageClass: &quot;-&quot; # e.g.) azurefile or - (None)
<span class="w"> </span>      matchLabels:
<span class="w"> </span>        name: pv-database
</pre></div>
</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Exastro IT Automation 用データベースの設定</div>
</div>
<div class="line-block">
<div class="line">Exastro IT Automation コンテナがデータベースに接続できるようにするために、<a class="reference internal" href="../../online/exastro/kubernetes.html#database-setup"><span class="std std-ref">データベース連携</span></a> で作成した root アカウントのパスワードを設定します。</div>
</div>
<table class="filter-table docutils align-left" id="id49">
<caption><span class="caption-number">表 56 </span><span class="caption-text">共通設定 (Exastro IT Automation 用データベース) のオプションパラメータ</span><a class="headerlink" href="#id49" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 31.2%" />
<col style="width: 31.2%" />
<col style="width: 12.5%" />
<col style="width: 25.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>パラメータ</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>変更</p></th>
<th class="head"><p>デフォルト値・選択可能な設定値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>global.itaDatabaseDefinition.name</p></td>
<td><p>Exastro IT Automation 用データベースの定義名</p></td>
<td><p>不可</p></td>
<td><p>&quot;ita-database&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.itaDatabaseDefinition.enabled</p></td>
<td><p>Exastro IT Automation 用データベースの定義の利用有無</p></td>
<td><p>不可</p></td>
<td><p>true</p></td>
</tr>
<tr class="row-even"><td><p>global.itaDatabaseDefinition.config.DB_VENDOR</p></td>
<td><p>Exastro IT Automation 用データベースで使用するデータベース</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">&quot;mariadb&quot;</strong> (デフォルト): MariaDB を利用</div>
<div class="line"><strong class="program">&quot;mysql&quot;</strong>: MySQL を利用</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>global.itaDatabaseDefinition.config.DB_HOST</p></td>
<td><div class="line-block">
<div class="line">Exastro IT Automation 用データベース利用するDB</div>
<div class="line">デフォルト状態では、同一の Kubernetes クラスタ内にデプロイされるコンテナを指定しています。</div>
<div class="line">クラスタ外部の DB を利用する場合には設定が必要となります。</div>
</div>
</td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;mariadb&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.itaDatabaseDefinition.config.DB_PORT</p></td>
<td><p>Exastro IT Automation 用データベースで利用するポート番号(TCP)</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;3306&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.itaDatabaseDefinition.config.DB_DATABASE</p></td>
<td><p>Exastro IT Automation 用データベースで利用するデータベース名</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;platform&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.itaDatabaseDefinition.secret.DB_ADMIN_USER</p></td>
<td><p>Exastro IT Automation 用データベースで利用する管理権限を持つDBユーザ名</p></td>
<td><p>必須</p></td>
<td><p>管理権限を持つDBユーザ名</p></td>
</tr>
<tr class="row-odd"><td><p>global.itaDatabaseDefinition.secret.DB_ADMIN_PASSWORD</p></td>
<td><p>Exastro IT Automation 用データベースで利用する管理権限を持つDBユーザのパスワード(エンコードなし)</p></td>
<td><p>必須</p></td>
<td><p>管理権限を持つDBユーザ名のパスワード</p></td>
</tr>
<tr class="row-even"><td><p>global.itaDatabaseDefinition.secret.DB_USER</p></td>
<td><div class="line-block">
<div class="line">Exastro IT Automation 用データベースに作成するDBユーザ名。</div>
<div class="line">指定した DB ユーザが作成される。</div>
</div>
</td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
<tr class="row-odd"><td><p>global.itaDatabaseDefinition.secret.DB_PASSWORD</p></td>
<td><p>Exastro IT Automation 用データベースに作成するDBユーザのパスワード(エンコードなし)</p></td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
</tbody>
</table>
<div class="literal-block-wrapper docutils container" id="id50">
<div class="code-block-caption"><span class="caption-number">リスト 202 </span><span class="caption-text">exastro.yaml</span><a class="headerlink" href="#id50" title="Link to this code">¶</a></div>
<div class="highlight-udiff notranslate"><div class="highlight"><pre><span></span><span class="gd">--- /home/runner/work/exastro-it-automation-docs-dev/exastro-it-automation-docs-dev/workspace/src/ja/2.6/installation/literal_includes/exastro.yaml</span>
<span class="gi">+++ /home/runner/work/exastro-it-automation-docs-dev/exastro-it-automation-docs-dev/workspace/src/ja/2.6/installation/literal_includes/exastro_database_ita_setting.yaml</span>
<span class="gu">@@ -27,7 +27,7 @@</span>
<span class="w"> </span>      DB_DATABASE: &quot;ITA_DB&quot;
<span class="w"> </span>    secret:
<span class="w"> </span>      DB_ADMIN_USER: &quot;root&quot;
<span class="gd">-      DB_ADMIN_PASSWORD: &quot;Ch@ngeMeDBAdm&quot;</span>
<span class="gi">+      DB_ADMIN_PASSWORD: &quot;your-admin-password&quot; # 「1.  データベースコンテナの設定」で設定したコンテナデータベースの root のパスワード</span>
<span class="w"> </span>      DB_USER: &quot;ITA_USER&quot;
<span class="w"> </span>      DB_PASSWORD: &quot;Ch@ngeMeITADB&quot;
<span class="w"> </span>  pfGlobalDefinition:
</pre></div>
</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Exastro 共通基盤用データベースの設定</div>
</div>
<div class="line-block">
<div class="line">Exastro 共通基盤のコンテナがデータベースに接続できるようにするために、「1.  データベースコンテナの設定」で作成した root アカウントのパスワードを設定します。</div>
</div>
<table class="filter-table docutils align-left" id="id51">
<caption><span class="caption-number">表 57 </span><span class="caption-text">共通設定 (Exastro 共通基盤用データベース) のオプションパラメータ</span><a class="headerlink" href="#id51" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 31.2%" />
<col style="width: 31.2%" />
<col style="width: 12.5%" />
<col style="width: 25.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>パラメータ</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>変更</p></th>
<th class="head"><p>デフォルト値・選択可能な設定値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>global.pfDatabaseDefinition.name</p></td>
<td><p>認証機能用データベースの定義名</p></td>
<td><p>不可</p></td>
<td><p>&quot;pf-database&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.pfDatabaseDefinition.enabled</p></td>
<td><p>認証機能用データベースの定義の有効有無</p></td>
<td><p>不可</p></td>
<td><p>true</p></td>
</tr>
<tr class="row-even"><td><p>global.pfDatabaseDefinition.config.DB_VENDOR</p></td>
<td><p>認証機能用データベースで使用するデータベース</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">&quot;mariadb&quot;</strong> (デフォルト): MariaDB を利用</div>
<div class="line"><strong class="program">&quot;mysql&quot;</strong>: MySQL を利用</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>global.pfDatabaseDefinition.config.DB_HOST</p></td>
<td><div class="line-block">
<div class="line">認証機能用データベース利用するDB</div>
<div class="line">デフォルト状態では、同一の Kubernetes クラスタ内にデプロイされるコンテナを指定しています。</div>
<div class="line">クラスタ外部の DB を利用する場合には設定が必要となります。</div>
</div>
</td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;mariadb&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.pfDatabaseDefinition.config.DB_PORT</p></td>
<td><p>認証機能用データベースで利用するポート番号(TCP)</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;3306&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.pfDatabaseDefinition.config.DB_DATABASE</p></td>
<td><p>認証機能用データベースで利用するデータベース名</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;platform&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.pfDatabaseDefinition.secret.DB_ADMIN_USER</p></td>
<td><p>認証機能用データベースで利用する管理権限を持つDBユーザ名</p></td>
<td><p>必須</p></td>
<td><p>管理権限を持つDBユーザ名</p></td>
</tr>
<tr class="row-odd"><td><p>global.pfDatabaseDefinition.secret.DB_ADMIN_PASSWORD</p></td>
<td><p>認証機能用データベースで利用する管理権限を持つDBユーザのパスワード(エンコードなし)</p></td>
<td><p>必須</p></td>
<td><p>管理権限を持つDBユーザ名のパスワード</p></td>
</tr>
<tr class="row-even"><td><p>global.pfDatabaseDefinition.secret.DB_USER</p></td>
<td><div class="line-block">
<div class="line">認証機能用データベースに作成するDBユーザ名。</div>
<div class="line">指定した DB ユーザが作成される。</div>
</div>
</td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
<tr class="row-odd"><td><p>global.pfDatabaseDefinition.secret.DB_PASSWORD</p></td>
<td><p>認証機能用データベースに作成するDBユーザのパスワード(エンコードなし)</p></td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
</tbody>
</table>
<div class="literal-block-wrapper docutils container" id="id52">
<div class="code-block-caption"><span class="caption-number">リスト 203 </span><span class="caption-text">exastro.yaml</span><a class="headerlink" href="#id52" title="Link to this code">¶</a></div>
<div class="highlight-udiff notranslate"><div class="highlight"><pre><span></span><span class="gd">--- /home/runner/work/exastro-it-automation-docs-dev/exastro-it-automation-docs-dev/workspace/src/ja/2.6/installation/literal_includes/exastro.yaml</span>
<span class="gi">+++ /home/runner/work/exastro-it-automation-docs-dev/exastro-it-automation-docs-dev/workspace/src/ja/2.6/installation/literal_includes/exastro_database_pf_setting.yaml</span>
<span class="gu">@@ -58,7 +58,7 @@</span>
<span class="w"> </span>      DB_DATABASE: &quot;platform&quot;
<span class="w"> </span>    secret:
<span class="w"> </span>      DB_ADMIN_USER: &quot;root&quot;
<span class="gd">-      DB_ADMIN_PASSWORD: &quot;Ch@ngeMeDBAdm&quot;</span>
<span class="gi">+      DB_ADMIN_PASSWORD: &quot;your-admin-password&quot; # 「1.  データベースコンテナの設定」で設定したコンテナデータベースの root のパスワード</span>
<span class="w"> </span>      DB_USER: &quot;pf-user&quot;
<span class="w"> </span>      DB_PASSWORD: &quot;Ch@ngeMePFDB&quot;
<span class="w"> </span>  keycloakDefinition:
</pre></div>
</div>
</div>
</li>
<li><p>OASE用データベースの設定</p>
<div class="line-block">
<div class="line">OASE用データベースの接続情報を設定します。</div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line">MongoDBのユーザやデータベースを「自動払い出し( <a class="reference internal" href="../../../manuals/platform_management/organization.html#organization-creation"><span class="std std-ref">オーガナイゼーション作成</span></a> )」で利用する場合は、<strong class="command">MONGO_HOST</strong> の指定が必要です。</div>
<div class="line"><strong class="command">MONGO_ADMIN_USER</strong> がユーザやデータベースの作成・削除が可能（rootロールまたは同等の権限）である必要があります。</div>
<div class="line">上記の権限がない場合は「Python接続文字列( <a class="reference internal" href="../../../manuals/platform_management/organization.html#organization-creation"><span class="std std-ref">オーガナイゼーション作成</span></a> )」の指定が必要です。</div>
<div class="line">また、自動払い出しを利用しない場合は <strong class="command">MONGO_HOST</strong> の指定は不要です。</div>
</div>
</div>
<table class="filter-table docutils align-left" id="id53">
<caption><span class="caption-number">表 58 </span><span class="caption-text">OASE設定 (Exastro OASE用データベース) のオプションパラメータ</span><a class="headerlink" href="#id53" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 31.2%" />
<col style="width: 31.2%" />
<col style="width: 12.5%" />
<col style="width: 25.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>パラメータ</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>変更</p></th>
<th class="head"><p>デフォルト値・選択可能な設定値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>global.mongoDefinition.config.MONGO_PROTOCOL</p></td>
<td><div class="line-block">
<div class="line">OASE用データベースで利用するDBのプロトコル</div>
</div>
</td>
<td><p>可</p></td>
<td><p>&quot;http&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.mongoDefinition.config.MONGO_HOST</p></td>
<td><div class="line-block">
<div class="line">OASE用データベース利用するDB</div>
<div class="line">デフォルト状態では、同一の Kubernetes クラスタ内にデプロイされるコンテナを指定しています。</div>
<div class="line">クラスタ外部の DB を利用する場合には設定が必要となります。</div>
<div class="line">自動払い出しを利用しない場合は、&quot;&quot;（空）を指定してください。</div>
</div>
</td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;mongo&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.mongoDefinition.config.MONGO_PORT</p></td>
<td><p>OASE用データベースで利用するポート番号(TCP)</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;27017&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.mongoDefinition.secret.MONGO_ADMIN_USER</p></td>
<td><p>OASE用データベースで利用する管理権限を持つDBユーザ名</p></td>
<td><p>必須</p></td>
<td><p>管理権限を持つDBユーザ名</p></td>
</tr>
<tr class="row-even"><td><p>global.mongoDefinition.secret.DB_ADMIN_PASSWORD</p></td>
<td><p>OASE用データベースで利用する管理権限を持つDBユーザのパスワード(エンコードなし)</p></td>
<td><p>必須</p></td>
<td><p>管理権限を持つDBユーザ名のパスワード</p></td>
</tr>
</tbody>
</table>
<div class="literal-block-wrapper docutils container" id="id54">
<div class="code-block-caption"><span class="caption-number">リスト 204 </span><span class="caption-text">exastro.yaml</span><a class="headerlink" href="#id54" title="Link to this code">¶</a></div>
<div class="highlight-udiff notranslate"><div class="highlight"><pre><span></span><span class="gd">--- /home/runner/work/exastro-it-automation-docs-dev/exastro-it-automation-docs-dev/workspace/src/ja/2.6/installation/literal_includes/exastro.yaml</span>
<span class="gi">+++ /home/runner/work/exastro-it-automation-docs-dev/exastro-it-automation-docs-dev/workspace/src/ja/2.6/installation/literal_includes/exastro_database_mongo_setting.yaml</span>
<span class="gu">@@ -81,8 +81,8 @@</span>
<span class="w"> </span>      MONGO_HOST: &quot;mongo&quot; # &quot;mongo&quot; if use container.
<span class="w"> </span>      MONGO_PORT: &quot;27017&quot;
<span class="w"> </span>    secret:
<span class="gd">-      MONGO_ADMIN_USER: &quot;admin&quot;</span>
<span class="gd">-      MONGO_ADMIN_PASSWORD: &quot;Ch@ngeMeMGAdm&quot;</span>
<span class="gi">+      MONGO_ADMIN_USER: &quot;your-admin-account&quot;      # OASE用データベースの管理者ユーザ</span>
<span class="gi">+      MONGO_ADMIN_PASSWORD: &quot;your-admin-password&quot; # OASE用データベースの管理者ユーザのパスワード</span>
<span class="w"> </span>
<span class="w"> </span>exastro-it-automation:
<span class="w"> </span>  ita-api-admin:
<span class="gu">@@ -621,3 +621,4 @@</span>
<span class="w"> </span>              - mongo
<span class="w"> </span>          topologyKey: kubernetes.io/hostname
<span class="w"> </span>
<span class="gi">+</span>
</pre></div>
</div>
</div>
</li>
<li><p>MongoDBコンテナの設定</p>
<div class="line-block">
<div class="line">データベースのデータを永続化するために利用するストレージを指定します</div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line">MongoDBコンテナを利用しない場合、<strong class="command">exastro-platform.mongo.enabled</strong> をfalseに指定して下さい。</div>
</div>
</div>
<table class="filter-table docutils align-left" id="id55">
<caption><span class="caption-number">表 59 </span><span class="caption-text">MongoDB コンテナのオプションパラメータ</span><a class="headerlink" href="#id55" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 31.2%" />
<col style="width: 31.2%" />
<col style="width: 12.5%" />
<col style="width: 25.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>パラメータ</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>変更</p></th>
<th class="head"><p>デフォルト値・選択可能な設定値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>exastro-platform.mongo.enabled</p></td>
<td><p>MongoDB コンテナのデプロイの有無</p></td>
<td><p>可</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">true</strong> (デフォルト): MongoDB コンテナをデプロイします。</div>
<div class="line"><strong class="program">false</strong> : MongoDB コンテナをデプロイしません。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>exastro-platform.mongo.image.repository</p></td>
<td><p>コンテナイメージのリポジトリ名</p></td>
<td><p>不可</p></td>
<td><p>&quot;mongo&quot;</p></td>
</tr>
<tr class="row-even"><td><p>exastro-platform.mongo.image.pullPolicy</p></td>
<td><p>イメージプルポリシー</p></td>
<td><p>可</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">IfNotPresent</strong> (デフォルト): コンテナイメージが存在しない場合のみプル</div>
<div class="line"><strong class="program">Always</strong>: 毎回必ずプル</div>
<div class="line"><strong class="program">None</strong>: プルしない</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>exastro-platform.mongo.image.tag</p></td>
<td><p>コンテナイメージのタグ</p></td>
<td><p>不可</p></td>
<td><p>&quot;6.0&quot;</p></td>
</tr>
<tr class="row-even"><td><p>exastro-platform.mongo.persistence.enabled</p></td>
<td><p>Exastro 共用データベースのデータ永続化の有効フラグ</p></td>
<td><p>可</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">true</strong> (デフォルト): データを永続化する</div>
<div class="line"><strong class="program">false</strong>: データを永続化しない</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>exastro-platform.mongo.persistence.reinstall</p></td>
<td><p>再インストール時にデータ領域の初期化の要否</p></td>
<td><p>不可</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">true</strong> : データを初期化(削除)する</div>
<div class="line"><strong class="program">false</strong> (デフォルト): データを初期化(削除)しない</div>
</div>
</td>
</tr>
<tr class="row-even"><td><p>exastro-platform.mongo.persistence.accessMode</p></td>
<td><p>永続ボリュームのアクセスモードの指定。</p></td>
<td><p>不可</p></td>
<td><p>&quot;ReadWriteOnce&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>exastro-platform.mongo.persistence.size</p></td>
<td><p>永続ボリュームのディスク容量</p></td>
<td><p>可 (データ永続化時)</p></td>
<td><p>&quot;20Gi&quot;</p></td>
</tr>
<tr class="row-even"><td><p>exastro-platform.mongo.persistence.storageClass</p></td>
<td><p>永続ボリュームにストレージクラスを利用する場合のクラスを指定</p></td>
<td><p>可 (データ永続化時)</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">-</strong> (デフォルト): ストレージクラスを指定しない。</div>
<div class="line"><strong class="program">ストレージクラス名</strong>: クラウドプロバイダなどから提供されるストレージクラス名を指定。</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>exastro-platform.mongo.persistence.matchLabels.name</p></td>
<td><p>利用する永続ボリューム名を指定</p></td>
<td><p>不可</p></td>
<td><p>&quot;コメントアウト&quot;</p></td>
</tr>
<tr class="row-even"><td><p>exastro-platform.mongo.resources.requests.memory</p></td>
<td><p>メモリ要求</p></td>
<td><p>可</p></td>
<td><p>&quot;256Mi&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>exastro-platform.mongo.resources.requests.cpu</p></td>
<td><p>CPU要求</p></td>
<td><p>可</p></td>
<td><p>&quot;1m&quot;</p></td>
</tr>
<tr class="row-even"><td><p>exastro-platform.mongo.resources.limits.memory</p></td>
<td><p>メモリ上限</p></td>
<td><p>可</p></td>
<td><p>&quot;2Gi&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>exastro-platform.mongo.resources.limits.cpu</p></td>
<td><p>CPU上限</p></td>
<td><p>可</p></td>
<td><p>&quot;4&quot;</p></td>
</tr>
</tbody>
</table>
<div class="literal-block-wrapper docutils container" id="id56">
<div class="code-block-caption"><span class="caption-number">リスト 205 </span><span class="caption-text">exastro.yaml</span><a class="headerlink" href="#id56" title="Link to this code">¶</a></div>
<div class="highlight-udiff notranslate"><div class="highlight"><pre><span></span><span class="gd">--- /home/runner/work/exastro-it-automation-docs-dev/exastro-it-automation-docs-dev/workspace/src/ja/2.6/installation/literal_includes/exastro.yaml</span>
<span class="gi">+++ /home/runner/work/exastro-it-automation-docs-dev/exastro-it-automation-docs-dev/workspace/src/ja/2.6/installation/literal_includes/exastro_mongodb_hostpath.yaml</span>
<span class="gu">@@ -572,7 +572,7 @@</span>
<span class="w"> </span>    persistence:
<span class="w"> </span>      enabled: true
<span class="w"> </span>      accessMode: ReadWriteOnce
<span class="gd">-      size: 20Gi</span>
<span class="gi">+      size: XXGi</span>
<span class="w"> </span>      storageClass: &quot;-&quot; # e.g.) azurefile, local-path or - (None)
<span class="w"> </span>      matchLabels:
<span class="w"> </span>        # release: &quot;pv-mongo&quot;
<span class="gu">@@ -621,3 +621,4 @@</span>
<span class="w"> </span>              - mongo
<span class="w"> </span>          topologyKey: kubernetes.io/hostname
<span class="w"> </span>
<span class="gi">+</span>
</pre></div>
</div>
</div>
</li>
</ol>
</section>
<section id="db">
<h4>アプリケーションの DB ユーザー設定<a class="headerlink" href="#db" title="Link to this heading">¶</a></h4>
<div class="line-block">
<div class="line">Exastro でアプリケーションのために作成する DB ユーザーの設定をします。</div>
</div>
</section>
</section>
<section id="id12">
<h3>設定例<a class="headerlink" href="#id12" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">下記のアプリケーションが利用・作成する DB ユーザーをそれぞれ設定します。</div>
</div>
<ul class="simple">
<li><p>Exastro IT Automation</p></li>
<li><p>Exastro 共通基盤</p></li>
<li><p>Keycloak</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line">認証情報などはすべて平文で問題ありません。(Base64エンコードは不要)</div>
</div>
</div>
<ol class="arabic">
<li><div class="line-block">
<div class="line">Exastro IT Automation 用データベースの設定</div>
</div>
<div class="line-block">
<div class="line">アプリケーションが利用・作成する DB ユーザーを設定します。</div>
</div>
<table class="filter-table docutils align-left" id="id57">
<caption><span class="caption-number">表 60 </span><span class="caption-text">共通設定 (Exastro IT Automation 用データベース) のオプションパラメータ</span><a class="headerlink" href="#id57" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 31.2%" />
<col style="width: 31.2%" />
<col style="width: 12.5%" />
<col style="width: 25.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>パラメータ</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>変更</p></th>
<th class="head"><p>デフォルト値・選択可能な設定値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>global.itaDatabaseDefinition.name</p></td>
<td><p>Exastro IT Automation 用データベースの定義名</p></td>
<td><p>不可</p></td>
<td><p>&quot;ita-database&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.itaDatabaseDefinition.enabled</p></td>
<td><p>Exastro IT Automation 用データベースの定義の利用有無</p></td>
<td><p>不可</p></td>
<td><p>true</p></td>
</tr>
<tr class="row-even"><td><p>global.itaDatabaseDefinition.config.DB_VENDOR</p></td>
<td><p>Exastro IT Automation 用データベースで使用するデータベース</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">&quot;mariadb&quot;</strong> (デフォルト): MariaDB を利用</div>
<div class="line"><strong class="program">&quot;mysql&quot;</strong>: MySQL を利用</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>global.itaDatabaseDefinition.config.DB_HOST</p></td>
<td><div class="line-block">
<div class="line">Exastro IT Automation 用データベース利用するDB</div>
<div class="line">デフォルト状態では、同一の Kubernetes クラスタ内にデプロイされるコンテナを指定しています。</div>
<div class="line">クラスタ外部の DB を利用する場合には設定が必要となります。</div>
</div>
</td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;mariadb&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.itaDatabaseDefinition.config.DB_PORT</p></td>
<td><p>Exastro IT Automation 用データベースで利用するポート番号(TCP)</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;3306&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.itaDatabaseDefinition.config.DB_DATABASE</p></td>
<td><p>Exastro IT Automation 用データベースで利用するデータベース名</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;platform&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.itaDatabaseDefinition.secret.DB_ADMIN_USER</p></td>
<td><p>Exastro IT Automation 用データベースで利用する管理権限を持つDBユーザ名</p></td>
<td><p>必須</p></td>
<td><p>管理権限を持つDBユーザ名</p></td>
</tr>
<tr class="row-odd"><td><p>global.itaDatabaseDefinition.secret.DB_ADMIN_PASSWORD</p></td>
<td><p>Exastro IT Automation 用データベースで利用する管理権限を持つDBユーザのパスワード(エンコードなし)</p></td>
<td><p>必須</p></td>
<td><p>管理権限を持つDBユーザ名のパスワード</p></td>
</tr>
<tr class="row-even"><td><p>global.itaDatabaseDefinition.secret.DB_USER</p></td>
<td><div class="line-block">
<div class="line">Exastro IT Automation 用データベースに作成するDBユーザ名。</div>
<div class="line">指定した DB ユーザが作成される。</div>
</div>
</td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
<tr class="row-odd"><td><p>global.itaDatabaseDefinition.secret.DB_PASSWORD</p></td>
<td><p>Exastro IT Automation 用データベースに作成するDBユーザのパスワード(エンコードなし)</p></td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
</tbody>
</table>
<div class="literal-block-wrapper docutils container" id="id58">
<div class="code-block-caption"><span class="caption-number">リスト 206 </span><span class="caption-text">exastro.yaml</span><a class="headerlink" href="#id58" title="Link to this code">¶</a></div>
<div class="highlight-udiff notranslate"><div class="highlight"><pre><span></span><span class="gd">--- /home/runner/work/exastro-it-automation-docs-dev/exastro-it-automation-docs-dev/workspace/src/ja/2.6/installation/literal_includes/exastro.yaml</span>
<span class="gi">+++ /home/runner/work/exastro-it-automation-docs-dev/exastro-it-automation-docs-dev/workspace/src/ja/2.6/installation/literal_includes/exastro_db_user_ita.yaml</span>
<span class="gu">@@ -28,8 +28,8 @@</span>
<span class="w"> </span>    secret:
<span class="w"> </span>      DB_ADMIN_USER: &quot;root&quot;
<span class="w"> </span>      DB_ADMIN_PASSWORD: &quot;Ch@ngeMeDBAdm&quot;
<span class="gd">-      DB_USER: &quot;ITA_USER&quot;</span>
<span class="gd">-      DB_PASSWORD: &quot;Ch@ngeMeITADB&quot;</span>
<span class="gi">+      DB_USER: &quot;ita-db-user&quot;                # Exastro IT Automation のアプリが使うDBユーザー</span>
<span class="gi">+      DB_PASSWORD: &quot;ita-db-user-password&quot;   # Exastro IT Automation のアプリが使うDBユーザーのパスワード</span>
<span class="w"> </span>  pfGlobalDefinition:
<span class="w"> </span>    config:
<span class="w"> </span>      DEFAULT_LANGUAGE: &quot;ja&quot;
</pre></div>
</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Keycloak 用データベースの設定</div>
</div>
<div class="line-block">
<div class="line">アプリケーションが利用・作成する DB ユーザーを設定します。</div>
</div>
<table class="filter-table docutils align-left" id="id59">
<caption><span class="caption-number">表 61 </span><span class="caption-text">共通設定 (Keycloak) のオプションパラメータ</span><a class="headerlink" href="#id59" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 31.2%" />
<col style="width: 31.2%" />
<col style="width: 12.5%" />
<col style="width: 25.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>パラメータ</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>変更</p></th>
<th class="head"><p>デフォルト値・選択可能な設定値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>global.keycloakDefinition.name</p></td>
<td><p>Keycloak の定義名</p></td>
<td><p>不可</p></td>
<td><p>keycloak</p></td>
</tr>
<tr class="row-odd"><td><p>global.keycloakDefinition.enabled</p></td>
<td><p>Keycloak の定義の利用有無</p></td>
<td><p>不可</p></td>
<td><p>true</p></td>
</tr>
<tr class="row-even"><td><p>global.keycloakDefinition.config.API_KEYCLOAK_PROTOCOL</p></td>
<td><p>Keycloak API エンドポイントのプロトコル</p></td>
<td><p>不可</p></td>
<td><p>&quot;http”</p></td>
</tr>
<tr class="row-odd"><td><p>global.keycloakDefinition.config.API_KEYCLOAK_HOST</p></td>
<td><p>Keycloak API エンドポイントのホスト名、もしくは、FQDN</p></td>
<td><p>不可</p></td>
<td><p>&quot;keycloak&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.keycloakDefinition.config.API_KEYCLOAK_PORT</p></td>
<td><p>Keycloak API エンドポイントのポート番号</p></td>
<td><p>不可</p></td>
<td><p>&quot;8080&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.keycloakDefinition.config.KEYCLOAK_PROTOCOL</p></td>
<td><p>Keycloak エンドポイントのプロトコル</p></td>
<td><p>不可</p></td>
<td><p>&quot;http&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.keycloakDefinition.config.KEYCLOAK_HOST</p></td>
<td><p>Keycloak エンドポイントのホスト名、もしくは、FQDN</p></td>
<td><p>不可</p></td>
<td><p>&quot;keycloak&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.keycloakDefinition.config.KEYCLOAK_PORT</p></td>
<td><p>Keycloak API エンドポイントのポート番号</p></td>
<td><p>不可</p></td>
<td><p>&quot;8080&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.keycloakDefinition.config.KEYCLOAK_MASTER_REALM</p></td>
<td><p>Keycloak のマスターレルム名</p></td>
<td><p>不可</p></td>
<td><p>&quot;master&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.keycloakDefinition.config.KEYCLOAK_DB_DATABASE</p></td>
<td><p>Keycloak が利用するデータベース名</p></td>
<td><p>不可</p></td>
<td><p>&quot;keycloak&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.keycloakDefinition.secret.SYSTEM_ADMIN</p></td>
<td><div class="line-block">
<div class="line">Keycloak のマスターレルムにおける管理権限を持ったユーザ名を指定。</div>
<div class="line">指定した Keycloak ユーザが作成される。</div>
<div class="line">※KEYCLOAK_USER→SYSTEM_ADMINに変更</div>
</div>
</td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
<tr class="row-odd"><td><p>global.keycloakDefinition.secret.SYSTEM_ADMIN_PASSWORD</p></td>
<td><div class="line-block">
<div class="line">Keycloak のマスターレルムにおける管理権限を持ったユーザに設定するパスワード(エンコードなし)</div>
<div class="line">※KEYCLOAK_PASSWORD→SYSTEM_ADMIN_PASSWORDに変更</div>
</div>
</td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
<tr class="row-even"><td><p>global.keycloakDefinition.secret.KEYCLOAK_DB_USER</p></td>
<td><div class="line-block">
<div class="line">Keycloak が使用するデータベースユーザ。</div>
<div class="line">指定した DB ユーザが作成される。</div>
</div>
</td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
<tr class="row-odd"><td><p>global.keycloakDefinition.secret.KEYCLOAK_DB_PASSWORD</p></td>
<td><p>Keycloak が使用するデータベースユーザのパスワード(エンコードなし)</p></td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
</tbody>
</table>
<div class="literal-block-wrapper docutils container" id="id60">
<div class="code-block-caption"><span class="caption-number">リスト 207 </span><span class="caption-text">exastro.yaml</span><a class="headerlink" href="#id60" title="Link to this code">¶</a></div>
<div class="highlight-udiff notranslate"><div class="highlight"><pre><span></span><span class="gd">--- /home/runner/work/exastro-it-automation-docs-dev/exastro-it-automation-docs-dev/workspace/src/ja/2.6/installation/literal_includes/exastro.yaml</span>
<span class="gi">+++ /home/runner/work/exastro-it-automation-docs-dev/exastro-it-automation-docs-dev/workspace/src/ja/2.6/installation/literal_includes/exastro_db_user_keycloak.yaml</span>
<span class="gu">@@ -65,8 +65,8 @@</span>
<span class="w"> </span>    secret:
<span class="w"> </span>      SYSTEM_ADMIN: &quot;admin&quot;
<span class="w"> </span>      SYSTEM_ADMIN_PASSWORD: &quot;Ch@ngeMeKCAdm&quot;
<span class="gd">-      KEYCLOAK_DB_USER: &quot;keycloak&quot;</span>
<span class="gd">-      KEYCLOAK_DB_PASSWORD: &quot;Ch@ngeMeKCADB&quot;</span>
<span class="gi">+      KEYCLOAK_DB_USER: &quot;keycloak-db-user&quot;               # Keycloak が使うDBユーザー</span>
<span class="gi">+      KEYCLOAK_DB_PASSWORD: &quot;keycloak-db-user-password&quot;  # Keycloak が使うDBユーザーのパスワード</span>
<span class="w"> </span>  gitlabDefinition:
<span class="w"> </span>    config:
<span class="w"> </span>      GITLAB_PROTOCOL: &quot;http&quot;
</pre></div>
</div>
</div>
</li>
<li><div class="line-block">
<div class="line">Exastro 共通基盤用データベースの設定</div>
</div>
<div class="line-block">
<div class="line">アプリケーションが利用・作成する DB ユーザーを設定します。</div>
</div>
<table class="filter-table docutils align-left" id="id61">
<caption><span class="caption-number">表 62 </span><span class="caption-text">共通設定 (Exastro 共通基盤用データベース) のオプションパラメータ</span><a class="headerlink" href="#id61" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 31.2%" />
<col style="width: 31.2%" />
<col style="width: 12.5%" />
<col style="width: 25.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>パラメータ</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>変更</p></th>
<th class="head"><p>デフォルト値・選択可能な設定値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>global.pfDatabaseDefinition.name</p></td>
<td><p>認証機能用データベースの定義名</p></td>
<td><p>不可</p></td>
<td><p>&quot;pf-database&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.pfDatabaseDefinition.enabled</p></td>
<td><p>認証機能用データベースの定義の有効有無</p></td>
<td><p>不可</p></td>
<td><p>true</p></td>
</tr>
<tr class="row-even"><td><p>global.pfDatabaseDefinition.config.DB_VENDOR</p></td>
<td><p>認証機能用データベースで使用するデータベース</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><div class="line-block">
<div class="line"><strong class="program">&quot;mariadb&quot;</strong> (デフォルト): MariaDB を利用</div>
<div class="line"><strong class="program">&quot;mysql&quot;</strong>: MySQL を利用</div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p>global.pfDatabaseDefinition.config.DB_HOST</p></td>
<td><div class="line-block">
<div class="line">認証機能用データベース利用するDB</div>
<div class="line">デフォルト状態では、同一の Kubernetes クラスタ内にデプロイされるコンテナを指定しています。</div>
<div class="line">クラスタ外部の DB を利用する場合には設定が必要となります。</div>
</div>
</td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;mariadb&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.pfDatabaseDefinition.config.DB_PORT</p></td>
<td><p>認証機能用データベースで利用するポート番号(TCP)</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;3306&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.pfDatabaseDefinition.config.DB_DATABASE</p></td>
<td><p>認証機能用データベースで利用するデータベース名</p></td>
<td><p>可 (外部データベース利用時)</p></td>
<td><p>&quot;platform&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.pfDatabaseDefinition.secret.DB_ADMIN_USER</p></td>
<td><p>認証機能用データベースで利用する管理権限を持つDBユーザ名</p></td>
<td><p>必須</p></td>
<td><p>管理権限を持つDBユーザ名</p></td>
</tr>
<tr class="row-odd"><td><p>global.pfDatabaseDefinition.secret.DB_ADMIN_PASSWORD</p></td>
<td><p>認証機能用データベースで利用する管理権限を持つDBユーザのパスワード(エンコードなし)</p></td>
<td><p>必須</p></td>
<td><p>管理権限を持つDBユーザ名のパスワード</p></td>
</tr>
<tr class="row-even"><td><p>global.pfDatabaseDefinition.secret.DB_USER</p></td>
<td><div class="line-block">
<div class="line">認証機能用データベースに作成するDBユーザ名。</div>
<div class="line">指定した DB ユーザが作成される。</div>
</div>
</td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
<tr class="row-odd"><td><p>global.pfDatabaseDefinition.secret.DB_PASSWORD</p></td>
<td><p>認証機能用データベースに作成するDBユーザのパスワード(エンコードなし)</p></td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
</tbody>
</table>
<div class="literal-block-wrapper docutils container" id="id62">
<div class="code-block-caption"><span class="caption-number">リスト 208 </span><span class="caption-text">exastro.yaml</span><a class="headerlink" href="#id62" title="Link to this code">¶</a></div>
<div class="highlight-udiff notranslate"><div class="highlight"><pre><span></span><span class="gd">--- /home/runner/work/exastro-it-automation-docs-dev/exastro-it-automation-docs-dev/workspace/src/ja/2.6/installation/literal_includes/exastro.yaml</span>
<span class="gi">+++ /home/runner/work/exastro-it-automation-docs-dev/exastro-it-automation-docs-dev/workspace/src/ja/2.6/installation/literal_includes/exastro_db_user_pf.yaml</span>
<span class="gu">@@ -59,8 +59,8 @@</span>
<span class="w"> </span>    secret:
<span class="w"> </span>      DB_ADMIN_USER: &quot;root&quot;
<span class="w"> </span>      DB_ADMIN_PASSWORD: &quot;Ch@ngeMeDBAdm&quot;
<span class="gd">-      DB_USER: &quot;pf-user&quot;</span>
<span class="gd">-      DB_PASSWORD: &quot;Ch@ngeMePFDB&quot;</span>
<span class="gi">+      DB_USER: &quot;pf-db-user&quot;           # Exastro 共通基盤が使うDBユーザー</span>
<span class="gi">+      DB_PASSWORD: &quot;pf-db-password&quot;   # Exastro 共通基盤が使うDBユーザーのパスワード</span>
<span class="w"> </span>  keycloakDefinition:
<span class="w"> </span>    secret:
<span class="w"> </span>      SYSTEM_ADMIN: &quot;admin&quot;
</pre></div>
</div>
</div>
</li>
</ol>
<section id="gitlab">
<h4>GitLab 連携設定<a class="headerlink" href="#gitlab" title="Link to this heading">¶</a></h4>
<div class="line-block">
<div class="line">GitLab 連携のための接続情報を登録します。</div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line">GitLab 連携を利用しない場合は、下記のように設定してください。</div>
<div class="line">GITLAB_HOST: &quot;&quot;</div>
</div>
</div>
<table class="filter-table docutils align-left" id="id63">
<caption><span class="caption-number">表 63 </span><span class="caption-text">共通設定 (GitLab) のオプションパラメータ</span><a class="headerlink" href="#id63" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 31.2%" />
<col style="width: 31.2%" />
<col style="width: 12.5%" />
<col style="width: 25.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>パラメータ</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>変更</p></th>
<th class="head"><p>デフォルト値・選択可能な設定値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>global.gitlabDefinition.name</p></td>
<td><p>GitLab の定義名</p></td>
<td><p>不可</p></td>
<td><p>gitlab</p></td>
</tr>
<tr class="row-odd"><td><p>global.gitlabDefinition.enabled</p></td>
<td><p>GitLab の定義の利用有無</p></td>
<td><p>不可</p></td>
<td><p>true</p></td>
</tr>
<tr class="row-even"><td><p>global.gitlabDefinition.config.GITLAB_PROTOCOL</p></td>
<td><p>GitLab エンドポイントのプロトコル</p></td>
<td><p>可</p></td>
<td><p>http</p></td>
</tr>
<tr class="row-odd"><td><p>global.gitlabDefinition.config.GITLAB_HOST</p></td>
<td><p>GitLab エンドポイントへのホスト名、もしくは、FQDN</p></td>
<td><p>可</p></td>
<td><p>gitlab</p></td>
</tr>
<tr class="row-even"><td><p>global.gitlabDefinition.config.GITLAB_PORT</p></td>
<td><p>GitLab エンドポイントのポート番号</p></td>
<td><p>可</p></td>
<td><p>80</p></td>
</tr>
<tr class="row-odd"><td><p>global.gitlabDefinition.secret.GITLAB_ROOT_PASSWORD</p></td>
<td><p>GitLab の root 権限アカウントのユーザーパスワード</p></td>
<td><p>必須</p></td>
<td><p>任意の文字列（8文字以上で予測可能な単語等は利用不可）</p></td>
</tr>
<tr class="row-even"><td><p>global.gitlabDefinition.secret.GITLAB_ROOT_TOKEN</p></td>
<td><p>GitLab の root 権限アカウントのアクセストークン</p></td>
<td><p>必須</p></td>
<td><p>アクセエストークン(平文)</p></td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<div class="line-block">
<div class="line">GITLAB_ROOT_TOKEN は下記の権限スコープが割り当てられたトークンが必要です。</div>
<div class="line">・api</div>
<div class="line">・write_repository</div>
<div class="line">・sudo</div>
</div>
</div>
<div class="line-block">
<div class="line">下記は、GitLab 連携の設定例を記載しています。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id64">
<div class="code-block-caption"><span class="caption-number">リスト 209 </span><span class="caption-text">exastro.yaml</span><a class="headerlink" href="#id64" title="Link to this code">¶</a></div>
<div class="highlight-udiff notranslate"><div class="highlight"><pre><span></span><span class="gd">--- /home/runner/work/exastro-it-automation-docs-dev/exastro-it-automation-docs-dev/workspace/src/ja/2.6/installation/literal_includes/exastro.yaml</span>
<span class="gi">+++ /home/runner/work/exastro-it-automation-docs-dev/exastro-it-automation-docs-dev/workspace/src/ja/2.6/installation/literal_includes/exastro_gitlab_setting.yaml</span>
<span class="gu">@@ -69,12 +69,12 @@</span>
<span class="w"> </span>      KEYCLOAK_DB_PASSWORD: &quot;Ch@ngeMeKCADB&quot;
<span class="w"> </span>  gitlabDefinition:
<span class="w"> </span>    config:
<span class="gd">-      GITLAB_PROTOCOL: &quot;http&quot;</span>
<span class="gd">-      GITLAB_HOST: &quot;&quot; # &quot;gitlab&quot; if use container.</span>
<span class="gd">-      GITLAB_PORT: &quot;8080&quot;</span>
<span class="gi">+      GITLAB_PROTOCOL: &quot;接続プロトコル http or https&quot;</span>
<span class="gi">+      GITLAB_HOST: &quot;your.gitlab.endpoint&quot; # 起動する Gitalb コンテナの公開時のURL。AAPから接続できる必要がある。</span>
<span class="gi">+      GITLAB_PORT: &quot;30082&quot;                # 起動する Gitalb コンテナの公開時のポート番号</span>
<span class="w"> </span>    secret:
<span class="gd">-      GITLAB_ROOT_PASSWORD: &quot;Ch@ngeMeGL&quot;</span>
<span class="gd">-      GITLAB_ROOT_TOKEN: &quot;change-this-token&quot;</span>
<span class="gi">+      GITLAB_ROOT_PASSWORD: &quot;GitLabのRoot権限をユーザーパスワード&quot;</span>
<span class="gi">+      GITLAB_ROOT_TOKEN: &quot;GitLabのRoot権限を持ったトークン&quot;</span>
<span class="w"> </span>  mongoDefinition:
<span class="w"> </span>    config:
<span class="w"> </span>      MONGO_PROTOCOL: &quot;http&quot;
</pre></div>
</div>
</div>
</section>
<section id="id13">
<h4>システム管理者の作成<a class="headerlink" href="#id13" title="Link to this heading">¶</a></h4>
<div class="line-block">
<div class="line">セットアップ時に システム管理者の初期ユーザーを作成するための情報を設定します。</div>
</div>
<table class="filter-table docutils align-left" id="id65">
<caption><span class="caption-number">表 64 </span><span class="caption-text">共通設定 (Keycloak) のオプションパラメータ</span><a class="headerlink" href="#id65" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 31.2%" />
<col style="width: 31.2%" />
<col style="width: 12.5%" />
<col style="width: 25.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>パラメータ</p></th>
<th class="head"><p>説明</p></th>
<th class="head"><p>変更</p></th>
<th class="head"><p>デフォルト値・選択可能な設定値</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>global.keycloakDefinition.name</p></td>
<td><p>Keycloak の定義名</p></td>
<td><p>不可</p></td>
<td><p>keycloak</p></td>
</tr>
<tr class="row-odd"><td><p>global.keycloakDefinition.enabled</p></td>
<td><p>Keycloak の定義の利用有無</p></td>
<td><p>不可</p></td>
<td><p>true</p></td>
</tr>
<tr class="row-even"><td><p>global.keycloakDefinition.config.API_KEYCLOAK_PROTOCOL</p></td>
<td><p>Keycloak API エンドポイントのプロトコル</p></td>
<td><p>不可</p></td>
<td><p>&quot;http”</p></td>
</tr>
<tr class="row-odd"><td><p>global.keycloakDefinition.config.API_KEYCLOAK_HOST</p></td>
<td><p>Keycloak API エンドポイントのホスト名、もしくは、FQDN</p></td>
<td><p>不可</p></td>
<td><p>&quot;keycloak&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.keycloakDefinition.config.API_KEYCLOAK_PORT</p></td>
<td><p>Keycloak API エンドポイントのポート番号</p></td>
<td><p>不可</p></td>
<td><p>&quot;8080&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.keycloakDefinition.config.KEYCLOAK_PROTOCOL</p></td>
<td><p>Keycloak エンドポイントのプロトコル</p></td>
<td><p>不可</p></td>
<td><p>&quot;http&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.keycloakDefinition.config.KEYCLOAK_HOST</p></td>
<td><p>Keycloak エンドポイントのホスト名、もしくは、FQDN</p></td>
<td><p>不可</p></td>
<td><p>&quot;keycloak&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.keycloakDefinition.config.KEYCLOAK_PORT</p></td>
<td><p>Keycloak API エンドポイントのポート番号</p></td>
<td><p>不可</p></td>
<td><p>&quot;8080&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.keycloakDefinition.config.KEYCLOAK_MASTER_REALM</p></td>
<td><p>Keycloak のマスターレルム名</p></td>
<td><p>不可</p></td>
<td><p>&quot;master&quot;</p></td>
</tr>
<tr class="row-odd"><td><p>global.keycloakDefinition.config.KEYCLOAK_DB_DATABASE</p></td>
<td><p>Keycloak が利用するデータベース名</p></td>
<td><p>不可</p></td>
<td><p>&quot;keycloak&quot;</p></td>
</tr>
<tr class="row-even"><td><p>global.keycloakDefinition.secret.SYSTEM_ADMIN</p></td>
<td><div class="line-block">
<div class="line">Keycloak のマスターレルムにおける管理権限を持ったユーザ名を指定。</div>
<div class="line">指定した Keycloak ユーザが作成される。</div>
<div class="line">※KEYCLOAK_USER→SYSTEM_ADMINに変更</div>
</div>
</td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
<tr class="row-odd"><td><p>global.keycloakDefinition.secret.SYSTEM_ADMIN_PASSWORD</p></td>
<td><div class="line-block">
<div class="line">Keycloak のマスターレルムにおける管理権限を持ったユーザに設定するパスワード(エンコードなし)</div>
<div class="line">※KEYCLOAK_PASSWORD→SYSTEM_ADMIN_PASSWORDに変更</div>
</div>
</td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
<tr class="row-even"><td><p>global.keycloakDefinition.secret.KEYCLOAK_DB_USER</p></td>
<td><div class="line-block">
<div class="line">Keycloak が使用するデータベースユーザ。</div>
<div class="line">指定した DB ユーザが作成される。</div>
</div>
</td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
<tr class="row-odd"><td><p>global.keycloakDefinition.secret.KEYCLOAK_DB_PASSWORD</p></td>
<td><p>Keycloak が使用するデータベースユーザのパスワード(エンコードなし)</p></td>
<td><p>必須</p></td>
<td><p>任意の文字列</p></td>
</tr>
</tbody>
</table>
<div class="literal-block-wrapper docutils container" id="id66">
<div class="code-block-caption"><span class="caption-number">リスト 210 </span><span class="caption-text">exastro.yaml</span><a class="headerlink" href="#id66" title="Link to this code">¶</a></div>
<div class="highlight-udiff notranslate"><div class="highlight"><pre><span></span><span class="gd">--- /home/runner/work/exastro-it-automation-docs-dev/exastro-it-automation-docs-dev/workspace/src/ja/2.6/installation/literal_includes/exastro.yaml</span>
<span class="gi">+++ /home/runner/work/exastro-it-automation-docs-dev/exastro-it-automation-docs-dev/workspace/src/ja/2.6/installation/literal_includes/exastro_usercreate_system_manager.yaml</span>
<span class="gu">@@ -63,8 +63,8 @@</span>
<span class="w"> </span>      DB_PASSWORD: &quot;Ch@ngeMePFDB&quot;
<span class="w"> </span>  keycloakDefinition:
<span class="w"> </span>    secret:
<span class="gd">-      SYSTEM_ADMIN: &quot;admin&quot;</span>
<span class="gd">-      SYSTEM_ADMIN_PASSWORD: &quot;Ch@ngeMeKCAdm&quot;</span>
<span class="gi">+      SYSTEM_ADMIN: &quot;admin&quot;                     # Exastro システムのシステム管理者のユーザー名</span>
<span class="gi">+      SYSTEM_ADMIN_PASSWORD: &quot;admin-password&quot;   # Exastro システムのシステム管理者のユーザーパスワード</span>
<span class="w"> </span>      KEYCLOAK_DB_USER: &quot;keycloak&quot;
<span class="w"> </span>      KEYCLOAK_DB_PASSWORD: &quot;Ch@ngeMeKCADB&quot;
<span class="w"> </span>  gitlabDefinition:
</pre></div>
</div>
</div>
</section>
<section id="id14">
<h4>永続ボリュームの設定<a class="headerlink" href="#id14" title="Link to this heading">¶</a></h4>
<div class="line-block">
<div class="line">永続ボリュームの設定ファイルを作成します。</div>
<div class="line">データベースのデータ永続化 (クラスタ内コンテナがある場合)、および、ファイルの永続化のために、永続ボリュームを設定する必要があります。</div>
<div class="line">永続ボリュームの詳細については、 <a class="reference external" href="https://kubernetes.io/ja/docs/concepts/storage/persistent-volumes/#%E6%B0%B8%E7%B6%9A%E3%83%9C%E3%83%AA%E3%83%A5%E3%83%BC%E3%83%A0">永続ボリューム - Kubernetes</a> を参照してください。</div>
<div class="line">ここではKubernetes のノード上のストレージ領域を使用する方法を例に記載しています。</div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">監査ログを永続ボリュームに出力する際は、永続ボリュームの設定が必要となります。</div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<div class="line-block">
<div class="line">hostpathで指定するディレクトリは、アクセス権を設定する必要があります</div>
<div class="line">例） chmod 777 [該当のディレクトリ]</div>
</div>
</div>
<div class="admonition danger">
<p class="admonition-title">危険</p>
<div class="line-block">
<div class="line">データの永続化自体は可能ですが、コンピュートノードの増減や変更によりデータが消えてしまう可能性があるため本番環境では使用しないでください。</div>
<div class="line">また、Azure で構築した AKS クラスタは、クラスタを停止すると AKS クラスターの Node が解放されるため、保存していた情報は消えてしまいます。そのため、Node が停止しないように注意が必要となります。</div>
</div>
</div>
<div class="line-block">
<div class="line">hostPath を使用した例を記載します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id67">
<div class="code-block-caption"><span class="caption-number">リスト 211 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id67" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>vi<span class="w"> </span>pv-database.yaml
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id68">
<div class="code-block-caption"><span class="caption-number">リスト 212 </span><span class="caption-text">pv-database.yaml (データベース用ボリューム)</span><a class="headerlink" href="#id68" title="Link to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># pv-database.yaml</span>
<span class="linenos"> 2</span><span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="linenos"> 3</span><span class="n">kind</span><span class="p">:</span> <span class="n">PersistentVolume</span>
<span class="linenos"> 4</span><span class="n">metadata</span><span class="p">:</span>
<span class="linenos"> 5</span>  <span class="n">name</span><span class="p">:</span> <span class="n">pv</span><span class="o">-</span><span class="n">database</span>
<span class="linenos"> 6</span><span class="n">spec</span><span class="p">:</span>
<span class="linenos"> 7</span>  <span class="n">claimRef</span><span class="p">:</span>
<span class="linenos"> 8</span>    <span class="n">name</span><span class="p">:</span> <span class="n">pvc</span><span class="o">-</span><span class="n">mariadb</span>
<span class="linenos"> 9</span>    <span class="n">namespace</span><span class="p">:</span> <span class="n">exastro</span>
<span class="linenos">10</span>  <span class="n">capacity</span><span class="p">:</span>
<span class="linenos">11</span>    <span class="n">storage</span><span class="p">:</span> <span class="mi">20</span><span class="n">Gi</span>
<span class="linenos">12</span>  <span class="n">accessModes</span><span class="p">:</span>
<span class="linenos">13</span>    <span class="o">-</span> <span class="n">ReadWriteOnce</span>
<span class="linenos">14</span>  <span class="n">persistentVolumeReclaimPolicy</span><span class="p">:</span> <span class="n">Retain</span>
<span class="linenos">15</span>  <span class="n">hostPath</span><span class="p">:</span>
<span class="linenos">16</span>    <span class="n">path</span><span class="p">:</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">exastro</span><span class="o">-</span><span class="n">suite</span><span class="o">/</span><span class="n">exastro</span><span class="o">-</span><span class="n">platform</span><span class="o">/</span><span class="n">database</span>
<span class="linenos">17</span>    <span class="nb">type</span><span class="p">:</span> <span class="n">DirectoryOrCreate</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id69">
<div class="code-block-caption"><span class="caption-number">リスト 213 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id69" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>vi<span class="w"> </span>pv-ita-common.yaml
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id70">
<div class="code-block-caption"><span class="caption-number">リスト 214 </span><span class="caption-text">pv-ita-common.yaml (ファイル用ボリューム)</span><a class="headerlink" href="#id70" title="Link to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># pv-ita-common.yaml</span>
<span class="linenos"> 2</span><span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="linenos"> 3</span><span class="n">kind</span><span class="p">:</span> <span class="n">PersistentVolume</span>
<span class="linenos"> 4</span><span class="n">metadata</span><span class="p">:</span>
<span class="linenos"> 5</span>  <span class="n">name</span><span class="p">:</span> <span class="n">pv</span><span class="o">-</span><span class="n">ita</span><span class="o">-</span><span class="n">common</span>
<span class="linenos"> 6</span><span class="n">spec</span><span class="p">:</span>
<span class="linenos"> 7</span>  <span class="n">claimRef</span><span class="p">:</span>
<span class="linenos"> 8</span>    <span class="n">name</span><span class="p">:</span> <span class="n">pvc</span><span class="o">-</span><span class="n">ita</span><span class="o">-</span><span class="k">global</span>
<span class="linenos"> 9</span>    <span class="n">namespace</span><span class="p">:</span> <span class="n">exastro</span>
<span class="linenos">10</span>  <span class="n">capacity</span><span class="p">:</span>
<span class="linenos">11</span>    <span class="n">storage</span><span class="p">:</span> <span class="mi">10</span><span class="n">Gi</span>
<span class="linenos">12</span>  <span class="n">accessModes</span><span class="p">:</span>
<span class="linenos">13</span>    <span class="o">-</span> <span class="n">ReadWriteMany</span>
<span class="linenos">14</span>  <span class="n">persistentVolumeReclaimPolicy</span><span class="p">:</span> <span class="n">Retain</span>
<span class="linenos">15</span>  <span class="n">hostPath</span><span class="p">:</span>
<span class="linenos">16</span>    <span class="n">path</span><span class="p">:</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">exastro</span><span class="o">-</span><span class="n">suite</span><span class="o">/</span><span class="n">exastro</span><span class="o">-</span><span class="n">it</span><span class="o">-</span><span class="n">automation</span><span class="o">/</span><span class="n">ita</span><span class="o">-</span><span class="n">common</span>
<span class="linenos">17</span>    <span class="nb">type</span><span class="p">:</span> <span class="n">DirectoryOrCreate</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id71">
<div class="code-block-caption"><span class="caption-number">リスト 215 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id71" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>vi<span class="w"> </span>pv-mongo.yaml
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id72">
<div class="code-block-caption"><span class="caption-number">リスト 216 </span><span class="caption-text">pv-mongo.yaml (OASE用ボリューム) ※OASEを利用しない場合設定不要</span><a class="headerlink" href="#id72" title="Link to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># pv-mongo.yaml</span>
<span class="linenos"> 2</span><span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="linenos"> 3</span><span class="n">kind</span><span class="p">:</span> <span class="n">PersistentVolume</span>
<span class="linenos"> 4</span><span class="n">metadata</span><span class="p">:</span>
<span class="linenos"> 5</span>  <span class="n">name</span><span class="p">:</span> <span class="n">pv</span><span class="o">-</span><span class="n">mongo</span>
<span class="linenos"> 6</span><span class="n">spec</span><span class="p">:</span>
<span class="linenos"> 7</span>  <span class="n">claimRef</span><span class="p">:</span>
<span class="linenos"> 8</span>    <span class="n">name</span><span class="p">:</span> <span class="n">volume</span><span class="o">-</span><span class="n">mongo</span><span class="o">-</span><span class="n">storage</span><span class="o">-</span><span class="n">mongo</span><span class="o">-</span><span class="mi">0</span>
<span class="linenos"> 9</span>    <span class="n">namespace</span><span class="p">:</span> <span class="n">exastro</span>
<span class="linenos">10</span>  <span class="n">capacity</span><span class="p">:</span>
<span class="linenos">11</span>    <span class="n">storage</span><span class="p">:</span> <span class="mi">20</span><span class="n">Gi</span>
<span class="linenos">12</span>  <span class="n">accessModes</span><span class="p">:</span>
<span class="linenos">13</span>    <span class="o">-</span> <span class="n">ReadWriteOnce</span>
<span class="linenos">14</span>  <span class="n">persistentVolumeReclaimPolicy</span><span class="p">:</span> <span class="n">Retain</span>
<span class="linenos">15</span>  <span class="n">hostPath</span><span class="p">:</span>
<span class="linenos">16</span>    <span class="n">path</span><span class="p">:</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">exastro</span><span class="o">-</span><span class="n">suite</span><span class="o">/</span><span class="n">exastro</span><span class="o">-</span><span class="n">platform</span><span class="o">/</span><span class="n">mongo</span>
<span class="linenos">17</span>    <span class="nb">type</span><span class="p">:</span> <span class="n">DirectoryOrCreate</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id73">
<div class="code-block-caption"><span class="caption-number">リスト 217 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id73" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>vi<span class="w"> </span>pv-gitlab.yaml
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id74">
<div class="code-block-caption"><span class="caption-number">リスト 218 </span><span class="caption-text">pv-gitlab.yaml (GitLab用ボリューム) ※外部GitLabを利用する場合設定不要</span><a class="headerlink" href="#id74" title="Link to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># pv-gitlab.yaml</span>
<span class="linenos"> 2</span><span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="linenos"> 3</span><span class="n">kind</span><span class="p">:</span> <span class="n">PersistentVolume</span>
<span class="linenos"> 4</span><span class="n">metadata</span><span class="p">:</span>
<span class="linenos"> 5</span>  <span class="n">name</span><span class="p">:</span> <span class="n">pv</span><span class="o">-</span><span class="n">gitlab</span>
<span class="linenos"> 6</span><span class="n">spec</span><span class="p">:</span>
<span class="linenos"> 7</span>  <span class="n">claimRef</span><span class="p">:</span>
<span class="linenos"> 8</span>    <span class="n">name</span><span class="p">:</span> <span class="n">pvc</span><span class="o">-</span><span class="n">gitlab</span>
<span class="linenos"> 9</span>    <span class="n">namespace</span><span class="p">:</span> <span class="n">exastro</span>
<span class="linenos">10</span>  <span class="n">capacity</span><span class="p">:</span>
<span class="linenos">11</span>    <span class="n">storage</span><span class="p">:</span> <span class="mi">20</span><span class="n">Gi</span>
<span class="linenos">12</span>  <span class="n">accessModes</span><span class="p">:</span>
<span class="linenos">13</span>    <span class="o">-</span> <span class="n">ReadWriteMany</span>
<span class="linenos">14</span>  <span class="n">persistentVolumeReclaimPolicy</span><span class="p">:</span> <span class="n">Retain</span>
<span class="linenos">15</span>  <span class="n">hostPath</span><span class="p">:</span>
<span class="linenos">16</span>    <span class="n">path</span><span class="p">:</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">exastro</span><span class="o">-</span><span class="n">suite</span><span class="o">/</span><span class="n">exastro</span><span class="o">-</span><span class="n">platform</span><span class="o">/</span><span class="n">gitlab</span>
<span class="linenos">17</span>    <span class="nb">type</span><span class="p">:</span> <span class="n">DirectoryOrCreate</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">※ 監査ログを永続ボリュームに出力する際は、exastro.yamlに以下の設定が必要となります</div>
</div>
<div class="literal-block-wrapper docutils container" id="id75">
<div class="code-block-caption"><span class="caption-number">リスト 219 </span><span class="caption-text">exastro.yaml</span><a class="headerlink" href="#id75" title="Link to this code">¶</a></div>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="w"> </span> pfAuditLogDefinition:
<span class="w"> </span>   name: pf-auditlog
<span class="w"> </span>   persistence:
<span class="gd">-      enabled: false</span>
<span class="gi">+      enabled: true</span>
<span class="w"> </span>     reinstall: false
<span class="w"> </span>     accessMode: ReadWriteMany
<span class="w"> </span>     size: 10Gi
<span class="w"> </span>     volumeType: hostPath # e.g.) hostPath or AKS
<span class="w"> </span>     storageClass: &quot;-&quot; # e.g.) azurefile or - (None)
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id76">
<div class="code-block-caption"><span class="caption-number">リスト 220 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id76" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>vi<span class="w"> </span>pv-pf-auditlog.yaml
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id77">
<div class="code-block-caption"><span class="caption-number">リスト 221 </span><span class="caption-text">pv-pf-auditlog.yaml (監査ログファイル用ボリューム)</span><a class="headerlink" href="#id77" title="Link to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1"># pv-pf-auditlog.yaml</span>
<span class="linenos"> 2</span><span class="n">apiVersion</span><span class="p">:</span> <span class="n">v1</span>
<span class="linenos"> 3</span><span class="n">kind</span><span class="p">:</span> <span class="n">PersistentVolume</span>
<span class="linenos"> 4</span><span class="n">metadata</span><span class="p">:</span>
<span class="linenos"> 5</span>  <span class="n">name</span><span class="p">:</span> <span class="n">pv</span><span class="o">-</span><span class="n">auditlog</span>
<span class="linenos"> 6</span><span class="n">spec</span><span class="p">:</span>
<span class="linenos"> 7</span>  <span class="n">claimRef</span><span class="p">:</span>
<span class="linenos"> 8</span>    <span class="n">name</span><span class="p">:</span> <span class="n">pvc</span><span class="o">-</span><span class="n">pf</span><span class="o">-</span><span class="n">auditlog</span>
<span class="linenos"> 9</span>    <span class="n">namespace</span><span class="p">:</span> <span class="n">exastro</span>
<span class="linenos">10</span>  <span class="n">capacity</span><span class="p">:</span>
<span class="linenos">11</span>    <span class="n">storage</span><span class="p">:</span> <span class="mi">10</span><span class="n">Gi</span>
<span class="linenos">12</span>  <span class="n">accessModes</span><span class="p">:</span>
<span class="linenos">13</span>    <span class="o">-</span> <span class="n">ReadWriteMany</span>
<span class="linenos">14</span>  <span class="n">persistentVolumeReclaimPolicy</span><span class="p">:</span> <span class="n">Retain</span>
<span class="linenos">15</span>  <span class="n">hostPath</span><span class="p">:</span>
<span class="linenos">16</span>    <span class="n">path</span><span class="p">:</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">exastro</span>
<span class="linenos">17</span>    <span class="nb">type</span><span class="p">:</span> <span class="n">DirectoryOrCreate</span>
</pre></div>
</div>
</div>
</section>
</section>
<section id="kubespraykubernetes">
<h3>③kubespray及びkubernetesのコンテナイメージの取得<a class="headerlink" href="#kubespraykubernetes" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line"><kbd class="kbd docutils literal notranslate">git</kbd> <kbd class="kbd docutils literal notranslate">clone</kbd> を用いてkubesprayを取得します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id78">
<div class="code-block-caption"><span class="caption-number">リスト 222 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id78" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/tmp

git<span class="w"> </span>clone<span class="w"> </span>https://github.com/kubernetes-sigs/kubespray.git<span class="w"> </span>-b<span class="w"> </span>release-2.23
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">kubernetesのコンテナイメージ一覧を取得します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id79">
<div class="code-block-caption"><span class="caption-number">リスト 223 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id79" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>kubespray/contrib/offline

./generate_list.sh

cp<span class="w"> </span>-ip<span class="w"> </span>/tmp/kubespray/contrib/offline/temp/images.list<span class="w"> </span>/tmp/work/k8s-images.list
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">kubernetesのコンテナイメージを取得するシェルスクリプト作成します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id80">
<div class="code-block-caption"><span class="caption-number">リスト 224 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id80" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/tmp/work

vi<span class="w"> </span>k8s-image-save.sh
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id81">
<div class="code-block-caption"><span class="caption-number">リスト 225 </span><span class="caption-text">下記のコードをコピー＆ペーストします</span><a class="headerlink" href="#id81" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

mkdir<span class="w"> </span>k8s-images

readarray<span class="w"> </span>-t<span class="w"> </span>image_list<span class="w"> </span>&lt;<span class="w"> </span><span class="s2">&quot;./k8s-images.list&quot;</span>
<span class="k">for</span><span class="w"> </span>image<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="si">${</span><span class="nv">image_list</span><span class="p">[@]</span><span class="si">}</span>
<span class="k">do</span>
<span class="w">  </span><span class="nv">image_fullname</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="si">${</span><span class="nv">image</span><span class="si">}</span><span class="k">)</span>
<span class="w">  </span><span class="nv">image_name</span><span class="o">=</span><span class="k">$(</span>basename<span class="w"> </span><span class="si">${</span><span class="nv">image_fullname</span><span class="si">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;s/:/-/&quot;</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;s/docker.io//&quot;</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;s/registry.k8s.io//&quot;</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;s/quay.io//&quot;</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;s/ghcr.io//&quot;</span><span class="k">)</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-e<span class="w"> </span>k8s-images/<span class="si">${</span><span class="nv">image_name</span><span class="si">}</span>.tar.gz<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$image_fullname</span><span class="w"> </span><span class="nv">$image_name</span>
<span class="w">    </span>docker<span class="w"> </span>pull<span class="w"> </span><span class="si">${</span><span class="nv">image_fullname</span><span class="si">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$?</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">      </span>docker<span class="w"> </span>save<span class="w"> </span><span class="si">${</span><span class="nv">image_fullname</span><span class="si">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>gzip<span class="w"> </span>-c<span class="w"> </span>&gt;<span class="w"> </span>k8s-images/<span class="si">${</span><span class="nv">image_name</span><span class="si">}</span>.tar.gz
<span class="w">    </span><span class="k">fi</span>
<span class="w">  </span><span class="k">fi</span>
<span class="k">done</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">作成したシェルスクリプトを実行し、kubernetesのコンテナイメージを取得します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id82">
<div class="code-block-caption"><span class="caption-number">リスト 226 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id82" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>chmod<span class="w"> </span>a+x<span class="w"> </span>k8s-image-save.sh

./k8s-image-save.sh
</pre></div>
</div>
</div>
</section>
<section id="id15">
<h3>④パッケージファイルの取得<a class="headerlink" href="#id15" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">Ansible実行サーバにインストールするパッケージファイルをダウンロードします。</div>
<div class="line">--releasever=x.xはAnsibleを実行するサーバのOSのバージョンを指定します。</div>
<div class="line">インストール先のディレクトリは/tmp/pkg-repo 、/tmp/pip_whl とします。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id83">
<div class="code-block-caption"><span class="caption-number">リスト 227 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id83" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/tmp/kubespray

dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>--downloadonly<span class="w"> </span>--downloaddir<span class="o">=</span>/tmp/pkg-repo<span class="w"> </span>--installroot<span class="o">=</span>/tmp/pkg-installroot<span class="w"> </span>--releasever<span class="o">=</span>x.x<span class="w"> </span>docker-ce<span class="w"> </span>python39<span class="w"> </span>nginx<span class="w"> </span>gcc<span class="w"> </span>httpd<span class="w"> </span>systemd-devel<span class="w"> </span>keepalived

dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>createrepo

createrepo<span class="w"> </span>/tmp/pkg-repo

pip3.9<span class="w"> </span>download<span class="w"> </span>-d<span class="w"> </span>/tmp/pip_whl<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">kubernetes内でインストールするパッケージファイルをダウンロードします。</div>
<div class="line">--releasever=x.xはExastroをインストールするサーバのOSのバージョンを指定します。</div>
<div class="line">インストール先のディレクトリは /tmp/k8s-repoとします。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id84">
<div class="code-block-caption"><span class="caption-number">リスト 228 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id84" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>--downloadonly<span class="w"> </span>--downloaddir<span class="o">=</span>/tmp/k8s-repo<span class="w"> </span>--installroot<span class="o">=</span>/tmp/k8s-installroot<span class="w"> </span>--releasever<span class="o">=</span>x.x<span class="w"> </span>conntrack-tools<span class="w"> </span>libnetfilter_cttimeout<span class="w"> </span>libnetfilter_cthelper<span class="w"> </span>libnetfilter_queue<span class="w"> </span>bash-completion<span class="w"> </span>e2fsprogs<span class="w"> </span>device-mapper-libs<span class="w"> </span>ipset<span class="w"> </span>libseccomp<span class="w"> </span>ipvsadm<span class="w"> </span>nss<span class="w"> </span>openssl<span class="w"> </span>python3-libselinux<span class="w"> </span>rsync<span class="w"> </span>socat<span class="w"> </span>unzip<span class="w"> </span>xfsprogs<span class="w"> </span>gssproxy<span class="w"> </span>libverto-libevent<span class="w"> </span>keyutils<span class="w"> </span>nfs-utils<span class="w"> </span>libev<span class="w"> </span>rpcbind<span class="w"> </span>container-selinux<span class="w"> </span>iproute
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id85">
<div class="code-block-caption"><span class="caption-number">リスト 229 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id85" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>createrepo<span class="w"> </span>/tmp/k8s-repo
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">manage-offline-files.shは「 NGINX_PORT=8080 」 及び ファイル最下部の「 sudo &quot;${runtime}&quot; container inspect nginx &gt;/dev/null 2&gt;&amp;1 」以降の記載を削除します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id86">
<div class="code-block-caption"><span class="caption-number">リスト 230 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id86" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>contrib/offline

cp<span class="w"> </span>manage-offline-files.sh<span class="w"> </span>manage-offline-files.sh.bk

vi<span class="w"> </span>manage-offline-files.sh
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id87">
<div class="code-block-caption"><span class="caption-number">リスト 231 </span><span class="caption-text">manage-offline-files.sh</span><a class="headerlink" href="#id87" title="Link to this code">¶</a></div>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span>#!/bin/bash

CURRENT_DIR=$( dirname &quot;$(readlink -f &quot;$0&quot;)&quot; )
OFFLINE_FILES_DIR_NAME=&quot;offline-files&quot;
OFFLINE_FILES_DIR=&quot;${CURRENT_DIR}/${OFFLINE_FILES_DIR_NAME}&quot;
OFFLINE_FILES_ARCHIVE=&quot;${CURRENT_DIR}/offline-files.tar.gz&quot;
FILES_LIST=${FILES_LIST:-&quot;${CURRENT_DIR}/temp/files.list&quot;}
<span class="gd">- NGINX_PORT=8080</span>

<span class="gd">- sudo &quot;${runtime}&quot; container inspect nginx &gt;/dev/null 2&gt;&amp;1</span>
<span class="gd">- if [ $? -ne 0 ]; then</span>
<span class="gd">-     sudo &quot;${runtime}&quot; run \</span>
<span class="gd">-         --restart=always -d -p ${NGINX_PORT}:80 \</span>
<span class="gd">-         --volume &quot;${OFFLINE_FILES_DIR}:/usr/share/nginx/html/download&quot; \</span>
<span class="gd">-         --volume &quot;${CURRENT_DIR}&quot;/nginx.conf:/etc/nginx/nginx.conf \</span>
<span class="gd">-         --name nginx nginx:alpine</span>
<span class="gd">- fi</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">manage-offline-files.shを実行します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id88">
<div class="code-block-caption"><span class="caption-number">リスト 232 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id88" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>./manage-offline-files.sh

mv<span class="w"> </span>offline-files.tar.gz<span class="w"> </span>/tmp/work
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">取得したファイルはoffline-files.tar.gzとして圧縮されます。</div>
<div class="line">offline-files.tar.gzが存在しない場合は以下のメッセージが表示されますが問題ありません。</div>
<div class="line">rm: cannot remove '/tmp/kubespray/contrib/offline/offline-files.tar.gz': No such file or directory</div>
</div>
</div>
</section>
<section id="exastro">
<h3>⑤Exastroのコンテナイメージを取得<a class="headerlink" href="#exastro" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">コンテナイメージをダウンロードするシェルスクリプトとコンテナイメージのリストを 30GB以上空き容量がある領域に作成します。</div>
<div class="line">これら2つは同じディレクトリに作成する必要があります。</div>
<div class="line">シェルスクリプト内の「[&quot;x.x.x&quot;]=&quot;x.x.x&quot;」にはExastro IT Automation App VersionとExastro Platform App Versionをそれぞれ記載します。</div>
<div class="line"><a class="reference external" href="https://github.com/exastro-suite/exastro-helm?tab=readme-ov-file#component-version">Component version</a> を参照し、最新のバージョンに書き換えてください。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id89">
<div class="code-block-caption"><span class="caption-number">リスト 233 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id89" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/tmp/work

vi<span class="w"> </span>exastro-images.list
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id90">
<div class="code-block-caption"><span class="caption-number">リスト 234 </span><span class="caption-text">下記のコードをコピー＆ペーストします</span><a class="headerlink" href="#id90" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker.io/exastro/exastro-it-automation-api-admin:#__ITA_VERSION__#
docker.io/exastro/exastro-it-automation-api-organization:#__ITA_VERSION__#
docker.io/exastro/exastro-it-automation-api-oase-receiver:#__ITA_VERSION__#
docker.io/exastro/exastro-it-automation-by-ansible-execute:#__ITA_VERSION__#
docker.io/exastro/exastro-it-automation-by-ansible-agent:#__ITA_VERSION__#
docker.io/exastro/exastro-it-automation-by-ansible-legacy-role-vars-listup:#__ITA_VERSION__#
docker.io/exastro/exastro-it-automation-by-ansible-legacy-vars-listup:#__ITA_VERSION__#
docker.io/exastro/exastro-it-automation-by-ansible-pioneer-vars-listup:#__ITA_VERSION__#
docker.io/exastro/exastro-it-automation-by-ansible-towermaster-sync:#__ITA_VERSION__#
docker.io/exastro/exastro-it-automation-by-cicd-for-iac:#__ITA_VERSION__#
docker.io/exastro/exastro-it-automation-by-collector:#__ITA_VERSION__#
docker.io/exastro/exastro-it-automation-by-conductor-regularly:#__ITA_VERSION__#
docker.io/exastro/exastro-it-automation-by-conductor-synchronize:#__ITA_VERSION__#
docker.io/exastro/exastro-it-automation-by-excel-export-import:#__ITA_VERSION__#
docker.io/exastro/exastro-it-automation-by-execinstance-dataautoclean:#__ITA_VERSION__#
docker.io/exastro/exastro-it-automation-by-file-autoclean:#__ITA_VERSION__#
docker.io/exastro/exastro-it-automation-by-hostgroup-split:#__ITA_VERSION__#
docker.io/exastro/exastro-it-automation-by-menu-create:#__ITA_VERSION__#
docker.io/exastro/exastro-it-automation-by-menu-export-import:#__ITA_VERSION__#
docker.io/exastro/exastro-it-automation-by-oase-conclusion:#__ITA_VERSION__#
docker.io/exastro/exastro-it-automation-by-terraform-cli-execute:#__ITA_VERSION__#
docker.io/exastro/exastro-it-automation-by-terraform-cli-vars-listup:#__ITA_VERSION__#
docker.io/exastro/exastro-it-automation-by-terraform-cloud-ep-execute:#__ITA_VERSION__#
docker.io/exastro/exastro-it-automation-by-terraform-cloud-ep-vars-listup:#__ITA_VERSION__#
docker.io/exastro/exastro-it-automation-web-server:#__ITA_VERSION__#
docker.io/exastro/exastro-it-automation-migration:#__ITA_VERSION__#
docker.io/exastro/exastro-platform-api:#__PF_VERSION__#
docker.io/exastro/exastro-platform-auth:#__PF_VERSION__#
docker.io/exastro/exastro-platform-job:#__PF_VERSION__#
docker.io/exastro/exastro-platform-migration:#__PF_VERSION__#
docker.io/exastro/exastro-platform-web:#__PF_VERSION__#
docker.io/exastro/keycloak:#__PF_VERSION__#
docker.io/gitlab/gitlab-ce:15.11.13-ce.0
docker.io/mongo:6.0
docker.io/mongo:6.0.7
docker.io/mariadb:10.9
docker.io/mariadb:10.11
busybox:latest
registry.access.redhat.com/ubi8/ubi-init:latest
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">コンテナイメージを取得するシェルスクリプト作成します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id91">
<div class="code-block-caption"><span class="caption-number">リスト 235 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id91" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>vi<span class="w"> </span>exastro-image-save.sh
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id92">
<div class="code-block-caption"><span class="caption-number">リスト 236 </span><span class="caption-text">下記のコードをコピー＆ペーストし、x.x.xにはバージョンを指定します</span><a class="headerlink" href="#id92" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nv">ITA_VERSION</span><span class="o">=</span><span class="nv">$1</span>
<span class="nb">declare</span><span class="w"> </span>-A<span class="w"> </span><span class="nv">PF_VERSION</span><span class="o">=(</span>
<span class="w">  </span><span class="o">[</span><span class="s2">&quot;x.x.x&quot;</span><span class="o">]=</span><span class="s2">&quot;x.x.x&quot;</span>
<span class="o">)</span>
<span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-d<span class="w"> </span><span class="nv">$1</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">  </span>mkdir<span class="w"> </span><span class="nv">$ITA_VERSION</span>
<span class="k">fi</span>

readarray<span class="w"> </span>-t<span class="w"> </span>image_list<span class="w"> </span>&lt;<span class="w"> </span><span class="s2">&quot;./exastro-images.list&quot;</span>
<span class="k">for</span><span class="w"> </span>image<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="si">${</span><span class="nv">image_list</span><span class="p">[@]</span><span class="si">}</span>
<span class="k">do</span>
<span class="w">  </span><span class="nv">image_fullname</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="si">${</span><span class="nv">image</span><span class="si">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;s/#__ITA_VERSION__#/</span><span class="si">${</span><span class="nv">ITA_VERSION</span><span class="si">}</span><span class="s2">/&quot;</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;s/#__PF_VERSION__#/</span><span class="si">${</span><span class="nv">PF_VERSION</span><span class="p">[</span><span class="nv">$ITA_VERSION</span><span class="p">]</span><span class="si">}</span><span class="s2">/&quot;</span><span class="k">)</span>
<span class="w">  </span><span class="nv">image_name</span><span class="o">=</span><span class="k">$(</span>basename<span class="w"> </span><span class="si">${</span><span class="nv">image_fullname</span><span class="si">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;s/:/-/&quot;</span><span class="k">)</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>!<span class="w"> </span>-e<span class="w"> </span><span class="si">${</span><span class="nv">ITA_VERSION</span><span class="si">}</span>/<span class="si">${</span><span class="nv">image_name</span><span class="si">}</span>.tar.gz<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">echo</span><span class="w"> </span><span class="nv">$image_fullname</span><span class="w"> </span><span class="nv">$image_name</span>
<span class="w">    </span>docker<span class="w"> </span>pull<span class="w"> </span><span class="si">${</span><span class="nv">image_fullname</span><span class="si">}</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="nv">$?</span><span class="w"> </span>-eq<span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">      </span>docker<span class="w"> </span>save<span class="w"> </span><span class="si">${</span><span class="nv">image_fullname</span><span class="si">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>gzip<span class="w"> </span>-c<span class="w"> </span>&gt;<span class="w"> </span><span class="si">${</span><span class="nv">ITA_VERSION</span><span class="si">}</span>/<span class="si">${</span><span class="nv">image_name</span><span class="si">}</span>.tar.gz
<span class="w">    </span><span class="k">fi</span>
<span class="w">  </span><span class="k">fi</span>
<span class="k">done</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">シェルスクリプトを実行し、コンテナイメージを取得します。x.x.x にはITAのバージョンを指定します。</div>
<div class="line">完了するまでに数十分程度の時間がかかります。(通信環境やサーバースペックによって状況は異なります。)</div>
</div>
<div class="literal-block-wrapper docutils container" id="id93">
<div class="code-block-caption"><span class="caption-number">リスト 237 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id93" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>chmod<span class="w"> </span>a+x<span class="w"> </span>exastro-image-save.sh

sh<span class="w"> </span>exastro-image-save.sh<span class="w"> </span>x.x.x
</pre></div>
</div>
</div>
</section>
<section id="id16">
<h3>⑥オフライン環境で使用するシェルスクリプト等を作成<a class="headerlink" href="#id16" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">シェルスクリプトを作成します。</div>
<div class="line">ITA_VERSIONにはExastro IT Automation App Versionを記載します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id94">
<div class="code-block-caption"><span class="caption-number">リスト 238 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id94" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/tmp/work

vi<span class="w"> </span>exastro-image-load.sh
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id95">
<div class="code-block-caption"><span class="caption-number">リスト 239 </span><span class="caption-text">下記のコードをコピー＆ペーストし、x.x.xにはバージョンを指定します</span><a class="headerlink" href="#id95" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="nv">ITA_VERSION</span><span class="o">=</span>x.x.x
<span class="nb">cd</span><span class="w"> </span>/tmp/work/<span class="si">${</span><span class="nv">ITA_VERSION</span><span class="si">}</span>

<span class="k">for</span><span class="w"> </span>file<span class="w"> </span><span class="k">in</span><span class="w"> </span>*.tar.gz<span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span>/usr/local/bin/nerdctl<span class="w"> </span>load<span class="w"> </span>-i<span class="w"> </span><span class="si">${</span><span class="nv">file</span><span class="si">}</span>
<span class="k">done</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">IPaddressはAnsible実行サーバとして使用するサーバのIPアドレスを指定します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id96">
<div class="code-block-caption"><span class="caption-number">リスト 240 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id96" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>vi<span class="w"> </span>k8s-image-push.sh
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id97">
<div class="code-block-caption"><span class="caption-number">リスト 241 </span><span class="caption-text">下記のコードをコピー＆ペーストします</span><a class="headerlink" href="#id97" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nv">IPaddress</span><span class="o">=</span>xx.xx.xx.xx:6000

<span class="nv">image_list</span><span class="o">=</span><span class="k">$(</span>docker<span class="w"> </span>images<span class="w"> </span>--format<span class="w"> </span><span class="s2">&quot;{{.Repository}}:{{.Tag}}&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="si">${</span><span class="nv">IPaddress</span><span class="si">}</span><span class="k">)</span>

<span class="nv">IFS</span><span class="o">=</span><span class="s1">$&#39;\n&#39;</span>

<span class="k">for</span><span class="w"> </span>image<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="si">${</span><span class="nv">image_list</span><span class="si">}</span><span class="p">;</span><span class="w"> </span><span class="k">do</span>
<span class="w">  </span><span class="nv">new_image</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">image</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;s|docker.io/||&quot;</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;s|registry.k8s.io/||&quot;</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;s|quay.io/||&quot;</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;s|ghcr.io/||&quot;</span><span class="k">)</span>
<span class="w">  </span>docker<span class="w"> </span>tag<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">image</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">new_image</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="w">  </span>docker<span class="w"> </span>push<span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">new_image</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">done</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">IPaddressはAnsible実行サーバとして使用するサーバのIPアドレスを指定します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id98">
<div class="code-block-caption"><span class="caption-number">リスト 242 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id98" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>vi<span class="w"> </span>k8s-image-load.sh
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id99">
<div class="code-block-caption"><span class="caption-number">リスト 243 </span><span class="caption-text">下記のコードをコピー＆ペーストします</span><a class="headerlink" href="#id99" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="nv">IPaddress</span><span class="o">=</span>xx.xx.xx.xx:6000

readarray<span class="w"> </span>-t<span class="w"> </span>image_list<span class="w"> </span>&lt;<span class="w"> </span>k8s-images.list
<span class="k">for</span><span class="w"> </span>image<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="si">${</span><span class="nv">image_list</span><span class="p">[@]</span><span class="si">}</span>
<span class="k">do</span>
<span class="w">  </span><span class="nv">image_fullname</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span><span class="w"> </span><span class="si">${</span><span class="nv">image</span><span class="si">}</span><span class="w"> </span><span class="k">)</span>
<span class="w">  </span><span class="nv">image_name</span><span class="o">=</span><span class="k">$(</span>basename<span class="w"> </span><span class="si">${</span><span class="nv">image_fullname</span><span class="si">}</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sed<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;s/:/-/&quot;</span><span class="k">)</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span>-e<span class="w"> </span>k8s-images/<span class="si">${</span><span class="nv">image_name</span><span class="si">}</span>.tar.gz<span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span><span class="k">then</span>
<span class="w">    </span>docker<span class="w"> </span>load<span class="w"> </span>&lt;<span class="w"> </span>k8s-images/<span class="si">${</span><span class="nv">image_name</span><span class="si">}</span>.tar.gz<span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">    </span>docker<span class="w"> </span>tag<span class="w"> </span><span class="si">${</span><span class="nv">image_fullname</span><span class="si">}</span><span class="w"> </span><span class="si">${</span><span class="nv">IPaddress</span><span class="si">}</span>/<span class="si">${</span><span class="nv">image_fullname</span><span class="si">}</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<span class="w">    </span>docker<span class="w"> </span>rmi<span class="w"> </span><span class="si">${</span><span class="nv">image_fullname</span><span class="si">}</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">  </span><span class="k">fi</span>
<span class="k">done</span>

<span class="nb">wait</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">Ansibleの実行先となるサーバを指定します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id100">
<div class="code-block-caption"><span class="caption-number">リスト 244 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id100" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>vi<span class="w"> </span>inventory.yaml
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id101">
<div class="code-block-caption"><span class="caption-number">リスト 245 </span><span class="caption-text">下記のコードをコピー＆ペーストし、ホスト名を書き換えます</span><a class="headerlink" href="#id101" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">[</span>ControlMachine<span class="o">]</span>
Ansible実行サーバのホスト名

<span class="o">[</span>k8s-node1<span class="o">]</span>
Exastroインストールサーバのホスト名

<span class="o">[</span>K8S:children<span class="o">]</span>
k8s-node1
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">パッケージファイルをインストールするyamlファイルを作成します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id102">
<div class="code-block-caption"><span class="caption-number">リスト 246 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id102" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>vi<span class="w"> </span>preparation.yaml
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">以下の内容をコピー＆ペーストします。</div>
</div>
<details>
  <summary>preparation.yaml</summary></details><div class="line-block">
<div class="line">28行目と89行目のexastro-x.x.xx.tgzのバージョンは手順②で取得したバージョンに書き換えます。</div>
<div class="line">また、永続ボリュームの設定ファイルは使用状況に合わせて適宜削除します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id103">
<div class="code-block-caption"><span class="caption-number">リスト 247 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id103" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>vi<span class="w"> </span>install-exastro.yaml
</pre></div>
</div>
</div>
<details>
  <summary>install-exastro.yaml</summary></details><div class="line-block">
<div class="line">永続ボリュームを作成するシェルスクリプトです。</div>
<div class="line">永続ボリュームの設定ファイルは使用状況に合わせて適宜削除します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id104">
<div class="code-block-caption"><span class="caption-number">リスト 248 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id104" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>vi<span class="w"> </span>apply-pv.sh
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id105">
<div class="code-block-caption"><span class="caption-number">リスト 249 </span><span class="caption-text">下記のコードをコピー＆ペーストします</span><a class="headerlink" href="#id105" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
/usr/local/bin/kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>/tmp/work/pv-database.yaml
/usr/local/bin/kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>/tmp/work/pv-ita-common.yaml
/usr/local/bin/kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>/tmp/work/pv-mongo.yaml
/usr/local/bin/kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>/tmp/work/pv-gitlab.yaml
/usr/local/bin/kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>/tmp/work/pv-pf-auditlog.yaml
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">パッケージファイルをインストールするシェルスクリプトを作成します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id106">
<div class="code-block-caption"><span class="caption-number">リスト 250 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id106" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>vi<span class="w"> </span>k8s-pkg-install.sh
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id107">
<div class="code-block-caption"><span class="caption-number">リスト 251 </span><span class="caption-text">下記のコードをコピー＆ペーストします</span><a class="headerlink" href="#id107" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1">#ebtables のインストール</span>
rpm<span class="w"> </span>-ivh<span class="w"> </span>--force<span class="w"> </span>iptables*.rpm<span class="w"> </span>iptables-ebtables*.rpm<span class="w"> </span>iptables-libs*.rpm

<span class="c1"># conntrack-tools のインストール</span>
rpm<span class="w"> </span>-ivh<span class="w"> </span>--force<span class="w"> </span>conntrack-tools*.rpm<span class="w"> </span>libnetfilter_cttimeout*.rpm<span class="w"> </span>libnetfilter_cthelper*.rpm<span class="w"> </span>libnetfilter_queue*.rpm

<span class="c1"># bash-completion のインストール</span>
rpm<span class="w"> </span>-ivh<span class="w"> </span>--force<span class="w"> </span>bash-completion*.rpm<span class="w"> </span>libssh*.rpm<span class="w"> </span>libssh-config*.rpm<span class="w"> </span>openssl*.rpm<span class="w">  </span>openssl-libs*.rpm

<span class="c1"># curl のインストール</span>
rpm<span class="w"> </span>-ivh<span class="w"> </span>--force<span class="w"> </span>curl*.rpm<span class="w"> </span>libcurl*.rpm

<span class="c1"># e2fsprogs のインストール</span>
rpm<span class="w"> </span>-ivh<span class="w"> </span>--force<span class="w"> </span>e2fsprogs*.rpm<span class="w"> </span>e2fsprogs-libs*.rpm<span class="w"> </span>libcom_err*.rpm<span class="w"> </span>libss*.rpm

<span class="c1"># device-mapper-libs のインストール</span>
rpm<span class="w"> </span>-ivh<span class="w"> </span>--force<span class="w"> </span>device-mapper*.rpm<span class="w"> </span>device-mapper-event*.rpm<span class="w"> </span>device-mapper-event-libs*.rpm<span class="w"> </span>device-mapper-libs*.rpm<span class="w"> </span>lvm2*.rpm<span class="w"> </span>lvm2-libs*.rpm<span class="w"> </span>ipset-libs*.rpm

<span class="c1"># ipset のインストール</span>
rpm<span class="w"> </span>-ivh<span class="w"> </span>--force<span class="w"> </span>ipset*.rpm

<span class="c1"># libseccomp のインストール</span>
rpm<span class="w"> </span>-ivh<span class="w"> </span>--force<span class="w"> </span>libseccomp*.rpm

<span class="c1"># ipvsadm のインストール</span>
rpm<span class="w"> </span>-ivh<span class="w"> </span>--force<span class="w"> </span>ipvsadm*.rpm

<span class="c1"># nss のインストール</span>
rpm<span class="w"> </span>-ivh<span class="w">  </span>--force<span class="w"> </span>nspr*.rpm<span class="w"> </span>nss*.rpm<span class="w"> </span>nss-softokn*.rpm<span class="w"> </span>nss-softokn-freebl*.rpm<span class="w"> </span>nss-sysinit*.rpm<span class="w"> </span>nss-tools*.rpm<span class="w"> </span>nss-util*.rpm

<span class="c1"># openssl のインストール</span>
rpm<span class="w"> </span>-ivh<span class="w"> </span>--force<span class="w"> </span>openssl*.rpm

<span class="c1"># python3-libselinux のインストール</span>
rpm<span class="w"> </span>-ivh<span class="w"> </span>--force<span class="w"> </span>libselinux*.rpm<span class="w"> </span>python3-libselinux*.rpm<span class="w"> </span>libselinux-utils*.rpm

<span class="c1"># rsync のインストール</span>
rpm<span class="w"> </span>-ivh<span class="w"> </span>--force<span class="w"> </span>rsync*.rpm

<span class="c1"># socat のインストール</span>
rpm<span class="w"> </span>-ivh<span class="w"> </span>--force<span class="w"> </span>socat*.rpm

<span class="c1"># unzip のインストール</span>
rpm<span class="w"> </span>-ivh<span class="w"> </span>--force<span class="w"> </span>unzip*.rpm

<span class="c1"># xfsprogs のインストール</span>
rpm<span class="w"> </span>-ivh<span class="w"> </span>--force<span class="w"> </span>xfsprogs*.rpm

<span class="c1"># container-selinux のインストール</span>
rpm<span class="w"> </span>-ivh<span class="w"> </span>--force<span class="w"> </span>container-selinux*.rpm<span class="w"> </span>selinux-policy*.rpm<span class="w"> </span>selinux-policy-targeted*.rpm

<span class="c1"># nfs-utils のインストール</span>
rpm<span class="w"> </span>-ivh<span class="w"> </span>--force<span class="w">  </span>nfs-utils*.rpm

<span class="c1">#iproutes のインストール</span>
rpm<span class="w"> </span>-ivh<span class="w"> </span>--force<span class="w">  </span>iproute*.rpm
</pre></div>
</div>
</div>
</section>
<section id="id17">
<h3>資材の転送<a class="headerlink" href="#id17" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">取得した資材を圧縮します。</div>
<div class="line">ExastroのコンテナイメージはITA_VERSIONで指定したバージョンがディレクトリ名になっているため、x.x.xはバージョンを指定します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id108">
<div class="code-block-caption"><span class="caption-number">リスト 252 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id108" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/tmp/work

tar<span class="w"> </span>-zcvf<span class="w"> </span>exastro-image.tar.gz<span class="w"> </span>x.x.x

tar<span class="w"> </span>-zcvf<span class="w"> </span>k8s-images.tar.gz<span class="w"> </span>k8s-images
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">シェルスクリプトとyamlファイルを圧縮します。</div>
<div class="line">永続ボリュームの設定ファイルは作成したファイルのみ指定します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id109">
<div class="code-block-caption"><span class="caption-number">リスト 253 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id109" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>tar<span class="w"> </span>-zcvf<span class="w"> </span>resource.tar.gz<span class="w"> </span>k8s-image-push.sh<span class="w"> </span>k8s-image-load.sh<span class="w"> </span>k8s-images.list<span class="w"> </span>exastro.yaml<span class="w"> </span>inventory.yaml<span class="w"> </span>install-exastro.yaml<span class="w"> </span>preparation.yaml<span class="w"> </span>apply-pv.sh<span class="w"> </span>exastro-image-load.sh<span class="w"> </span>k8s-pkg-install.sh<span class="w"> </span>pv-database.yaml<span class="w"> </span>pv-ita-common.yaml<span class="w"> </span>pv-gitlab.yaml<span class="w"> </span>pv-mongo.yaml<span class="w"> </span>pv-pf-auditlog.yaml
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id110">
<div class="code-block-caption"><span class="caption-number">リスト 254 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id110" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/tmp

tar<span class="w"> </span>-zcvf<span class="w"> </span>k8s-repo.tar.gz<span class="w"> </span>k8s-repo

tar<span class="w"> </span>-zcvf<span class="w"> </span>pkg-repo.tar.gz<span class="w"> </span>pkg-repo

tar<span class="w"> </span>-zcvf<span class="w"> </span>pip-whl.tar.gz<span class="w"> </span>pip_whl

tar<span class="w"> </span>-zcvf<span class="w"> </span>kubespray.tar.gz<span class="w"> </span>kubespray
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">収集した資材をFTP、SCP、SFTP、記憶媒体等でオフライン環境(Ansible実行サーバ)に転送します。</div>
<div class="line">Ansible実行サーバの/tmpに/workディレクトリを作成し、以下の資材を配置します。</div>
</div>
<ul class="simple">
<li><p>exastro-image.tar.gz</p></li>
<li><p>k8s-images.tar.gz</p></li>
<li><p>resource.tar.gz</p></li>
<li><p>exastro-x.x.x.tgz</p></li>
<li><p>offline-files.tar.gz</p></li>
<li><p>k8s-repo.tar.gz</p></li>
</ul>
<div class="line-block">
<div class="line">オフライン環境の/tmpに以下の資材を配置します。</div>
</div>
<ul class="simple">
<li><p>pkg-repo.tar.gz</p></li>
<li><p>pip-whl.tar.gz</p></li>
<li><p>kubespray.tar.gz</p></li>
</ul>
</section>
</section>
<section id="id18">
<h2>オフライン環境(インターネットに接続できない環境)での作業<a class="headerlink" href="#id18" title="Link to this heading">¶</a></h2>
<div class="line-block">
<div class="line">オンライン環境での作業完了後、オフライン環境にて下記の手順を実施します。</div>
<div class="line">以下は、Ansible実行サーバ1台、Exastroインストールサーバ1台で構成した例です。</div>
</div>
<section id="id19">
<h3>⑦資材受け取り<a class="headerlink" href="#id19" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">Ansible実行サーバで、取得した資材を展開します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id111">
<div class="code-block-caption"><span class="caption-number">リスト 255 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id111" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/tmp

tar<span class="w"> </span>xzvf<span class="w"> </span>kubespray.tar.gz

tar<span class="w"> </span>xzvf<span class="w"> </span>pip-whl.tar.gz

tar<span class="w"> </span>xzvf<span class="w"> </span>pkg-repo.tar.gz

<span class="nb">cd</span><span class="w"> </span>/tmp/work

tar<span class="w"> </span>xzvf<span class="w"> </span>offline-files.tar.gz

tar<span class="w"> </span>xzvf<span class="w"> </span>k8s-images.tar.gz

tar<span class="w"> </span>xzvf<span class="w"> </span>/tmp/work/resource.tar.gz<span class="w"> </span>-C<span class="w"> </span>/tmp/work
</pre></div>
</div>
</div>
</section>
<section id="ansible">
<h3>⑧Ansible実行サーバでの準備<a class="headerlink" href="#ansible" title="Link to this heading">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id112">
<div class="code-block-caption"><span class="caption-number">リスト 256 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id112" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/tmp

vi<span class="w"> </span>pkg-install.sh
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id113">
<div class="code-block-caption"><span class="caption-number">リスト 257 </span><span class="caption-text">下記のコードをコピー＆ペーストします</span><a class="headerlink" href="#id113" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>

<span class="c1">#ローカルリポジトリを作成</span>
sudo<span class="w"> </span>tee<span class="w"> </span>/etc/yum.repos.d/pkg-repo.repo<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<span class="s">[pkg-repo]</span>
<span class="s">name=RedHat-\$releaserver - pkg</span>
<span class="s">baseurl=file:///tmp/pkg-repo</span>
<span class="s">enabled=1</span>
<span class="s">gpgcheck=0</span>
<span class="s">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release</span>
<span class="s">EOF</span>

dnf<span class="w"> </span>remove<span class="w"> </span>-y<span class="w"> </span>runc

<span class="c1">#docker-ceのインストール</span>
<span class="nb">cd</span><span class="w"> </span>/tmp/pkg-repo

<span class="nv">docker_ce</span><span class="o">=</span><span class="k">$(</span>ls<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;docker-ce|docker-ce-cli|docker-ce-rootless-extras|docker-compose-plugin|fuse3|fuse3-libs|fuse-common|fuse-overlayfs|libcgroup|libslirp|slirp4netns|container-selinux|perl-IO-Socket-SSL|perl-Mozilla-CA|perl-Net-SSLeay&quot;</span><span class="k">)</span>

dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>--disablerepo<span class="o">=</span><span class="se">\*</span><span class="w"> </span>--enablerepo<span class="o">=</span>pkg-repo<span class="w"> </span><span class="si">${</span><span class="nv">docker_ce</span><span class="si">}</span>

<span class="c1">#pythonのインストール</span>
<span class="nv">python</span><span class="o">=</span><span class="k">$(</span>ls<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;python39&quot;</span><span class="k">)</span>

dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>--disablerepo<span class="o">=</span><span class="se">\*</span><span class="w"> </span>--enablerepo<span class="o">=</span>pkg-repo<span class="w"> </span><span class="si">${</span><span class="nv">python</span><span class="si">}</span>

<span class="c1">#Nginxのインストール</span>
<span class="nv">nginx</span><span class="o">=</span><span class="k">$(</span>ls<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="s2">&quot;nginx&quot;</span><span class="k">)</span>

dnf<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>--disablerepo<span class="o">=</span><span class="se">\*</span><span class="w"> </span>--enablerepo<span class="o">=</span>pkg-repo<span class="w"> </span><span class="si">${</span><span class="nv">nginx</span><span class="si">}</span>

<span class="c1">#ansible関連のインストール</span>
<span class="nb">cd</span><span class="w"> </span>/tmp/pip_whl
pip3.9<span class="w"> </span>install<span class="w"> </span>--no-index<span class="w"> </span>--find-links<span class="o">=</span>./<span class="w"> </span>ansible<span class="w"> </span>cryptography<span class="w"> </span>jinja2<span class="w"> </span>jmespath<span class="w"> </span>MarkupSafe<span class="w"> </span>netaddr<span class="w"> </span>pbr<span class="w"> </span>ruamel.yaml<span class="w"> </span>ruamel.yaml.clib
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">パッケージファイルをインストールします。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id114">
<div class="code-block-caption"><span class="caption-number">リスト 258 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id114" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>chmod<span class="w"> </span>a+x<span class="w"> </span>pkg-install.sh

./pkg-install.sh
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">エラーメッセージが表示された場合は、表示されているmoduleを検索し全てインストールします。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id115">
<div class="code-block-caption"><span class="caption-number">リスト 259 </span><span class="caption-text">メッセージ例</span><a class="headerlink" href="#id115" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>No<span class="w"> </span>available<span class="w"> </span>modular<span class="w"> </span>metadata<span class="w"> </span><span class="k">for</span><span class="w"> </span>modular<span class="w"> </span>package<span class="w"> </span><span class="s1">&#39;perl-Mozilla-CA-20160104-7.module_el8.5.0+2812+ed912d05.noarch&#39;</span>,<span class="w"> </span>it<span class="w"> </span>cannot<span class="w"> </span>be<span class="w"> </span>installed<span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>system
No<span class="w"> </span>available<span class="w"> </span>modular<span class="w"> </span>metadata<span class="w"> </span><span class="k">for</span><span class="w"> </span>modular<span class="w"> </span>package<span class="w"> </span><span class="s1">&#39;perl-Net-SSLeay-1.88-2.module_el8.6.0+2811+fe6c84b0.x86_64&#39;</span>,<span class="w"> </span>it<span class="w"> </span>cannot<span class="w"> </span>be<span class="w"> </span>installed<span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>system
Error:<span class="w"> </span>No<span class="w"> </span>available<span class="w"> </span>modular<span class="w"> </span>metadata<span class="w"> </span><span class="k">for</span><span class="w"> </span>modular<span class="w"> </span>package
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id116">
<div class="code-block-caption"><span class="caption-number">リスト 260 </span><span class="caption-text">表示されたmoduleを確認し、一度に全てインストールします</span><a class="headerlink" href="#id116" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1">#対象がperl-Mozilla-CA 及び perl-Net-SSLeayだった場合</span>
<span class="nb">cd</span><span class="w"> </span>/tmp/pkg-repo
ls<span class="w"> </span>-l<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>-E<span class="w"> </span><span class="s2">&quot;perl-Mozilla-CA|perl-Net-SSLeay&quot;</span>
dnf<span class="w"> </span>-y<span class="w"> </span>--disablerepo<span class="o">=</span><span class="se">\*</span><span class="w"> </span>--enablerepo<span class="o">=</span>pkg-repo<span class="w"> </span>perl-Mozilla-CA-20160104-7.module_el8.5.0+2812+ed912d05.noarch.rmp<span class="w"> </span>perl-Net-SSLeay-1.88-2.module_el8.6.0+2811+fe6c84b0.x86_64.rpm
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">dockerグループにユーザを追加します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id117">
<div class="code-block-caption"><span class="caption-number">リスト 261 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id117" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>docker

cat<span class="w"> </span>/etc/group<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>docker

usermod<span class="w"> </span>-aG<span class="w"> </span>docker<span class="w"> </span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span>

cat<span class="w"> </span>/etc/group<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>docker

reboot
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">ExastroをインストールするサーバのIPアドレスとホスト名をHOSTSに登録します。</div>
<div class="line">※本説明では、1台のKubernetesクラスターを構築する例となっております。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id118">
<div class="code-block-caption"><span class="caption-number">リスト 262 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id118" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>vi<span class="w"> </span>/etc/hosts
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id119">
<div class="code-block-caption"><span class="caption-number">リスト 263 </span><span class="caption-text">hosts</span><a class="headerlink" href="#id119" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>xx.xx.xx.xx<span class="w"> </span>xxx.cluster.local<span class="w"> </span>xxx

<span class="c1">#サーバのIPアドレス：xx.xx.xx.xx</span>
<span class="c1">#サーバホスト名：xxx.cluster.local xxx</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">SSH Keyの作成を作成します。</div>
<div class="line">.sshディレクトリにid_rsa.pubが存在する場合は再度作成する必要はありません。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id120">
<div class="code-block-caption"><span class="caption-number">リスト 264 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id120" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>ls<span class="w"> </span>-al

<span class="c1">#.sshディレクトリが存在する場合は作成不要</span>
mkdir<span class="w"> </span>.ssh

<span class="nb">cd</span><span class="w"> </span>.ssh

<span class="c1">#指定がない場合は全てEnterを押す</span>
ssh-keygen<span class="w"> </span>-t<span class="w"> </span>rsa
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">実行しているサーバー自身 及び HOSTSに登録したサーバに対して鍵交換を実施します。</div>
<div class="line">実行後はssh接続ができることを確認します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id121">
<div class="code-block-caption"><span class="caption-number">リスト 265 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id121" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>ssh-copy-id<span class="w"> </span>-i<span class="w"> </span>~/.ssh/id_rsa.pub<span class="w"> </span>root@HOSTSに登録したサーバのホスト名

ssh-copy-id<span class="w"> </span>-i<span class="w"> </span>~/.ssh/id_rsa.pub<span class="w"> </span>root@実行しているサーバのホスト名

ssh<span class="w"> </span>root@HOSTSに登録したサーバのホスト名

<span class="nb">exit</span>
</pre></div>
</div>
</div>
</section>
<section id="id20">
<h3>⑨Exastroインストールサーバでの準備<a class="headerlink" href="#id20" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">Exastroをインストールするサーバすべてで以下の手順を実施します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id122">
<div class="code-block-caption"><span class="caption-number">リスト 266 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id122" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>vi<span class="w"> </span>/etc/sysctl.conf
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">/etc/sysctl.confに以下の1行を追記します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id123">
<div class="code-block-caption"><span class="caption-number">リスト 267 </span><span class="caption-text">追記する1行</span><a class="headerlink" href="#id123" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>net.ipv4.ip_forward<span class="o">=</span><span class="m">1</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="etc-sysctl-conf">
<div class="code-block-caption"><span class="caption-number">リスト 268 </span><span class="caption-text">sysctl.conf</span><a class="headerlink" href="#etc-sysctl-conf" title="Link to this code">¶</a></div>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span># sysctl settings are defined through files in
# /usr/lib/sysctl.d/, /run/sysctl.d/, and /etc/sysctl.d/.
#
# Vendors settings live in /usr/lib/sysctl.d/.
# To override a whole file, create a new file with the same in
# /etc/sysctl.d/ and put new settings there. To override
# only specific settings, add a file with a lexically later
# name in /etc/sysctl.d/ and put new settings there.
#
# For more information, see sysctl.conf(5) and sysctl.d(5).
<span class="gi">+net.ipv4.ip_forward=1</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">ファイアーウォールを無効化します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id124">
<div class="code-block-caption"><span class="caption-number">リスト 269 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id124" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>systemctl<span class="w"> </span>disable<span class="w"> </span>firewalld

systemctl<span class="w"> </span>stop<span class="w"> </span>firewalld

systemctl<span class="w"> </span>status<span class="w"> </span>firewalld
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">SELinuxを無効化します。Disabled となっている場合は実施不要です。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id125">
<div class="code-block-caption"><span class="caption-number">リスト 270 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id125" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>getenforce
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id126">
<div class="code-block-caption"><span class="caption-number">リスト 271 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id126" title="Link to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>vi<span class="w"> </span>/etc/selinux/config
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id127">
<div class="code-block-caption"><span class="caption-number">リスト 272 </span><span class="caption-text">config</span><a class="headerlink" href="#id127" title="Link to this code">¶</a></div>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span># This file controls the state of SELinux on the system.
# SELINUX= can take one of these three values:
#       enforcing - SELinux security policy is enforced.
#       permissive - SELinux prints warnings instead of enforcing.
#       disabled - No SELinux policy is loaded.
<span class="gi">+SELINUX=disabled</span>
# SELINUXTYPE= can take one of these two values:
#       targeted - Targeted processes are protected,
#       mls - Multi Level Security protection.
SELINUXTYPE=targeted
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">/etc/selinux/config更新後、システムを再起動します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id128">
<div class="code-block-caption"><span class="caption-number">リスト 273 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id128" title="Link to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>reboot
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">Disabled となっていることを確認します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id129">
<div class="code-block-caption"><span class="caption-number">リスト 274 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id129" title="Link to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>getenforce
</pre></div>
</div>
</div>
</section>
<section id="id21">
<h3>⑩kubernetesのコンテナイメージの設定<a class="headerlink" href="#id21" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">Ansible実行サーバとして使用するサーバでdockerの例外レジストリを定義します。</div>
<div class="line">/etc/dockerディレクトリにdaemon.jsonが存在しない場合は新しく作成します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id130">
<div class="code-block-caption"><span class="caption-number">リスト 275 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id130" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>vi<span class="w">  </span>/etc/docker/daemon.json
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">以下の1行を追記します。xx.xx.xx.xxには現在作業しているサーバ(Ansible実行サーバ)のIPアドレスを指定します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id131">
<div class="code-block-caption"><span class="caption-number">リスト 276 </span><span class="caption-text">daemon.json</span><a class="headerlink" href="#id131" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">{</span><span class="w"> </span><span class="s2">&quot;insecure-registries&quot;</span>:<span class="o">[</span><span class="w"> </span><span class="s2">&quot;xx.xx.xx.xx:6000&quot;</span><span class="w"> </span><span class="o">]</span><span class="w"> </span><span class="o">}</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">設定ファイルの再読み込みとdockerの再起動を行います。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id132">
<div class="code-block-caption"><span class="caption-number">リスト 277 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id132" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>systemctl<span class="w"> </span>daemon-reload

systemctl<span class="w"> </span>start<span class="w"> </span>docker
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">シェルスクリプトを実行し、kubernetesのコンテナイメージを読み込みます。</div>
<div class="line">完了するまでに数十分程度の時間がかかります。(通信環境やサーバースペックによって状況は異なります。)</div>
</div>
<div class="literal-block-wrapper docutils container" id="id133">
<div class="code-block-caption"><span class="caption-number">リスト 278 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id133" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/tmp/work

ls<span class="w"> </span>k8s-image-load.sh

chmod<span class="w"> </span>a+x<span class="w"> </span>k8s-image-load.sh

./k8s-image-load.sh
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">docker registryを起動します。</div>
<div class="line">xx.xx.xx.xxには現在作業しているサーバ(Ansible実行サーバ)のIPアドレスを指定します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id134">
<div class="code-block-caption"><span class="caption-number">リスト 279 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id134" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>images<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>docker.io/library/registry

<span class="c1">#上記で得られたREPOSITORYとTAGを指定します</span>
docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">6000</span>:5000<span class="w"> </span>--restart<span class="o">=</span>always<span class="w"> </span>--name<span class="w"> </span>registry<span class="w"> </span>REPOSITORY:TAG

<span class="c1">#以下は記載例です</span>
docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">6000</span>:5000<span class="w"> </span>--restart<span class="o">=</span>always<span class="w"> </span>--name<span class="w"> </span>registry<span class="w"> </span>xx.xx.xx.xx:6000/docker.io/library/registry:2.8.1

<span class="c1">#docker registryが起動していることを確認します</span>
docker<span class="w"> </span>ps
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">docker registryにkubernetesのイメージをpushします。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id135">
<div class="code-block-caption"><span class="caption-number">リスト 280 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id135" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>ls<span class="w"> </span>k8s-image-push.sh

chmod<span class="w"> </span>a+x<span class="w"> </span>k8s-image-push.sh

./k8s-image-push.sh
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">http: server gave HTTP response to HTTPS clientと表示されpushできない場合はsystemctl daemon-reloadを行います</div>
</div>
</div>
</section>
<section id="nginx">
<h3>⑪自己署名証明書及びNginxの設定<a class="headerlink" href="#nginx" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">自己署名証明書用のディレクトリを作成します。</div>
<div class="line">以下の手順をAnsible実行サーバで実施します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id136">
<div class="code-block-caption"><span class="caption-number">リスト 281 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id136" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>/etc/nginx/ssl
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">暗号鍵を作成します</div>
</div>
<div class="literal-block-wrapper docutils container" id="id137">
<div class="code-block-caption"><span class="caption-number">リスト 282 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id137" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>openssl<span class="w"> </span>genrsa<span class="w"> </span>-out<span class="w"> </span>/etc/nginx/ssl/server.key<span class="w"> </span><span class="m">2048</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">自己署名証明書リクエストを作成します。</div>
<div class="line">Country NameはJP、State or Province NameはTokyo、それ以外はEnterキーを押します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id138">
<div class="code-block-caption"><span class="caption-number">リスト 283 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id138" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>openssl<span class="w"> </span>req<span class="w"> </span>-new<span class="w"> </span>-key<span class="w"> </span>/etc/nginx/ssl/server.key<span class="w"> </span>-out<span class="w"> </span>/etc/nginx/ssl/server.csr
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">自己署名証明書を作成します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id139">
<div class="code-block-caption"><span class="caption-number">リスト 284 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id139" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>openssl<span class="w"> </span>x509<span class="w"> </span>-days<span class="w"> </span><span class="m">3650</span><span class="w"> </span>-req<span class="w"> </span>-signkey<span class="w"> </span>/etc/nginx/ssl/server.key<span class="w"> </span>-in<span class="w"> </span>/etc/nginx/ssl/server.csr<span class="w"> </span>-out<span class="w"> </span>/etc/nginx/ssl/server.crt
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">自己署名証明書(server.key server.csr server.srt )が作成されていることを確認します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id140">
<div class="code-block-caption"><span class="caption-number">リスト 285 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id140" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>ls<span class="w"> </span>/etc/nginx/ssl
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">Nginxの設定をします。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id141">
<div class="code-block-caption"><span class="caption-number">リスト 286 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id141" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cp<span class="w"> </span>/etc/nginx/nginx.conf<span class="w"> </span>/etc/nginx/nginx.conf.bk

vi<span class="w"> </span>/etc/nginx/nginx.conf
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">バックアップを取得した後、nginx.confに以下のブロックを追記します。</div>
<div class="line">xx.xx.xx.xxには現在作業しているサーバ(Ansible実行サーバ)のIPアドレスを指定します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id142">
<div class="code-block-caption"><span class="caption-number">リスト 287 </span><span class="caption-text">nginx.conf</span><a class="headerlink" href="#id142" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>server<span class="w"> </span><span class="o">{</span>
<span class="w">    </span>listen<span class="w">       </span><span class="m">81</span><span class="w"> </span>ssl<span class="w"> </span><span class="p">;</span>
<span class="w">    </span>ssl_certificate<span class="w"> </span><span class="s2">&quot;/etc/nginx/ssl/server.crt&quot;</span><span class="p">;</span>
<span class="w">    </span>ssl_certificate_key<span class="w"> </span><span class="s2">&quot;/etc/nginx/ssl/server.key&quot;</span><span class="p">;</span>
<span class="w">    </span>charset<span class="w"> </span>UTF-8<span class="p">;</span>
<span class="w">    </span>proxy_set_header<span class="w"> </span>X-Forwarded-Proto<span class="w"> </span><span class="nv">$http_x_forwarded_proto</span><span class="p">;</span>
<span class="w">    </span>proxy_set_header<span class="w"> </span>X-Forwarded-For<span class="w"> </span><span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
<span class="w">    </span>location<span class="w"> </span>/<span class="o">{</span>
<span class="w">    </span>client_max_body_size<span class="w"> </span>256M<span class="p">;</span>
<span class="w">    </span>proxy_set_header<span class="w"> </span>Host<span class="w"> </span><span class="nv">$host</span><span class="p">;</span>
<span class="w">    </span>proxy_pass<span class="w"> </span>http://xx.xx.xx.xx:6000/<span class="p">;</span>
<span class="w">    </span>proxy_redirect<span class="w"> </span>off<span class="p">;</span>
<span class="w">    </span><span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id143">
<div class="code-block-caption"><span class="caption-number">リスト 288 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id143" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>systemctl<span class="w"> </span>stop<span class="w"> </span>firewalld

systemctl<span class="w"> </span>start<span class="w"> </span>nginx
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">ブラウザでコンテナイメージが表示されることを確認します(イメージ名にはIPアドレスやタグは表示されません)。</div>
<div class="line">xx.xx.xx.xxには現在作業しているサーバ(Ansible実行サーバ)のIPアドレスを指定します。</div>
<div class="line">接続がプライベートではありませんと表示されるため、詳細設定をクリックして先に進みます。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id144">
<div class="code-block-caption"><span class="caption-number">リスト 289 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id144" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>https://xx.xx.xx.xx:81/v2/_catalog
</pre></div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<div class="line-block">
<div class="line">レジストリコンテナに登録したイメージを確認するには、ファイアウォールを無効にし、Nginxサービスを起動する必要あります。</div>
</div>
</div>
<div class="line-block">
<div class="line">Exastroをインストールするサーバに対して自己署名証明書を送信します。</div>
<div class="line">xx.xx.xx.xxにはExastroをインストールするサーバのIPアドレスを指定します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id145">
<div class="code-block-caption"><span class="caption-number">リスト 290 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id145" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>scp<span class="w"> </span>/etc/nginx/ssl/server.crt<span class="w"> </span>root@xx.xx.xx.xx:/usr/share/pki/ca-trust-source/anchors
</pre></div>
</div>
</div>
</section>
<section id="id22">
<h3>⑫パッケージのインストール<a class="headerlink" href="#id22" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">Ansibleを実行してパッケージファイルをインストールするため、hosts.ymlを以下の手順で作成します。</div>
<div class="line">以下の手順をAnsible実行サーバで実施します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id146">
<div class="code-block-caption"><span class="caption-number">リスト 291 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id146" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/tmp/kubespray
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">サンプルのinventoryファイルをコピーします。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id147">
<div class="code-block-caption"><span class="caption-number">リスト 292 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id147" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cp<span class="w"> </span>-rfp<span class="w"> </span>inventory/sample<span class="w"> </span>inventory/k8s_cluster
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">Kubernetesクラスター環境のIPの変数を設定します。</div>
<div class="line">xx.xx.xx.xxにはExastroをインストールするサーバのIPアドレスを指定します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id148">
<div class="code-block-caption"><span class="caption-number">リスト 293 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id148" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">declare</span><span class="w"> </span>-a<span class="w"> </span><span class="nv">IPS</span><span class="o">=(</span>xx.xx.xx.xx<span class="o">)</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">hosts.ymlを作成します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id149">
<div class="code-block-caption"><span class="caption-number">リスト 294 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id149" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nv">CONFIG_FILE</span><span class="o">=</span>inventory/k8s_cluster/hosts.yml<span class="w"> </span>python3.9<span class="w"> </span>contrib/inventory_builder/inventory.py<span class="w"> </span><span class="si">${</span><span class="nv">IPS</span><span class="p">[@]</span><span class="si">}</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">作成された <code class="file docutils literal notranslate"><span class="pre">hosts.yml</span></code> のnode1を構成したいKubernetesクラスターのホスト名に書き換えます。</div>
<div class="line">以下の記載例はKubernetesクラスターを1台で構成した例です。</div>
<div class="line">本説明では、各Kubernetesクラスターがコントロールプレーン、ワーカーノードを兼ねた設定で作成するため、全てのnode1に同じホスト名を指定します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id150">
<div class="code-block-caption"><span class="caption-number">リスト 295 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id150" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/tmp/kubespray/inventory/k8s_cluster

vi<span class="w"> </span>hosts.yml
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id151">
<div class="code-block-caption"><span class="caption-number">リスト 296 </span><span class="caption-text">hosts.yml</span><a class="headerlink" href="#id151" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>all:
<span class="w">  </span>hosts:
<span class="w">    </span>node1:
<span class="w">      </span>ansible_host:<span class="w"> </span>xx.xx.xx.xx
<span class="w">      </span>ip:<span class="w"> </span>xx.xx.xx.xx
<span class="w">      </span>access_ip:<span class="w"> </span>xx.xx.xx.xx
<span class="w">  </span>children:
<span class="w">    </span>kube_control_plane:
<span class="w">      </span>hosts:
<span class="w">        </span>node1:
<span class="w">    </span>kube_node:
<span class="w">      </span>hosts:
<span class="w">        </span>node1:
<span class="w">    </span>etcd:
<span class="w">      </span>hosts:
<span class="w">        </span>node1:
<span class="w">    </span>k8s_cluster:
<span class="w">      </span>children:
<span class="w">        </span>kube_control_plane:
<span class="w">        </span>kube_node:
<span class="w">    </span>calico_rr:
<span class="w">      </span>hosts:<span class="w"> </span><span class="o">{}</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">Exastroをインストールするサーバにパッケージファイルをインストールします。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id152">
<div class="code-block-caption"><span class="caption-number">リスト 297 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id152" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/tmp/work

ls<span class="w"> </span>inventory.yaml

ls<span class="w"> </span>preparation.yaml

ansible-playbook<span class="w"> </span>-i<span class="w"> </span>inventory.yaml<span class="w"> </span>preparation.yaml<span class="w"> </span>-become<span class="w"> </span>--become-user<span class="o">=</span>root<span class="w">  </span>--private-key<span class="o">=</span>~/.ssh/id_rsa
</pre></div>
</div>
</div>
</section>
<section id="kubespray">
<h3>⑬kubesprayのインストール<a class="headerlink" href="#kubespray" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">kubenetesクラスタの構築で使用するファイルはNginxコンテナを介して提供します。</div>
<div class="line">/tmp/workに展開するoffline-filesとnginxコンテナの/usr/share/nginx/html/downloadをマウントします。</div>
<div class="line">以下の手順をAnsible実行サーバで実施します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id153">
<div class="code-block-caption"><span class="caption-number">リスト 298 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id153" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>systemctl<span class="w"> </span>restart<span class="w"> </span>docker

docker<span class="w"> </span>images<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>docker.io/library/nginx

<span class="c1">#上記で得られたREPOSITORYとTAGを指定します</span>
docker<span class="w"> </span>run<span class="w"> </span>--name<span class="w"> </span>exastro-nginx<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">8080</span>:80<span class="w"> </span>-v<span class="w"> </span>/tmp/work/offline-files:/usr/share/nginx/html/download<span class="w"> </span>REPOSITORY:TAG

<span class="c1">#以下は記載例です</span>
docker<span class="w"> </span>run<span class="w"> </span>--name<span class="w"> </span>exastro-nginx<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">8080</span>:80<span class="w"> </span>-v<span class="w"> </span>/tmp/work/offline-files:/usr/share/nginx/html/download<span class="w"> </span>xx.xx.xx.xx:6000/docker.io/library/nginx:1.25.2-alpine

<span class="c1">#Nginxコンテナが起動していることを確認します</span>
docker<span class="w"> </span>ps
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">ExastroをインストールするサーバにKubernetesをインストールするための設定ファイルを編集します。</div>
<div class="line">all.ymlとoffline.ymlを以下のように書き換えます。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id154">
<div class="code-block-caption"><span class="caption-number">リスト 299 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id154" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/tmp/kubespray/inventory/k8s_cluster/group_vars/all

cp<span class="w"> </span>all.yml<span class="w"> </span>all.yml.bk

vi<span class="w"> </span>all.yml
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id155">
<div class="code-block-caption"><span class="caption-number">リスト 300 </span><span class="caption-text">all.yml</span><a class="headerlink" href="#id155" title="Link to this code">¶</a></div>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span>## Set these proxy values in order to update package manager and docker daemon to use proxies and custom CA for https_proxy if needed
# http_proxy: &quot;&quot;
# https_proxy: &quot;&quot;

<span class="gd">- # https_proxy_cert_file: &quot;&quot;</span>
<span class="gi">+ https_proxy_cert_file: &quot;/usr/share/pki/ca-trust-source/anchors/server.crt&quot;</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">xx.xx.xx.xxには現在作業しているサーバ(Ansible実行サーバ)のIPアドレスを指定します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id156">
<div class="code-block-caption"><span class="caption-number">リスト 301 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id156" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>cp<span class="w"> </span>offline.yml<span class="w"> </span>offline.yml.bk

vi<span class="w"> </span>offline.yml
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id157">
<div class="code-block-caption"><span class="caption-number">リスト 302 </span><span class="caption-text">追記する行</span><a class="headerlink" href="#id157" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>containerd_registries_mirrors:
<span class="w">  </span>-<span class="w"> </span>prefix:<span class="w"> </span><span class="s2">&quot;{{ registry_host }}&quot;</span>
<span class="w">    </span>mirrors:
<span class="w">      </span>-<span class="w"> </span>host:<span class="w"> </span><span class="s2">&quot;{{ registry_host }}&quot;</span>
<span class="w">        </span>capabilities:<span class="w"> </span><span class="o">[</span><span class="s2">&quot;pull&quot;</span>,<span class="w"> </span><span class="s2">&quot;resolve&quot;</span><span class="o">]</span>
<span class="w">        </span>skip_verify:<span class="w"> </span><span class="nb">true</span>
</pre></div>
</div>
</div>
<details>
  <summary>offline.yml</summary></details><div class="line-block">
<div class="line">Kubesparayを実行して、ExastroをインストールするサーバへKubernetesをインストールします。</div>
<div class="line">完了するまでに数十分程度の時間がかかります。(通信環境やサーバースペックによって状況は異なります。)</div>
</div>
<div class="literal-block-wrapper docutils container" id="id158">
<div class="code-block-caption"><span class="caption-number">リスト 303 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id158" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/tmp/kubespray

ansible-playbook<span class="w"> </span>-i<span class="w"> </span>inventory/k8s_cluster/hosts.yml<span class="w"> </span>--become<span class="w"> </span>--become-user<span class="o">=</span>root<span class="w"> </span>cluster.yml<span class="w"> </span>--private-key<span class="o">=</span>~/.ssh/id_rsa<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;download_retries=10&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>~/kubespray_<span class="k">$(</span>date<span class="w"> </span>+%Y%m%d%H%M<span class="k">)</span>.log
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">Exastroをインストールするサーバに接続し、nodeが作成されていることを確認します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id159">
<div class="code-block-caption"><span class="caption-number">リスト 304 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id159" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>kubectl<span class="w"> </span>get<span class="w"> </span>nodes
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id160">
<div class="code-block-caption"><span class="caption-number">リスト 305 </span><span class="caption-text">結果サンプル</span><a class="headerlink" href="#id160" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>NAME<span class="w">                                    </span>STATUS<span class="w">   </span>ROLES<span class="w">           </span>AGE<span class="w">     </span>VERSION
ITAをインストールするサーバのホスト名<span class="w">   </span>Ready<span class="w">    </span>control-plane<span class="w">   </span>5m10s<span class="w">   </span>v1.27.10
</pre></div>
</div>
</div>
</section>
<section id="id23">
<h3>⑭Exastroのインストール<a class="headerlink" href="#id23" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">ExastroをインストールするサーバにExastroのコンテナイメージを転送します。</div>
<div class="line">xx.xx.xx.xxにはExastroをインストールするサーバ(Kubernetesクラスター環境)のIPアドレスを指定します。</div>
<div class="line">完了するまでに数十分程度の時間がかかります。(通信環境やサーバースペックによって状況は異なります。)</div>
<div class="line">以下の手順をAnsible実行サーバで実行します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id161">
<div class="code-block-caption"><span class="caption-number">リスト 306 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id161" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/tmp/work

ls<span class="w"> </span>exastro-image.tar.gz

scp<span class="w"> </span>/tmp/work/exastro-image.tar.gz<span class="w"> </span>root@xx.xx.xx.xx:/tmp/work
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">Exastroのインストールを実行します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id162">
<div class="code-block-caption"><span class="caption-number">リスト 307 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id162" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>ls<span class="w"> </span>inventory.yaml

ls<span class="w"> </span>install-exastro.yaml

ansible-playbook<span class="w"> </span>-i<span class="w"> </span>inventory.yaml<span class="w"> </span>install-exastro.yaml<span class="w"> </span>-become<span class="w"> </span>--become-user<span class="o">=</span>root<span class="w">  </span>--private-key<span class="o">=</span>~/.ssh/id_rsa
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">Exastroをインストールするサーバに接続し、永続ボリュームとpodが作成されていることを確認します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id163">
<div class="code-block-caption"><span class="caption-number">リスト 308 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id163" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>kubectl<span class="w"> </span>get<span class="w"> </span>pv
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id164">
<div class="code-block-caption"><span class="caption-number">リスト 309 </span><span class="caption-text">結果サンプル</span><a class="headerlink" href="#id164" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>NAME<span class="w">            </span>CAPACITY<span class="w">   </span>ACCESS<span class="w"> </span>MODES<span class="w">   </span>RECLAIM<span class="w"> </span>POLICY<span class="w">   </span>STATUS<span class="w">      </span>CLAIM<span class="w">                                  </span>STORAGECLASS<span class="w">   </span>REASON<span class="w">   </span>AGE
pv-auditlog<span class="w">     </span>10Gi<span class="w">       </span>RWX<span class="w">            </span>Retain<span class="w">           </span>Bound<span class="w">       </span>exastro/pvc-pf-auditlog<span class="w">                                        </span>8m10s
pv-database<span class="w">     </span>20Gi<span class="w">       </span>RWO<span class="w">            </span>Retain<span class="w">           </span>Bound<span class="w">       </span>exastro/pvc-mariadb<span class="w">                                            </span>8m10s
pv-gitlab<span class="w">       </span>20Gi<span class="w">       </span>RWX<span class="w">            </span>Retain<span class="w">           </span>Available<span class="w">   </span>exastro/pvc-gitlab<span class="w">                                             </span>8m10s
pv-ita-common<span class="w">   </span>10Gi<span class="w">       </span>RWX<span class="w">            </span>Retain<span class="w">           </span>Bound<span class="w">       </span>exastro/pvc-ita-global<span class="w">                                         </span>8m10s
pv-mongo<span class="w">        </span>20Gi<span class="w">       </span>RWO<span class="w">            </span>Retain<span class="w">           </span>Bound<span class="w">       </span>exastro/volume-mongo-storage-mongo-0<span class="w">                           </span>8m10s
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">コマンドラインから以下のコマンドを入力して、インストール（サービス起動）が完了していることを確認します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id165">
<div class="code-block-caption"><span class="caption-number">リスト 310 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id165" title="Link to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pod の一覧を取得</span>
kubectl<span class="w"> </span>get<span class="w"> </span>po<span class="w"> </span>--namespace<span class="w"> </span>exastro
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">正常に起動している場合は、<kbd class="kbd docutils literal notranslate">ita</kbd>-<kbd class="kbd docutils literal notranslate">migration</kbd>-<kbd class="kbd docutils literal notranslate">xxx</kbd> と <kbd class="kbd docutils literal notranslate">platform</kbd>-<kbd class="kbd docutils literal notranslate">migration</kbd>-<kbd class="kbd docutils literal notranslate">xxx</kbd> が <kbd class="kbd docutils literal notranslate">Completed</kbd> 、その他すべてが <kbd class="kbd docutils literal notranslate">Running</kbd> となります。</div>
<div class="line">※正常に起動するまで数分かかる場合があります。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id166">
<div class="code-block-caption"><span class="caption-number">リスト 311 </span><span class="caption-text">出力結果</span><a class="headerlink" href="#id166" title="Link to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>NAME<span class="w">                                                      </span>READY<span class="w">   </span>STATUS<span class="w">      </span>RESTARTS<span class="w">   </span>AGE
ita-api-admin-6b8567596d-rgjms<span class="w">                            </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>7h40m
ita-api-oase-receiver-6b74bdff6-zmcrw<span class="w">                     </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>7h40m
ita-api-organization-559d7d8f89-ptphh<span class="w">                     </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>7h40m
ita-by-ansible-execute-5dc444c999-w6gmr<span class="w">                   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>7h40m
ita-by-ansible-legacy-role-vars-listup-6d8f98895f-bvjgn<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>7h40m
ita-by-ansible-legacy-vars-listup-6ccd997cf-hvkzq<span class="w">         </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>7h40m
ita-by-ansible-pioneer-vars-listup-6cfcfd4479-8bqst<span class="w">       </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>7h40m
ita-by-ansible-towermaster-sync-6759486f8f-wrbbp<span class="w">          </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>7h40m
ita-by-cicd-for-iac-7b75cc56f5-rrrvg<span class="w">                      </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>7h40m
ita-by-collector-7748d54f59-8j5r2<span class="w">                         </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>7h40m
ita-by-conductor-regularly-779ff79775-xnt29<span class="w">               </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>7h40m
ita-by-conductor-synchronize-5d5485479-5df54<span class="w">              </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>7h40m
ita-by-excel-export-import-6f84f97dcf-hlm4h<span class="w">               </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>7h40m
ita-by-hostgroup-split-59b698f479-cxggd<span class="w">                   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>7h40m
ita-by-menu-create-796bdc9c75-l79zq<span class="w">                       </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>7h40m
ita-by-menu-export-import-849d796bb5-5mpw2<span class="w">                </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>7h40m
ita-by-oase-conclusion-b484595d7-kssv4<span class="w">                    </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>7h40m
ita-by-terraform-cli-execute-769d874d7-sknn6<span class="w">              </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>7h40m
ita-by-terraform-cli-vars-listup-7f589cdddc-g5xz6<span class="w">         </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>7h40m
ita-by-terraform-cloud-ep-execute-7f8b6d87cc-kfmfv<span class="w">        </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>7h40m
ita-by-terraform-cloud-ep-vars-listup-6cccbd4899-6frcn<span class="w">    </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>7h40m
ita-migration-1-3-6-lydz<span class="w">                                  </span><span class="m">0</span>/1<span class="w">     </span>Completed<span class="w">   </span><span class="m">0</span><span class="w">          </span>7h40m
ita-web-server-b4cd4cdf8-wkx78<span class="w">                            </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>7h40m
keycloak-0<span class="w">                                                </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>7h40m
mariadb-778786f7d-ss4cq<span class="w">                                   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>7h40m
mongo-0<span class="w">                                                   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>7h40m
platform-api-ffb78f578-svd5t<span class="w">                              </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>7h40m
platform-auth-75895d784-9hhxw<span class="w">                             </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>7h40m
platform-job-864c47d4f-8vvvq<span class="w">                              </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>7h40m
platform-migration-1-8-0-rjwr<span class="w">                             </span><span class="m">0</span>/1<span class="w">     </span>Completed<span class="w">   </span><span class="m">0</span><span class="w">          </span>7h40m
platform-web-6644884657-dmwp6<span class="w">                             </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">     </span><span class="m">0</span><span class="w">          </span>7h40m
</pre></div>
</div>
</div>
</section>
<section id="id24">
<h3>⑮Exastroインストール後の設定<a class="headerlink" href="#id24" title="Link to this heading">¶</a></h3>
<div class="line-block">
<div class="line">Exastroをインストールしたサーバにて、暗号化キーのバックアップを取得します。</div>
</div>
<div class="line-block">
<div class="line">Exastro システムのパスワードや認証情報といった機密情報はすべて暗号化されています。</div>
<div class="line">必ず、下記で取得した暗号化キーをバックアップして、適切に保管してください。</div>
</div>
<div class="admonition danger">
<p class="admonition-title">危険</p>
<div class="line-block">
<div class="line">暗号化キーを紛失した場合、バックアップデータからシステムを復旧した際にデータの復号ができなくなります。</div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id167">
<div class="code-block-caption"><span class="caption-number">リスト 312 </span><span class="caption-text">コマンド（Exastro IT Automation ENCRYPT_KEY）</span><a class="headerlink" href="#id167" title="Link to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>kubectl<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>ita-secret-ita-global<span class="w"> </span>--namespace<span class="w"> </span>exastro<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.ENCRYPT_KEY}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id168">
<div class="code-block-caption"><span class="caption-number">リスト 313 </span><span class="caption-text">出力結果</span><a class="headerlink" href="#id168" title="Link to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">JnIoXzJtPic2MXFqRl1yI1chMj8hWzQrNypmVn41Pk8</span><span class="o">=</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id169">
<div class="code-block-caption"><span class="caption-number">リスト 314 </span><span class="caption-text">コマンド（Exastro Platform ENCRYPT_KEY）</span><a class="headerlink" href="#id169" title="Link to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>kubectl<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>platform-secret-pf-global<span class="w"> </span>--namespace<span class="w"> </span>exastro<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.ENCRYPT_KEY}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id170">
<div class="code-block-caption"><span class="caption-number">リスト 315 </span><span class="caption-text">出力結果</span><a class="headerlink" href="#id170" title="Link to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">bHFZe2VEVVM2PmFeQDMqNG4oZT4lTlglLjJJekxBTHE</span><span class="o">=</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">下記5つのコマンドを順に実行します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id171">
<div class="code-block-caption"><span class="caption-number">リスト 316 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id171" title="Link to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">NODE_SVC_PORT</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>services<span class="w"> </span>platform-auth<span class="w"> </span>--namespace<span class="w"> </span>exastro<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.spec.ports[0].nodePort}&quot;</span><span class="k">)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">NODE_MGT_PORT</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>services<span class="w"> </span>platform-auth<span class="w"> </span>--namespace<span class="w"> </span>exastro<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.spec.ports[1].nodePort}&quot;</span><span class="k">)</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">NODE_IP</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>nodes<span class="w"> </span>--namespace<span class="w"> </span>exastro<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.items[0].status.addresses[0].address}&quot;</span><span class="k">)</span>
<span class="c1"># *************************</span>
<span class="c1"># * Administrator Console *</span>
<span class="c1"># *************************</span>
<span class="nb">echo</span><span class="w"> </span>http://<span class="nv">$NODE_IP</span>:<span class="nv">$NODE_MGT_PORT</span>/auth/

<span class="c1"># *************************</span>
<span class="c1"># * Service Console       *</span>
<span class="c1"># *************************</span>
<span class="nb">echo</span><span class="w"> </span>http://<span class="nv">$NODE_IP</span>:<span class="nv">$NODE_SVC_PORT</span>
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">、<span class="menuselection">Administrator Console</span> の URL にアクセスします。</div>
<div class="line">下記は、実行例のため実際のコマンド実行結果に読み替えてください。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id172">
<div class="code-block-caption"><span class="caption-number">リスト 317 </span><span class="caption-text">出力結果(例)</span><a class="headerlink" href="#id172" title="Link to this code">¶</a></div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>*************************
*<span class="w"> </span>Administrator<span class="w"> </span>Console<span class="w"> </span>*
*************************
http://172.16.20.xxx:30081/auth/

*************************
*<span class="w"> </span>Service<span class="w"> </span>Console<span class="w">       </span>*
*************************
http://172.16.20.xxx:30080
</pre></div>
</div>
</div>
<table class="docutils align-left" id="id173">
<caption><span class="caption-number">表 65 </span><span class="caption-text">接続確認用URL</span><a class="headerlink" href="#id173" title="Link to this table">¶</a></caption>
<colgroup>
<col style="width: 33.3%" />
<col style="width: 66.7%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>管理コンソール</p></td>
<td><p><a class="reference external" href="http://172.16.20.xxx:30081/auth/">http://172.16.20.xxx:30081/auth/</a></p></td>
</tr>
</tbody>
</table>
<section id="id25">
<h4>管理コンソールへのログイン<a class="headerlink" href="#id25" title="Link to this heading">¶</a></h4>
<div class="line-block">
<div class="line">以下の画面が表示された場合、<span class="menuselection">Administration Console</span> を選択して、ログイン画面を開きます。</div>
</div>
<figure class="align-default" id="id26">
<a class="reference internal image-reference" href="../../../_images/administrator-console.png"><img alt="administrator-console" src="../../../_images/administrator-console.png" style="width: 600px;" />
</a>
</figure>
<div class="line-block">
<div class="line">ログイン ID とパスワードは <a class="reference internal" href="../../online/exastro/kubernetes.html#create-system-manager"><span class="std std-ref">システム管理者の作成</span></a> で登録した、<kbd class="kbd docutils literal notranslate">KEYCLOAK_USER</kbd> 及び <kbd class="kbd docutils literal notranslate">KEYCLOAK_PASSWORD</kbd> です。</div>
</div>
<figure class="align-default" id="id27">
<a class="reference internal image-reference" href="../../../_images/exastro-login.png"><img alt="login" src="../../../_images/exastro-login.png" style="width: 300px;" />
</a>
</figure>
<div class="line-block">
<div class="line">Keycloak の管理画面が開きます。</div>
</div>
<figure class="align-default" id="keycloak">
<a class="reference internal image-reference" href="../../../_images/keycloak-home.png"><img alt="login" src="../../../_images/keycloak-home.png" style="width: 600px;" />
</a>
</figure>
</section>
</section>
</section>
<section id="id28">
<h2>オーガナイゼーションの作成<a class="headerlink" href="#id28" title="Link to this heading">¶</a></h2>
<div class="line-block">
<div class="line">以下のIPアドレスを書き換え作成ページにアクセスし、オーガナイゼーションの作成を行います。</div>
<div class="line"><a class="reference external" href="http://xx.xx.xx.xx:30081/platform/organizations">http://xx.xx.xx.xx:30081/platform/organizations</a></div>
<div class="line">詳細については、 <a class="reference internal" href="../../../manuals/platform_management/organization.html"><span class="doc">Organization (オーガナイゼーション)</span></a> を参照してください。</div>
</div>
</section>
<section id="id29">
<h2>ワークスペースの作成<a class="headerlink" href="#id29" title="Link to this heading">¶</a></h2>
<div class="line-block">
<div class="line">以下のIPアドレスを書き換え作成ページにアクセスし、ワークスペースの作成を行います。</div>
<div class="line"><a class="reference external" href="http://xx.xx.xx.xx:30080">http://xx.xx.xx.xx:30080</a>/オーガナイゼーションID/platform/workspaces</div>
<div class="line">ワークスペースの作成については、<a class="reference internal" href="../../../manuals/organization_management/workspace.html"><span class="doc">Workspace (ワークスペース)</span></a> を参照してください。</div>
</div>
</section>
<section id="kubesprayexastro">
<h2>kubespray及びExastroのインストール時にエラーが発生した場合の対応<a class="headerlink" href="#kubesprayexastro" title="Link to this heading">¶</a></h2>
<div class="line-block">
<div class="line">Exastroのインストールにはansibleを実行しますが、この手順でエラーが起きた場合は一度アンインストールし、永続ボリュームとkubernetesの削除を行った後、再インストールします。</div>
<div class="line">以下の手順をExastroをインストールするサーバ(Kubernetesクラスター環境)にて実施します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id174">
<div class="code-block-caption"><span class="caption-number">リスト 318 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id174" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1">#削除が完了するまでに数分かかることがあります</span>
helm<span class="w"> </span>uninstall<span class="w"> </span>exastro<span class="w"> </span>--namespace<span class="w"> </span>exastro

<span class="c1">#以下は5つの永続ボリュームを作成している場合の例です</span>
kubectl<span class="w"> </span>delete<span class="w"> </span>pv<span class="w"> </span>pv-auditlog<span class="w"> </span>pv-gitlab<span class="w">  </span>pv-mongo<span class="w">  </span>pv-database<span class="w"> </span>pv-ita-common

<span class="c1">#podが削除されたことを確認します</span>
kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>exastro

<span class="c1">#永続ボリュームが削除されたことを確認します</span>
kibectl<span class="w"> </span>get<span class="w"> </span>pv
</pre></div>
</div>
</div>
<div class="line-block">
<div class="line">kubenetesの削除を行います。kubespyayのインストール時にエラーが発生した場合は以下の手順のみ実行します。</div>
<div class="line">完了するまでに数十分程度の時間がかかります。(通信環境やサーバースペックによって状況は異なります。)</div>
<div class="line">使用するreset.ymlはgit cloneで取得したkubesprayに含まれているため、作成する必要はありません。</div>
<div class="line">完了後、Kubesparayを実行してKubernetesクラスター環境へKubernetesをインストールする手順から再実行します。</div>
</div>
<div class="literal-block-wrapper docutils container" id="id175">
<div class="code-block-caption"><span class="caption-number">リスト 319 </span><span class="caption-text">コマンド</span><a class="headerlink" href="#id175" title="Link to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/tmp/kubespray

ls<span class="w"> </span>reset.yml

ansible-playbook<span class="w"> </span>-i<span class="w"> </span>inventory/k8s_cluster/hosts.yml<span class="w"> </span>reset.yml<span class="w"> </span>-b<span class="w"> </span>-v

<span class="c1">#以下のメッセージが表示されるため、yesを手入力します</span>
Are<span class="w"> </span>you<span class="w"> </span>sure<span class="w"> </span>you<span class="w"> </span>want<span class="w"> </span>to<span class="w"> </span>reset<span class="w"> </span>cluster<span class="w"> </span>state?<span class="w"> </span>Type<span class="w"> </span><span class="s1">&#39;yes&#39;</span><span class="w"> </span>to<span class="w"> </span>reset<span class="w"> </span>your<span class="w"> </span>cluster.:
</pre></div>
</div>
</div>
</section>
</section>


</div>


<div id="articleNavigation">
  <ul>
    <li class="prev"><a href="index.html" title="前のトピックへ"><span>前のトピックへ</span>Exastro</a></li>
    <li class="next"><a href="docker_compose.html" title="次のトピックへ"><span>次のトピックへ</span>Exastro on Docker Compose - Offline</a></li>
  </ul>
</div>


<div id="pageTopLink">
  <a href="#container"><i>↑</i> Page Top</a>
</div>

</article>
</div>
</main>
</div><!-- End #contents -->
<div id="footer">
  <footer class="divInner">
    <small>Copyright © 2019-2023 NEC Corporation</small>
    <small><a href="/terms/ja.html">サイト規約</a></small>
  </footer>
</div><!-- End #footer -->

<div id="overlay"></div>
<div id="grayBack"></div>

</div><!-- End #container -->
  </body>
</html>